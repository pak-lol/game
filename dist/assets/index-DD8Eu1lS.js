const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-D_ZCWJ6d.js","assets/webworkerAll-JP8ub5lI.js","assets/colorToUniform-DutpSomA.js","assets/WebGPURenderer-CvFuZXVi.js","assets/SharedSystems-Dy1pDAwX.js","assets/WebGLRenderer-BKkLpvl-.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const Ta="modulepreload",Ma=function(i){return"/"+i},ki={},Be=function(t,e,s){let r=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(e.map(h=>{if(h=Ma(h),h in ki)return;ki[h]=!0;const l=h.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${c}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Ta,l||(d.as="script"),d.crossOrigin="",d.href=h,o&&d.setAttribute("nonce",o),document.head.appendChild(d),l)return new Promise((f,u)=>{d.addEventListener("load",f),d.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${h}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return t().catch(n)})};var P=(i=>(i.Application="application",i.WebGLPipes="webgl-pipes",i.WebGLPipesAdaptor="webgl-pipes-adaptor",i.WebGLSystem="webgl-system",i.WebGPUPipes="webgpu-pipes",i.WebGPUPipesAdaptor="webgpu-pipes-adaptor",i.WebGPUSystem="webgpu-system",i.CanvasSystem="canvas-system",i.CanvasPipesAdaptor="canvas-pipes-adaptor",i.CanvasPipes="canvas-pipes",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i.MaskEffect="mask-effect",i.BlendMode="blend-mode",i.TextureSource="texture-source",i.Environment="environment",i.ShapeBuilder="shape-builder",i.Batcher="batcher",i))(P||{});const Ys=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Ne=(i,t)=>Ys(i).priority??t,tt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(Ys).forEach(t=>{t.type.forEach(e=>{var s,r;return(r=(s=this._removeHandlers)[e])==null?void 0:r.call(s,t)})}),this},add(...i){return i.map(Ys).forEach(t=>{t.type.forEach(e=>{var n,a;const s=this._addHandlers,r=this._queue;s[e]?(a=s[e])==null||a.call(s,t):(r[e]=r[e]||[],(n=r[e])==null||n.push(t))})}),this},handle(i,t,e){var a;const s=this._addHandlers,r=this._removeHandlers;if(s[i]||r[i])throw new Error(`Extension type ${i} already has a handler`);s[i]=t,r[i]=e;const n=this._queue;return n[i]&&((a=n[i])==null||a.forEach(o=>t(o)),delete n[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(i,t,e=-1){return this.handle(i,s=>{t.findIndex(n=>n.name===s.name)>=0||(t.push({name:s.name,value:s.ref}),t.sort((n,a)=>Ne(a.value,e)-Ne(n.value,e)))},s=>{const r=t.findIndex(n=>n.name===s.name);r!==-1&&t.splice(r,1)})},handleByList(i,t,e=-1){return this.handle(i,s=>{t.includes(s.ref)||(t.push(s.ref),t.sort((r,n)=>Ne(n,e)-Ne(r,e)))},s=>{const r=t.indexOf(s.ref);r!==-1&&t.splice(r,1)})},mixin(i,...t){for(const e of t)Object.defineProperties(i.prototype,Object.getOwnPropertyDescriptors(e))}},Pa={extension:{type:P.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Be(()=>import("./browserAll-D_ZCWJ6d.js"),__vite__mapDeps([0,1,2]))}},ka={extension:{type:P.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Be(()=>import("./webworkerAll-JP8ub5lI.js"),__vite__mapDeps([1,2]))}};class Q{constructor(t,e,s){this._x=e||0,this._y=s||0,this._observer=t}clone(t){return new Q(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}function Vr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Yr={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var u=new r(c,d||h,f),m=e?e+l:l;return h._events[m]?h._events[m].fn?h._events[m]=[h._events[m],u]:h._events[m].push(u):(h._events[m]=u,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new s:delete h._events[l]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)t.call(c,d)&&l.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=e?e+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,u=d.length,m=new Array(u);f<u;f++)m[f]=d[f].fn;return m},o.prototype.listenerCount=function(l){var c=e?e+l:l,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,c,d,f,u,m){var g=e?e+l:l;if(!this._events[g])return!1;var p=this._events[g],x=arguments.length,y,_;if(p.fn){switch(p.once&&this.removeListener(l,p.fn,void 0,!0),x){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,d),!0;case 4:return p.fn.call(p.context,c,d,f),!0;case 5:return p.fn.call(p.context,c,d,f,u),!0;case 6:return p.fn.call(p.context,c,d,f,u,m),!0}for(_=1,y=new Array(x-1);_<x;_++)y[_-1]=arguments[_];p.fn.apply(p.context,y)}else{var b=p.length,S;for(_=0;_<b;_++)switch(p[_].once&&this.removeListener(l,p[_].fn,void 0,!0),x){case 1:p[_].fn.call(p[_].context);break;case 2:p[_].fn.call(p[_].context,c);break;case 3:p[_].fn.call(p[_].context,c,d);break;case 4:p[_].fn.call(p[_].context,c,d,f);break;default:if(!y)for(S=1,y=new Array(x-1);S<x;S++)y[S-1]=arguments[S];p[_].fn.apply(p[_].context,y)}}return!0},o.prototype.on=function(l,c,d){return n(this,l,c,d,!1)},o.prototype.once=function(l,c,d){return n(this,l,c,d,!0)},o.prototype.removeListener=function(l,c,d,f){var u=e?e+l:l;if(!this._events[u])return this;if(!c)return a(this,u),this;var m=this._events[u];if(m.fn)m.fn===c&&(!f||m.once)&&(!d||m.context===d)&&a(this,u);else{for(var g=0,p=[],x=m.length;g<x;g++)(m[g].fn!==c||f&&!m[g].once||d&&m[g].context!==d)&&p.push(m[g]);p.length?this._events[u]=p.length===1?p[0]:p:a(this,u)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=e?e+l:l,this._events[c]&&a(this,c)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,i.exports=o})(Yr);var Ea=Yr.exports;const mt=Vr(Ea),Ia=Math.PI*2,Ba=180/Math.PI,Ra=Math.PI/180;class et{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new et(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return bs.x=0,bs.y=0,bs}}const bs=new et;class F{constructor(t=1,e=0,s=0,r=1,n=0,a=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=r,this.tx=n,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,r,n,a){return this.a=t,this.b=e,this.c=s,this.d=r,this.tx=n,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new et;const s=t.x,r=t.y;return e.x=this.a*s+this.c*r+this.tx,e.y=this.b*s+this.d*r+this.ty,e}applyInverse(t,e){e=e||new et;const s=this.a,r=this.b,n=this.c,a=this.d,o=this.tx,h=this.ty,l=1/(s*a+n*-r),c=t.x,d=t.y;return e.x=a*l*c+-n*l*d+(h*n-o*a)*l,e.y=s*l*d+-r*l*c+(-h*s+o*r)*l,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),r=this.a,n=this.c,a=this.tx;return this.a=r*e-this.b*s,this.b=r*s+this.b*e,this.c=n*e-this.d*s,this.d=n*s+this.d*e,this.tx=a*e-this.ty*s,this.ty=a*s+this.ty*e,this}append(t){const e=this.a,s=this.b,r=this.c,n=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*s+t.b*n,this.c=t.c*e+t.d*r,this.d=t.c*s+t.d*n,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*s+t.ty*n+this.ty,this}appendFrom(t,e){const s=t.a,r=t.b,n=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,c=e.b,d=e.c,f=e.d;return this.a=s*l+r*d,this.b=s*c+r*f,this.c=n*l+a*d,this.d=n*c+a*f,this.tx=o*l+h*d+e.tx,this.ty=o*c+h*f+e.ty,this}setTransform(t,e,s,r,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=t-(s*this.a+r*this.c),this.ty=e-(s*this.b+r*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const s=this.a,r=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=r*t.a+this.d*t.c,this.d=r*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,r=this.c,n=this.d,a=t.pivot,o=-Math.atan2(-r,n),h=Math.atan2(s,e),l=Math.abs(o+h);return l<1e-5||Math.abs(Ia-l)<1e-5?(t.rotation=h,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=h),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(r*r+n*n),t.position.x=this.tx+(a.x*e+a.y*r),t.position.y=this.ty+(a.x*s+a.y*n),t}invert(){const t=this.a,e=this.b,s=this.c,r=this.d,n=this.tx,a=t*r-e*s;return this.a=r/a,this.b=-e/a,this.c=-s/a,this.d=t/a,this.tx=(s*this.ty-r*n)/a,this.ty=-(t*this.ty-e*n)/a,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new F;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return La.identity()}static get shared(){return Fa.identity()}}const Fa=new F,La=new F,Ut=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],$t=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Ht=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Nt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],js=[],jr=[],Ve=Math.sign;function Da(){for(let i=0;i<16;i++){const t=[];js.push(t);for(let e=0;e<16;e++){const s=Ve(Ut[i]*Ut[e]+Ht[i]*$t[e]),r=Ve($t[i]*Ut[e]+Nt[i]*$t[e]),n=Ve(Ut[i]*Ht[e]+Ht[i]*Nt[e]),a=Ve($t[i]*Ht[e]+Nt[i]*Nt[e]);for(let o=0;o<16;o++)if(Ut[o]===s&&$t[o]===r&&Ht[o]===n&&Nt[o]===a){t.push(o);break}}}for(let i=0;i<16;i++){const t=new F;t.set(Ut[i],$t[i],Ht[i],Nt[i],0,0),jr.push(t)}}Da();const W={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Ut[i],uY:i=>$t[i],vX:i=>Ht[i],vY:i=>Nt[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>js[i][t],sub:(i,t)=>js[i][W.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?W.S:W.N:Math.abs(t)*2<=Math.abs(i)?i>0?W.E:W.W:t>0?i>0?W.SE:W.SW:i>0?W.NE:W.NW,matrixAppendRotationInv:(i,t,e=0,s=0)=>{const r=jr[W.inv(t)];r.tx=e,r.ty=s,i.append(r)},transformRectCoords:(i,t,e,s)=>{const{x:r,y:n,width:a,height:o}=i,{x:h,y:l,width:c,height:d}=t;return e===W.E?(s.set(r+h,n+l,a,o),s):e===W.S?s.set(c-n-o+h,r+l,o,a):e===W.W?s.set(c-r-a+h,d-n-o+l,a,o):e===W.N?s.set(n+h,d-r-a+l,o,a):s.set(r+h,n+l,a,o)}},Ye=[new et,new et,new et,new et];class V{constructor(t=0,e=0,s=0,r=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(r)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new V(0,0,0,0)}clone(){return new V(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,s,r=.5){const{width:n,height:a}=this;if(n<=0||a<=0)return!1;const o=this.x,h=this.y,l=s*(1-r),c=s-l,d=o-l,f=o+n+l,u=h-l,m=h+a+l,g=o+c,p=o+n-c,x=h+c,y=h+a-c;return t>=d&&t<=f&&e>=u&&e<=m&&!(t>g&&t<p&&e>x&&e<y)}intersects(t,e){if(!e){const E=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=E)return!1;const A=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>A}const s=this.left,r=this.right,n=this.top,a=this.bottom;if(r<=s||a<=n)return!1;const o=Ye[0].set(t.left,t.top),h=Ye[1].set(t.left,t.bottom),l=Ye[2].set(t.right,t.top),c=Ye[3].set(t.right,t.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const d=Math.sign(e.a*e.d-e.b*e.c);if(d===0||(e.apply(o,o),e.apply(h,h),e.apply(l,l),e.apply(c,c),Math.max(o.x,h.x,l.x,c.x)<=s||Math.min(o.x,h.x,l.x,c.x)>=r||Math.max(o.y,h.y,l.y,c.y)<=n||Math.min(o.y,h.y,l.y,c.y)>=a))return!1;const f=d*(h.y-o.y),u=d*(o.x-h.x),m=f*s+u*n,g=f*r+u*n,p=f*s+u*a,x=f*r+u*a;if(Math.max(m,g,p,x)<=f*o.x+u*o.y||Math.min(m,g,p,x)>=f*c.x+u*c.y)return!1;const y=d*(o.y-l.y),_=d*(l.x-o.x),b=y*s+_*n,S=y*r+_*n,v=y*s+_*a,w=y*r+_*a;return!(Math.max(b,S,v,w)<=y*o.x+_*o.y||Math.min(b,S,v,w)>=y*c.x+_*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=r-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),n=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=r,this.height=n-r,this}getBounds(t){return t||(t=new V),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,s=t.y,r=t.x+t.width,n=t.y+t.height;return e>=this.x&&e<this.x+this.width&&s>=this.y&&s<this.y+this.height&&r>=this.x&&r<this.x+this.width&&n>=this.y&&n<this.y+this.height}set(t,e,s,r){return this.x=t,this.y=e,this.width=s,this.height=r,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const ws={default:-1};function X(i="default"){return ws[i]===void 0&&(ws[i]=-1),++ws[i]}const Ei=new Set,z="8.0.0",Oa="8.3.4",Jt={quiet:!1,noColor:!1},R=(i,t,e=3)=>{if(Jt.quiet||Ei.has(t))return;let s=new Error().stack;const r=`${t}
Deprecated since v${i}`,n=typeof console.groupCollapsed=="function"&&!Jt.noColor;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",r):(s=s.split(`
`).splice(e).join(`
`),n?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",r),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",r),console.warn(s))),Ei.add(t)};Object.defineProperties(R,{quiet:{get:()=>Jt.quiet,set:i=>{Jt.quiet=i},enumerable:!0,configurable:!1},noColor:{get:()=>Jt.noColor,set:i=>{Jt.noColor=i},enumerable:!0,configurable:!1}});const Xr=()=>{};function se(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Ii(i){return!(i&i-1)&&!!i}function qr(i){const t={};for(const e in i)i[e]!==void 0&&(t[e]=i[e]);return t}const Bi=Object.create(null);function Ga(i){const t=Bi[i];return t===void 0&&(Bi[i]=X("resource")),t}const Kr=class Zr extends mt{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...Zr.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){R(z,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Ga(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};Kr.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ie=Kr;const Qr=class Jr extends mt{constructor(t={}){super(),this.options=t,this.uid=X("textureSource"),this._resourceType="textureSource",this._resourceId=X("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...Jr.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new ie(qr(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,s;this.style!==t&&((e=this._style)==null||e.off("change",this._onStyleChange,this),this._style=t,(s=this._style)==null||s.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=X("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,s){s||(s=this._resolution),t||(t=this.width),e||(e=this.height);const r=Math.round(t*s),n=Math.round(e*s);return this.width=r/s,this.height=n/s,this._resolution=s,this.pixelWidth===r&&this.pixelHeight===n?!1:(this._refreshPOT(),this.pixelWidth=r,this.pixelHeight=n,this.emit("resize",this),this._resourceId=X("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Ii(this.pixelWidth)&&Ii(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Qr.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let gt=Qr;class di extends gt{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let s=t.format;s||(e instanceof Float32Array?s="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?s="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?s="rgba16uint":(e instanceof Int8Array,s="bgra8unorm")),super({...t,resource:e,format:s}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}di.extension=P.TextureSource;const Ri=new F;class za{constructor(t,e){this.mapCoord=new F,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&((e=this._texture)==null||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const s=this.mapCoord;for(let r=0;r<t.length;r+=2){const n=t[r],a=t[r+1];e[r]=n*s.a+a*s.c+s.tx,e[r+1]=n*s.b+a*s.d+s.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const s=t.orig,r=t.trim;r&&(Ri.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Ri));const n=t.source,a=this.uClampFrame,o=this.clampMargin/n._resolution,h=this.clampOffset/n._resolution;return a[0]=(t.frame.x+o+h)/n.width,a[1]=(t.frame.y+o+h)/n.height,a[2]=(t.frame.x+t.frame.width-o+h)/n.width,a[3]=(t.frame.y+t.frame.height-o+h)/n.height,this.uClampOffset[0]=this.clampOffset/n.pixelWidth,this.uClampOffset[1]=this.clampOffset/n.pixelHeight,this.isSimple=t.frame.width===n.width&&t.frame.height===n.height&&t.rotate===0,!0}}class D extends mt{constructor({source:t,label:e,frame:s,orig:r,trim:n,defaultAnchor:a,defaultBorders:o,rotate:h,dynamic:l}={}){if(super(),this.uid=X("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new V,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=(t==null?void 0:t.source)??new gt,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:c,height:d}=this._source;this.frame.width=c,this.frame.height=d}this.orig=r||this.frame,this.trim=n,this.rotate=h??0,this.defaultAnchor=a,this.defaultBorders=o,this.destroyed=!1,this.dynamic=l||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new za(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:s,height:r}=this._source,n=e.x/s,a=e.y/r,o=e.width/s,h=e.height/r;let l=this.rotate;if(l){const c=o/2,d=h/2,f=n+c,u=a+d;l=W.add(l,W.NW),t.x0=f+c*W.uX(l),t.y0=u+d*W.uY(l),l=W.add(l,2),t.x1=f+c*W.uX(l),t.y1=u+d*W.uY(l),l=W.add(l,2),t.x2=f+c*W.uX(l),t.y2=u+d*W.uY(l),l=W.add(l,2),t.x3=f+c*W.uX(l),t.y3=u+d*W.uY(l)}else t.x0=n,t.y0=a,t.x1=n+o,t.y1=a,t.x2=n+o,t.y2=a+h,t.x3=n,t.y3=a+h}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return R(z,"Texture.baseTexture is now Texture.source"),this._source}}D.EMPTY=new D({label:"EMPTY",source:new gt({label:"EMPTY"})});D.EMPTY.destroy=Xr;D.WHITE=new D({source:new di({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});D.WHITE.destroy=Xr;function Wa(i,t,e){const{width:s,height:r}=e.orig,n=e.trim;if(n){const a=n.width,o=n.height;i.minX=n.x-t._x*s,i.maxX=i.minX+a,i.minY=n.y-t._y*r,i.maxY=i.minY+o}else i.minX=-t._x*s,i.maxX=i.minX+s,i.minY=-t._y*r,i.maxY=i.minY+r}const Fi=new F;class pt{constructor(t=1/0,e=1/0,s=-1/0,r=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Fi,this.minX=t,this.minY=e,this.maxX=s,this.maxY=r}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new V);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Fi,this}set(t,e,s,r){this.minX=t,this.minY=e,this.maxX=s,this.maxY=r}addFrame(t,e,s,r,n){n||(n=this.matrix);const a=n.a,o=n.b,h=n.c,l=n.d,c=n.tx,d=n.ty;let f=this.minX,u=this.minY,m=this.maxX,g=this.maxY,p=a*t+h*e+c,x=o*t+l*e+d;p<f&&(f=p),x<u&&(u=x),p>m&&(m=p),x>g&&(g=x),p=a*s+h*e+c,x=o*s+l*e+d,p<f&&(f=p),x<u&&(u=x),p>m&&(m=p),x>g&&(g=x),p=a*t+h*r+c,x=o*t+l*r+d,p<f&&(f=p),x<u&&(u=x),p>m&&(m=p),x>g&&(g=x),p=a*s+h*r+c,x=o*s+l*r+d,p<f&&(f=p),x<u&&(u=x),p>m&&(m=p),x>g&&(g=x),this.minX=f,this.minY=u,this.maxX=m,this.maxY=g}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,s=this.minY,r=this.maxX,n=this.maxY,{a,b:o,c:h,d:l,tx:c,ty:d}=t;let f=a*e+h*s+c,u=o*e+l*s+d;this.minX=f,this.minY=u,this.maxX=f,this.maxY=u,f=a*r+h*s+c,u=o*r+l*s+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY,f=a*e+h*n+c,u=o*e+l*n+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY,f=a*r+h*n+c,u=o*r+l*n+d,this.minX=f<this.minX?f:this.minX,this.minY=u<this.minY?u:this.minY,this.maxX=f>this.maxX?f:this.maxX,this.maxY=u>this.maxY?u:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,s,r){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<s&&(this.minY=s),this.maxY>r&&(this.maxY=r),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new pt(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,s,r){let n=this.minX,a=this.minY,o=this.maxX,h=this.maxY;r||(r=this.matrix);const l=r.a,c=r.b,d=r.c,f=r.d,u=r.tx,m=r.ty;for(let g=e;g<s;g+=2){const p=t[g],x=t[g+1],y=l*p+d*x+u,_=c*p+f*x+m;n=y<n?y:n,a=_<a?_:a,o=y>o?y:o,h=_>h?_:h}this.minX=n,this.minY=a,this.maxX=o,this.maxY=h}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var Ua={grad:.9,turn:360,rad:360/(2*Math.PI)},vt=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},K=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},ot=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},tn=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Li=function(i){return{r:ot(i.r,0,255),g:ot(i.g,0,255),b:ot(i.b,0,255),a:ot(i.a)}},vs=function(i){return{r:K(i.r),g:K(i.g),b:K(i.b),a:K(i.a,3)}},$a=/^#([0-9a-f]{3,8})$/i,je=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},en=function(i){var t=i.r,e=i.g,s=i.b,r=i.a,n=Math.max(t,e,s),a=n-Math.min(t,e,s),o=a?n===t?(e-s)/a:n===e?2+(s-t)/a:4+(t-e)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:r}},sn=function(i){var t=i.h,e=i.s,s=i.v,r=i.a;t=t/360*6,e/=100,s/=100;var n=Math.floor(t),a=s*(1-e),o=s*(1-(t-n)*e),h=s*(1-(1-t+n)*e),l=n%6;return{r:255*[s,o,a,a,h,s][l],g:255*[h,s,s,o,a,a][l],b:255*[a,a,h,s,s,o][l],a:r}},Di=function(i){return{h:tn(i.h),s:ot(i.s,0,100),l:ot(i.l,0,100),a:ot(i.a)}},Oi=function(i){return{h:K(i.h),s:K(i.s),l:K(i.l),a:K(i.a,3)}},Gi=function(i){return sn((e=(t=i).s,{h:t.h,s:(e*=((s=t.l)<50?s:100-s)/100)>0?2*e/(s+e)*100:0,v:s+e,a:t.a}));var t,e,s},Te=function(i){return{h:(t=en(i)).h,s:(r=(200-(e=t.s))*(s=t.v)/100)>0&&r<200?e*s/100/(r<=100?r:200-r)*100:0,l:r/2,a:t.a};var t,e,s,r},Ha=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Na=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Va=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ya=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Xs={string:[[function(i){var t=$a.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?K(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?K(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Va.exec(i)||Ya.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Li({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=Ha.exec(i)||Na.exec(i);if(!t)return null;var e,s,r=Di({h:(e=t[1],s=t[2],s===void 0&&(s="deg"),Number(e)*(Ua[s]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Gi(r)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,s=i.b,r=i.a,n=r===void 0?1:r;return vt(t)&&vt(e)&&vt(s)?Li({r:Number(t),g:Number(e),b:Number(s),a:Number(n)}):null},"rgb"],[function(i){var t=i.h,e=i.s,s=i.l,r=i.a,n=r===void 0?1:r;if(!vt(t)||!vt(e)||!vt(s))return null;var a=Di({h:Number(t),s:Number(e),l:Number(s),a:Number(n)});return Gi(a)},"hsl"],[function(i){var t=i.h,e=i.s,s=i.v,r=i.a,n=r===void 0?1:r;if(!vt(t)||!vt(e)||!vt(s))return null;var a=function(o){return{h:tn(o.h),s:ot(o.s,0,100),v:ot(o.v,0,100),a:ot(o.a)}}({h:Number(t),s:Number(e),v:Number(s),a:Number(n)});return sn(a)},"hsv"]]},zi=function(i,t){for(var e=0;e<t.length;e++){var s=t[e][0](i);if(s)return[s,t[e][1]]}return[null,void 0]},ja=function(i){return typeof i=="string"?zi(i.trim(),Xs.string):typeof i=="object"&&i!==null?zi(i,Xs.object):[null,void 0]},Ss=function(i,t){var e=Te(i);return{h:e.h,s:ot(e.s+100*t,0,100),l:e.l,a:e.a}},As=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Wi=function(i,t){var e=Te(i);return{h:e.h,s:e.s,l:ot(e.l+100*t,0,100),a:e.a}},qs=function(){function i(t){this.parsed=ja(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return K(As(this.rgba),2)},i.prototype.isDark=function(){return As(this.rgba)<.5},i.prototype.isLight=function(){return As(this.rgba)>=.5},i.prototype.toHex=function(){return t=vs(this.rgba),e=t.r,s=t.g,r=t.b,a=(n=t.a)<1?je(K(255*n)):"","#"+je(e)+je(s)+je(r)+a;var t,e,s,r,n,a},i.prototype.toRgb=function(){return vs(this.rgba)},i.prototype.toRgbString=function(){return t=vs(this.rgba),e=t.r,s=t.g,r=t.b,(n=t.a)<1?"rgba("+e+", "+s+", "+r+", "+n+")":"rgb("+e+", "+s+", "+r+")";var t,e,s,r,n},i.prototype.toHsl=function(){return Oi(Te(this.rgba))},i.prototype.toHslString=function(){return t=Oi(Te(this.rgba)),e=t.h,s=t.s,r=t.l,(n=t.a)<1?"hsla("+e+", "+s+"%, "+r+"%, "+n+")":"hsl("+e+", "+s+"%, "+r+"%)";var t,e,s,r,n},i.prototype.toHsv=function(){return t=en(this.rgba),{h:K(t.h),s:K(t.s),v:K(t.v),a:K(t.a,3)};var t},i.prototype.invert=function(){return _t({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),_t(Ss(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),_t(Ss(this.rgba,-t))},i.prototype.grayscale=function(){return _t(Ss(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),_t(Wi(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),_t(Wi(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?_t({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):K(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Te(this.rgba);return typeof t=="number"?_t({h:t,s:e.s,l:e.l,a:e.a}):K(e.h)},i.prototype.isEqual=function(t){return this.toHex()===_t(t).toHex()},i}(),_t=function(i){return i instanceof qs?i:new qs(i)},Ui=[],Xa=function(i){i.forEach(function(t){Ui.indexOf(t)<0&&(t(qs,Xs),Ui.push(t))})};function qa(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var r in e)s[e[r]]=r;var n={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=s[this.toHex()];if(l)return l;if(a!=null&&a.closest){var c=this.toRgb(),d=1/0,f="black";if(!n.length)for(var u in e)n[u]=new i(e[u]).toRgb();for(var m in e){var g=(o=c,h=n[m],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));g<d&&(d=g,f=m)}return f}},t.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":e[o];return h?new i(h).toRgb():null},"name"])}Xa([qa]);const re=class be{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof be)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const s=typeof t;if(s!==typeof e)return!1;if(s==="number"||s==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,a)=>n===e[a]);if(t!==null&&e!==null){const n=Object.keys(t),a=Object.keys(e);return n.length!==a.length?!1:n.every(o=>t[o]===e[o])}return t===e}toRgba(){const[t,e,s,r]=this._components;return{r:t,g:e,b:s,a:r}}toRgb(){const[t,e,s]=this._components;return{r:t,g:e,b:s}}toRgbaString(){const[t,e,s]=this.toUint8RgbArray();return`rgba(${t},${e},${s},${this.alpha})`}toUint8RgbArray(t){const[e,s,r]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(s*255),t[2]=Math.round(r*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,s,r,n]=this._components;return t[0]=e,t[1]=s,t[2]=r,t[3]=n,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,s,r]=this._components;return t[0]=e,t[1]=s,t[2]=r,t}toNumber(){return this._int}toBgrNumber(){const[t,e,s]=this.toUint8RgbArray();return(s<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,s,r,n]=be._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=s,this._components[2]*=r,this._components[3]*=n,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let s=this._int>>16&255,r=this._int>>8&255,n=this._int&255;return e&&(s=s*t+.5|0,r=r*t+.5|0,n=n*t+.5|0),(t*255<<24)+(s<<16)+(r<<8)+n}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,s,r,n;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,s=(a>>8&255)/255,r=(a&255)/255,n=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,s,r,n=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,s,r,n=255]=t,e/=255,s/=255,r/=255,n/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=be.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const a=_t(t);a.isValid()&&({r:e,g:s,b:r,a:n}=a.rgba,e/=255,s/=255,r/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=s,this._components[2]=r,this._components[3]=n,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,s]=this._components;this._int=(t*255<<16)+(e*255<<8)+(s*255|0)}_clamp(t,e=0,s=1){return typeof t=="number"?Math.min(Math.max(t,e),s):(t.forEach((r,n)=>{t[n]=Math.min(Math.max(r,e),s)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof be||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};re.shared=new re;re._temp=new re;re.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let q=re;const Ka={cullArea:null,cullable:!1,cullableChildren:!0};let Cs=0;const $i=500;function N(...i){Cs!==$i&&(Cs++,Cs===$i?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...i))}const We={_registeredResources:new Set,register(i){this._registeredResources.add(i)},unregister(i){this._registeredResources.delete(i)},release(){this._registeredResources.forEach(i=>i.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(i){return this._registeredResources.has(i)},reset(){this._registeredResources.clear()}};class Za{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var s;let e;return this._index>0?e=this._pool[--this._index]:e=new this._classType,(s=e.init)==null||s.call(e,t),e}return(t){var e;(e=t.reset)==null||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class Qa{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Za(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const s=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[s]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const ht=new Qa;We.register(ht);const Ja={get isCachedAsTexture(){var i;return!!((i=this.renderGroup)!=null&&i.isCachedAsTexture)},cacheAsTexture(i){typeof i=="boolean"&&i===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(i===!0?{}:i))},updateCacheTexture(){var i;(i=this.renderGroup)==null||i.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(i){R("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(i)}};function to(i,t,e){const s=i.length;let r;if(t>=s||e===0)return;e=t+e>s?s-t:e;const n=s-e;for(r=t;r<n;++r)i[r]=i[r+e];i.length=n}const eo={allowChildren:!0,removeChildren(i=0,t){var n;const e=t??this.children.length,s=e-i,r=[];if(s>0&&s<=e){for(let o=e-1;o>=i;o--){const h=this.children[o];h&&(r.push(h),h.parent=null)}to(this.children,i,e);const a=this.renderGroup||this.parentRenderGroup;a&&a.removeChildren(r);for(let o=0;o<r.length;++o){const h=r[o];(n=h.parentRenderLayer)==null||n.detach(h),this.emit("childRemoved",h,this,o),r[o].emit("removed",this)}return r.length>0&&this._didViewChangeTick++,r}else if(s===0&&this.children.length===0)return r;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(i){const t=this.getChildAt(i);return this.removeChild(t)},getChildAt(i){if(i<0||i>=this.children.length)throw new Error(`getChildAt: Index (${i}) does not exist.`);return this.children[i]},setChildIndex(i,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(i),this.addChildAt(i,t)},getChildIndex(i){const t=this.children.indexOf(i);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(i,t){this.allowChildren||R(z,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${i}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(i.parent){const r=i.parent.children.indexOf(i);if(i.parent===this&&r===t)return i;r!==-1&&i.parent.children.splice(r,1)}t===e.length?e.push(i):e.splice(t,0,i),i.parent=this,i.didChange=!0,i._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(i),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",i,this,t),i.emit("added",this),i},swapChildren(i,t){if(i===t)return;const e=this.getChildIndex(i),s=this.getChildIndex(t);this.children[e]=t,this.children[s]=i;const r=this.renderGroup||this.parentRenderGroup;r&&(r.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var i;(i=this.parent)==null||i.removeChild(this)},reparentChild(...i){return i.length===1?this.reparentChildAt(i[0],this.children.length):(i.forEach(t=>this.reparentChildAt(t,this.children.length)),i[0])},reparentChildAt(i,t){if(i.parent===this)return this.setChildIndex(i,t),i;const e=i.worldTransform.clone();i.removeFromParent(),this.addChildAt(i,t);const s=this.worldTransform.clone();return s.invert(),e.prepend(s),i.setFromMatrix(e),i},replaceChild(i,t){i.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(i)),t.setFromMatrix(i.localTransform),t.updateLocalTransform(),this.removeChild(i)}},so={collectRenderables(i,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(i,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,i):this.collectRenderablesWithEffects(i,t,e))},collectRenderablesSimple(i,t,e){const s=this.children,r=s.length;for(let n=0;n<r;n++)s[n].collectRenderables(i,t,e)},collectRenderablesWithEffects(i,t,e){const{renderPipes:s}=t;for(let r=0;r<this.effects.length;r++){const n=this.effects[r];s[n.pipe].push(n,this,i)}this.collectRenderablesSimple(i,t,e);for(let r=this.effects.length-1;r>=0;r--){const n=this.effects[r];s[n.pipe].pop(n,this,i)}}};class Hi{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class io{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const s=this._tests[e];if(s.test(t))return ht.get(s.maskClass,t)}return t}returnMaskEffect(t){ht.return(t)}}const Ks=new io;tt.handleByList(P.MaskEffect,Ks._effectClasses);const ro={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0)},addEffect(i){this.effects.indexOf(i)===-1&&(this.effects.push(i),this.effects.sort((e,s)=>e.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(i){const t=this.effects.indexOf(i);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(i){const t=this._maskEffect;(t==null?void 0:t.mask)!==i&&(t&&(this.removeEffect(t),Ks.returnMaskEffect(t),this._maskEffect=null),i!=null&&(this._maskEffect=Ks.getMaskEffect(i),this.addEffect(this._maskEffect)))},get mask(){var i;return(i=this._maskEffect)==null?void 0:i.mask},setMask(i){this._maskOptions={...this._maskOptions,...i},i.mask&&(this.mask=i.mask),this._markStructureAsChanged()},set filters(i){var n;!Array.isArray(i)&&i&&(i=[i]);const t=this._filterEffect||(this._filterEffect=new Hi);i=i;const e=(i==null?void 0:i.length)>0,s=((n=t.filters)==null?void 0:n.length)>0,r=e!==s;i=Array.isArray(i)?i.slice(0):i,t.filters=Object.freeze(i),r&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=i??null))},get filters(){var i;return(i=this._filterEffect)==null?void 0:i.filters},set filterArea(i){this._filterEffect||(this._filterEffect=new Hi),this._filterEffect.filterArea=i},get filterArea(){var i;return(i=this._filterEffect)==null?void 0:i.filterArea}},no={label:null,get name(){return R(z,"Container.name property has been removed, use Container.label instead"),this.label},set name(i){R(z,"Container.name property has been removed, use Container.label instead"),this.label=i},getChildByName(i,t=!1){return this.getChildByLabel(i,t)},getChildByLabel(i,t=!1){const e=this.children;for(let s=0;s<e.length;s++){const r=e[s];if(r.label===i||i instanceof RegExp&&i.test(r.label))return r}if(t)for(let s=0;s<e.length;s++){const n=e[s].getChildByLabel(i,!0);if(n)return n}return null},getChildrenByLabel(i,t=!1,e=[]){const s=this.children;for(let r=0;r<s.length;r++){const n=s[r];(n.label===i||i instanceof RegExp&&i.test(n.label))&&e.push(n)}if(t)for(let r=0;r<s.length;r++)s[r].getChildrenByLabel(i,!0,e);return e}},st=ht.getPool(F),Ct=ht.getPool(pt),ao=new F,oo={getFastGlobalBounds(i,t){t||(t=new pt),t.clear(),this._getGlobalBoundsRecursive(!!i,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(i,t,e){let s=t;if(i&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const r=!!this.effects.length;if((this.renderGroup||r)&&(s=Ct.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const a=this.bounds;s.addFrame(a.minX,a.minY,a.maxX,a.maxY,this.groupTransform)}const n=this.children;for(let a=0;a<n.length;a++)n[a]._getGlobalBoundsRecursive(i,s,e)}if(r){let n=!1;const a=this.renderGroup||this.parentRenderGroup;for(let o=0;o<this.effects.length;o++)this.effects[o].addBounds&&(n||(n=!0,s.applyMatrix(a.worldTransform)),this.effects[o].addBounds(s,!0));n&&s.applyMatrix(a.worldTransform.copyTo(ao).invert()),t.addBounds(s),Ct.return(s)}else this.renderGroup&&(t.addBounds(s,this.relativeGroupTransform),Ct.return(s))}};function rn(i,t,e){e.clear();let s,r;return i.parent?t?s=i.parent.worldTransform:(r=st.get().identity(),s=ui(i,r)):s=F.IDENTITY,nn(i,e,s,t),r&&st.return(r),e.isValid||e.set(0,0,0,0),e}function nn(i,t,e,s){var o,h;if(!i.visible||!i.measurable)return;let r;s?r=i.worldTransform:(i.updateLocalTransform(),r=st.get(),r.appendFrom(i.localTransform,e));const n=t,a=!!i.effects.length;if(a&&(t=Ct.get().clear()),i.boundsArea)t.addRect(i.boundsArea,r);else{const l=i.bounds;l&&!l.isEmpty()&&(t.matrix=r,t.addBounds(l));for(let c=0;c<i.children.length;c++)nn(i.children[c],t,r,s)}if(a){for(let l=0;l<i.effects.length;l++)(h=(o=i.effects[l]).addBounds)==null||h.call(o,t);n.addBounds(t,F.IDENTITY),Ct.return(t)}s||st.return(r)}function ui(i,t){const e=i.parent;return e&&(ui(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function an(i,t){if(i===16777215||!t)return t;if(t===16777215||!i)return i;const e=i>>16&255,s=i>>8&255,r=i&255,n=t>>16&255,a=t>>8&255,o=t&255,h=e*n/255|0,l=s*a/255|0,c=r*o/255|0;return(h<<16)+(l<<8)+c}const Ni=16777215;function Vi(i,t){return i===Ni?t:t===Ni?i:an(i,t)}function ns(i){return((i&255)<<16)+(i&65280)+(i>>16&255)}const ho={getGlobalAlpha(i){if(i)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(i=new F,t){if(t)return i.copyFrom(this.worldTransform);this.updateLocalTransform();const e=ui(this,st.get().identity());return i.appendFrom(this.localTransform,e),st.return(e),i},getGlobalTint(i){if(i)return this.renderGroup?ns(this.renderGroup.worldColor):this.parentRenderGroup?ns(Vi(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=Vi(t,e.localColor),e=e.parent;return ns(t)}};function on(i,t,e){return t.clear(),e||(e=F.IDENTITY),hn(i,t,e,i,!0),t.isValid||t.set(0,0,0,0),t}function hn(i,t,e,s,r){var h,l;let n;if(r)n=st.get(),n=e.copyTo(n);else{if(!i.visible||!i.measurable)return;i.updateLocalTransform();const c=i.localTransform;n=st.get(),n.appendFrom(c,e)}const a=t,o=!!i.effects.length;if(o&&(t=Ct.get().clear()),i.boundsArea)t.addRect(i.boundsArea,n);else{i.renderPipeId&&(t.matrix=n,t.addBounds(i.bounds));const c=i.children;for(let d=0;d<c.length;d++)hn(c[d],t,n,s,!1)}if(o){for(let c=0;c<i.effects.length;c++)(l=(h=i.effects[c]).addLocalBounds)==null||l.call(h,t,s);a.addBounds(t,F.IDENTITY),Ct.return(t)}st.return(n)}function ln(i,t){const e=i.children;for(let s=0;s<e.length;s++){const r=e[s],n=r.uid,a=(r._didViewChangeTick&65535)<<16|r._didContainerChangeTick&65535,o=t.index;(t.data[o]!==n||t.data[o+1]!==a)&&(t.data[t.index]=n,t.data[t.index+1]=a,t.didChange=!0),t.index=o+2,r.children.length&&ln(r,t)}return t.didChange}const lo=new F,co={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(i,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=i/t*e:this.scale.x=e},_setHeight(i,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=i/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new pt});const i=this._localBoundsCacheData;return i.index=1,i.didChange=!1,i.data[0]!==this._didViewChangeTick&&(i.didChange=!0,i.data[0]=this._didViewChangeTick),ln(this,i),i.didChange&&on(this,i.localBounds,lo),i.localBounds},getBounds(i,t){return rn(this,i,t||new pt)}},uo={_onRender:null,set onRender(i){const t=this.renderGroup||this.parentRenderGroup;if(!i){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=i},get onRender(){return this._onRender}},fo={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(i){this._zIndex!==i&&(this._zIndex=i,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(po))}};function po(i,t){return i._zIndex-t._zIndex}const mo={getGlobalPosition(i=new et,t=!1){return this.parent?this.parent.toGlobal(this._position,i,t):(i.x=this._position.x,i.y=this._position.y),i},toGlobal(i,t,e=!1){const s=this.getGlobalTransform(st.get(),e);return t=s.apply(i,t),st.return(s),t},toLocal(i,t,e,s){t&&(i=t.toGlobal(i,e,s));const r=this.getGlobalTransform(st.get(),s);return e=r.applyInverse(i,e),st.return(r),e}};class cn{constructor(){this.uid=X("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let go=0;class xo{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new ie(this.textureOptions)}createTexture(t,e,s){const r=new gt({...this.textureOptions,width:t,height:e,resolution:1,antialias:s,autoGarbageCollect:!1});return new D({source:r,label:`texturePool_${go++}`})}getOptimalTexture(t,e,s=1,r){let n=Math.ceil(t*s-1e-6),a=Math.ceil(e*s-1e-6);n=se(n),a=se(a);const o=(n<<17)+(a<<1)+(r?1:0);this._texturePool[o]||(this._texturePool[o]=[]);let h=this._texturePool[o].pop();return h||(h=this.createTexture(n,a,r)),h.source._resolution=s,h.source.width=n/s,h.source.height=a/s,h.source.pixelWidth=n,h.source.pixelHeight=a,h.frame.x=0,h.frame.y=0,h.frame.width=t,h.frame.height=e,h.updateUvs(),this._poolKeyHash[h.uid]=o,h}getSameSizeTexture(t,e=!1){const s=t.source;return this.getOptimalTexture(t.width,t.height,s._resolution,e)}returnTexture(t,e=!1){const s=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[s].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const s=this._texturePool[e];if(s)for(let r=0;r<s.length;r++)s[r].destroy(!0)}this._texturePool={}}}const dn=new xo;We.register(dn);class yo{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new F,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new cn,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let s=0;s<e.length;s++){const r=e[s];r._updateFlags=15,this.addChild(r)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(dn.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let s=0;s<e.length;s++)this.addChild(e[s])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let s=0;s<e.length;s++)this.removeChild(e[s])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let s=0;s<e.length;s++)this._getChildren(e[s],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const s=t.children;for(let r=0;r<s.length;r++)this._getChildren(s[r],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new F),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new F),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new F),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function _o(i,t,e={}){for(const s in t)!e[s]&&t[s]!==void 0&&(i[s]=t[s])}const Ts=new Q(null),Xe=new Q(null),Ms=new Q(null,1,1),qe=new Q(null),Yi=1,bo=2,Ps=4;class xt extends mt{constructor(t={}){var e,s;super(),this.uid=X("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.parentRenderLayer=null,this.updateTick=-1,this.localTransform=new F,this.relativeGroupTransform=new F,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new Q(this,0,0),this._scale=Ms,this._pivot=Xe,this._origin=qe,this._skew=Ts,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],_o(this,t,{children:!0,parent:!0,effects:!0}),(e=t.children)==null||e.forEach(r=>this.addChild(r)),(s=t.parent)==null||s.addChild(this)}static mixin(t){R("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),tt.mixin(xt,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||R(z,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let r=0;r<t.length;r++)this.addChild(t[r]);return t[0]}const e=t[0],s=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),s&&(s.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,s&&s.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let r=0;r<t.length;r++)this.removeChild(t[r]);return t[0]}const e=t[0],s=this.children.indexOf(e);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,s),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),this.renderGroup=ht.get(yo,this),this.groupTransform=F.IDENTITY,t==null||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),ht.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t==null||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new F),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*Ba}set angle(t){this.rotation=t*Ra}get pivot(){return this._pivot===Xe&&(this._pivot=new Q(this,0,0)),this._pivot}set pivot(t){this._pivot===Xe&&(this._pivot=new Q(this,0,0),this._origin!==qe&&N("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===Ts&&(this._skew=new Q(this,0,0)),this._skew}set skew(t){this._skew===Ts&&(this._skew=new Q(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===Ms&&(this._scale=new Q(this,1,1)),this._scale}set scale(t){this._scale===Ms&&(this._scale=new Q(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===qe&&(this._origin=new Q(this,0,0)),this._origin}set origin(t){this._origin===qe&&(this._origin=new Q(this,0,0),this._pivot!==Xe&&N("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const s=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,s.width),e!==void 0&&this._setHeight(e,s.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,s=this._scale,r=this._pivot,n=this._origin,a=this._position,o=s._x,h=s._y,l=r._x,c=r._y,d=-n._x,f=-n._y;e.a=this._cx*o,e.b=this._sx*o,e.c=this._cy*h,e.d=this._sy*h,e.tx=a._x-(l*e.a+c*e.c)+(d*e.a+f*e.c)-d,e.ty=a._y-(l*e.b+c*e.d)+(d*e.b+f*e.d)-f}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Yi,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const s=q.shared.setValue(t??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=Yi,this._onUpdate())}get tint(){return ns(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=bo,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Ps,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=Ps,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=Ps,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){var r;if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t==null?void 0:t.children)&&e)for(let n=0;n<e.length;++n)e[n].destroy(t);(r=this.renderGroup)==null||r.destroy(),this.renderGroup=null}}tt.mixin(xt,eo,oo,mo,uo,co,ro,no,fo,Ka,Ja,ho,so);class fi extends xt{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new pt(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:s,y:r}=t;return s>=e.minX&&s<=e.maxX&&r>=e.minY&&r<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var e,s;super.destroy(t),this._bounds=null;for(const r in this._gpuData)(s=(e=this._gpuData[r]).destroy)==null||s.call(e);this._gpuData=null}collectRenderablesSimple(t,e,s){const{renderPipes:r}=e;r.blendMode.pushBlendMode(this,this.groupBlendMode,t),r[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const a=this.children,o=a.length;for(let h=0;h<o;h++)a[h].collectRenderables(t,e,s);r.blendMode.popBlendMode(t)}}class jt extends fi{constructor(t=D.EMPTY){t instanceof D&&(t={texture:t});const{texture:e=D.EMPTY,anchor:s,roundPixels:r,width:n,height:a,...o}=t;super({label:"Sprite",...o}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new Q({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=r??!1,n!==void 0&&(this.width=n),a!==void 0&&(this.height=a)}static from(t,e=!1){return t instanceof D?new jt(t):new jt(D.from(t,e))}set texture(t){t||(t=D.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return Wa(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return R("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,s=this._bounds,{width:r,height:n}=e.orig;s.minX=-t._x*r,s.maxX=s.minX+r,s.minY=-t._y*n,s.maxY=s.minY+n}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const wo=new pt;function un(i,t,e){const s=wo;i.measurable=!0,rn(i,e,s),t.addBoundsMask(s),i.measurable=!1}function fn(i,t,e){const s=Ct.get();i.measurable=!0;const r=st.get().identity(),n=pn(i,e,r);on(i,s,n),i.measurable=!1,t.addBoundsMask(s),st.return(r),Ct.return(s)}function pn(i,t,e){return i?(i!==t&&(pn(i.parent,t,e),i.updateLocalTransform(),e.append(i.localTransform)),e):(N("Mask bounds, renderable is not inside the root container"),e)}class mn{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof jt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask=null)}addBounds(t,e){this.inverse||un(this.mask,t,e)}addLocalBounds(t,e){fn(this.mask,t,e)}containsPoint(t,e){const s=this.mask;return e(s,t)}destroy(){this.reset()}static test(t){return t instanceof jt}}mn.extension=P.MaskEffect;class gn{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}gn.extension=P.MaskEffect;class xn{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask!==null&&(this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null)}addBounds(t,e){un(this.mask,t,e)}addLocalBounds(t,e){fn(this.mask,t,e)}containsPoint(t,e){const s=this.mask;return e(s,t)}destroy(){this.reset()}static test(t){return t instanceof xt}}xn.extension=P.MaskEffect;const vo={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")};let ji=vo;const U={get(){return ji},set(i){ji=i}};class yn extends gt{constructor(t){t.resource||(t.resource=U.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,s=this._resolution){const r=super.resize(t,e,s);return r&&this.resizeCanvas(),r}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}yn.extension=P.TextureSource;class Xt extends gt{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Xt.extension=P.TextureSource;var Zs=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Zs||{});class ks{constructor(t,e=null,s=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=s,this._once=r}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const _n=class rt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new ks(null,null,1/0),this.deltaMS=1/rt.targetFPMS,this.elapsedMS=1/rt.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=Zs.NORMAL){return this._addListener(new ks(t,e,s))}addOnce(t,e,s=Zs.NORMAL){return this._addListener(new ks(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(!e)t.connect(s);else{for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s.match(t,e)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=t-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=t-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*rt.targetFPMS;const s=this._head;let r=s.next;for(;r;)r=r.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,e)/1e3,rt.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!rt._shared){const t=rt._shared=new rt;t.autoStart=!0,t._protected=!0}return rt._shared}static get system(){if(!rt._system){const t=rt._system=new rt;t.autoStart=!0,t._protected=!0}return rt._system}};_n.targetFPMS=.06;let Ke=_n,Es;async function bn(){return Es??(Es=(async()=>{var a;const t=U.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(o=>{const h=document.createElement("video");h.onloadeddata=()=>o(h),h.onerror=()=>o(null),h.autoplay=!1,h.crossOrigin="anonymous",h.preload="auto",h.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",h.load()});if(!e)return"premultiply-alpha-on-upload";const s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const n=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,n),t.deleteFramebuffer(r),t.deleteTexture(s),(a=t.getExtension("WEBGL_lose_context"))==null||a.loseContext(),n[0]<=n[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),Es}const ps=class wn extends gt{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...wn.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Ke.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await bn(),this._load=new Promise((s,r)=>{this.isValid?s(this):(this._resolve=s,this._reject=r,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Ke.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Ke.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Ke.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};ps.extension=P.TextureSource;ps.defaultOptions={...gt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};ps.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Me=ps;const ut=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(s=>typeof s=="string"||e?t(s):s):i);class So{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||N(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const s=ut(t);let r;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.test(e)){r=l.getCacheableAssets(s,e);break}}const n=new Map(Object.entries(r||{}));r||s.forEach(h=>{n.set(h,e)});const a=[...n.keys()],o={cacheKeys:a,keys:s};s.forEach(h=>{this._cacheMap.set(h,o)}),a.forEach(h=>{const l=r?r[h]:e;this._cache.has(h)&&this._cache.get(h)!==l&&N("[Cache] already has key:",h),this._cache.set(h,n.get(h))})}remove(t){if(!this._cacheMap.has(t)){N(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const H=new So,Qs=[];tt.handleByList(P.TextureSource,Qs);function vn(i={}){const t=i&&i.resource,e=t?i.resource:i,s=t?i:{resource:i};for(let r=0;r<Qs.length;r++){const n=Qs[r];if(n.test(e))return new n(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function Ao(i={},t=!1){const e=i&&i.resource,s=e?i.resource:i,r=e?i:{resource:i};if(!t&&H.has(s))return H.get(s);const n=new D({source:vn(r)});return n.on("destroy",()=>{H.has(s)&&H.remove(s)}),t||H.set(s,n),n}function Co(i,t=!1){return typeof i=="string"?H.get(i):i instanceof gt?new D({source:i}):Ao(i,t)}D.from=Co;gt.from=vn;tt.add(mn,gn,xn,Me,Xt,yn,di);var Ft=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Ft||{});function ct(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function pe(i){return i.split("?")[0].split("#")[0]}function To(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Mo(i,t,e){return i.replace(new RegExp(To(t),"g"),e)}function Po(i,t){let e="",s=0,r=-1,n=0,a=-1;for(let o=0;o<=i.length;++o){if(o<i.length)a=i.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(r===o-1||n===1))if(r!==o-1&&n===2){if(e.length<2||s!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const h=e.lastIndexOf("/");if(h!==e.length-1){h===-1?(e="",s=0):(e=e.slice(0,h),s=e.length-1-e.lastIndexOf("/")),r=o,n=0;continue}}else if(e.length===2||e.length===1){e="",s=0,r=o,n=0;continue}}}else e.length>0?e+=`/${i.slice(r+1,o)}`:e=i.slice(r+1,o),s=o-r-1;r=o,n=0}else a===46&&n!==-1?++n:n=-1}return e}const nt={toPosix(i){return Mo(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){ct(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(ct(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const s=pe(this.toPosix(t??U.get().getBaseUrl())),r=pe(this.toPosix(e??this.rootname(s)));return i=this.toPosix(i),i.startsWith("/")?nt.join(r,i.slice(1)):this.isAbsolute(i)?i:this.join(s,i)},normalize(i){if(ct(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const s=i.endsWith("/");return i=Po(i),i.length>0&&s&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return ct(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const s=i[e];if(ct(s),s.length>0)if(t===void 0)t=s;else{const r=i[e-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?t+=`/../${s}`:t+=`/${s}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(ct(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let s=-1,r=!0;const n=this.getProtocol(i),a=i;i=i.slice(n.length);for(let o=i.length-1;o>=1;--o)if(t=i.charCodeAt(o),t===47){if(!r){s=o;break}}else r=!1;return s===-1?e?"/":this.isUrl(a)?n+i:n:e&&s===1?"//":n+i.slice(0,s)},rootname(i){ct(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){ct(i),t&&ct(t),i=pe(this.toPosix(i));let e=0,s=-1,r=!0,n;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let a=t.length-1,o=-1;for(n=i.length-1;n>=0;--n){const h=i.charCodeAt(n);if(h===47){if(!r){e=n+1;break}}else o===-1&&(r=!1,o=n+1),a>=0&&(h===t.charCodeAt(a)?--a===-1&&(s=n):(a=-1,s=o))}return e===s?s=o:s===-1&&(s=i.length),i.slice(e,s)}for(n=i.length-1;n>=0;--n)if(i.charCodeAt(n)===47){if(!r){e=n+1;break}}else s===-1&&(r=!1,s=n+1);return s===-1?"":i.slice(e,s)},extname(i){ct(i),i=pe(this.toPosix(i));let t=-1,e=0,s=-1,r=!0,n=0;for(let a=i.length-1;a>=0;--a){const o=i.charCodeAt(a);if(o===47){if(!r){e=a+1;break}continue}s===-1&&(r=!1,s=a+1),o===46?t===-1?t=a:n!==1&&(n=1):t!==-1&&(n=-1)}return t===-1||s===-1||n===0||n===1&&t===s-1&&t===e+1?"":i.slice(t,s)},parse(i){ct(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=pe(this.toPosix(i));let e=i.charCodeAt(0);const s=this.isAbsolute(i);let r;t.root=this.rootname(i),s||this.hasProtocol(i)?r=1:r=0;let n=-1,a=0,o=-1,h=!0,l=i.length-1,c=0;for(;l>=r;--l){if(e=i.charCodeAt(l),e===47){if(!h){a=l+1;break}continue}o===-1&&(h=!1,o=l+1),e===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||o===-1||c===0||c===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&s?t.base=t.name=i.slice(1,o):t.base=t.name=i.slice(a,o)):(a===0&&s?(t.name=i.slice(1,n),t.base=i.slice(1,o)):(t.name=i.slice(a,n),t.base=i.slice(a,o)),t.ext=i.slice(n,o)),t.dir=this.dirname(i),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function Sn(i,t,e,s,r){const n=t[e];for(let a=0;a<n.length;a++){const o=n[a];e<t.length-1?Sn(i.replace(s[e],o),t,e+1,s,r):r.push(i.replace(s[e],o))}}function ko(i){const t=/\{(.*?)\}/g,e=i.match(t),s=[];if(e){const r=[];e.forEach(n=>{const a=n.substring(1,n.length-1).split(",");r.push(a)}),Sn(i,r,0,e,s)}else s.push(i);return s}const hs=i=>!Array.isArray(i);class ae{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`).join("&")}}getAlias(t){const{alias:e,src:s}=t;return ut(e||s,n=>typeof n=="string"?n:Array.isArray(n)?n.map(a=>(a==null?void 0:a.src)??a):n!=null&&n.src?n.src:n,!0)}addManifest(t){this._manifest&&N("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const s=[];let r=e;Array.isArray(e)||(r=Object.entries(e).map(([n,a])=>typeof a=="string"||Array.isArray(a)?{alias:n,src:a}:{alias:n,...a})),r.forEach(n=>{const a=n.src,o=n.alias;let h;if(typeof o=="string"){const l=this._createBundleAssetId(t,o);s.push(l),h=[o,l]}else{const l=o.map(c=>this._createBundleAssetId(t,c));s.push(...l),h=[...o,...l]}this.add({...n,alias:h,src:a})}),this._bundles[t]=s}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let s;s=n=>{this.hasKey(n)&&N(`[Resolver] already has key: ${n} overwriting`)},ut(e).forEach(n=>{const{src:a}=n;let{data:o,format:h,loadParser:l,parser:c}=n;const d=ut(a).map(m=>typeof m=="string"?ko(m):Array.isArray(m)?m:[m]),f=this.getAlias(n);Array.isArray(f)?f.forEach(s):s(f);const u=[];d.forEach(m=>{m.forEach(g=>{let p={};if(typeof g!="object"){p.src=g;for(let x=0;x<this._parsers.length;x++){const y=this._parsers[x];if(y.test(g)){p=y.parse(g);break}}}else o=g.data??o,h=g.format??h,(g.loadParser||g.parser)&&(l=g.loadParser??l,c=g.parser??c),p={...p,...g};if(!f)throw new Error(`[Resolver] alias is undefined for this asset: ${p.src}`);p=this._buildResolvedAsset(p,{aliases:f,data:o,format:h,loadParser:l,parser:c,progressSize:n.progressSize}),u.push(p)})}),f.forEach(m=>{this._assetMap[m]=u})})}resolveBundle(t){const e=hs(t);t=ut(t);const s={};return t.forEach(r=>{const n=this._bundles[r];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(r,h)]=l}s[r]=o}}),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const s={};for(const r in e)s[r]=e[r].src;return s}return e.src}resolve(t){const e=hs(t);t=ut(t);const s={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const a=this._getPreferredOrder(n);a==null||a.priority.forEach(o=>{a.params[o].forEach(h=>{const l=n.filter(c=>c[o]?c[o]===h:!1);l.length&&(n=l)})}),this._resolverHash[r]=n[0]}else this._resolverHash[r]=this._buildResolvedAsset({alias:[r],src:r},{});s[r]=this._resolverHash[r]}),e?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const s=t[e],r=this._preferredOrder.find(n=>n.params.format.includes(s.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:s,data:r,loadParser:n,parser:a,format:o,progressSize:h}=e;return(this._basePath||this._rootPath)&&(t.src=nt.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=s??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=n??t.loadParser,t.parser=a??t.parser,t.format=o??t.format??Eo(t.src),h!==void 0&&(t.progressSize=h),t}}ae.RETINA_PREFIX=/@([0-9\.]+)x/;function Eo(i){return i.split(".").pop().split("?").shift().split("#").shift()}const Js=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i},An=class we{constructor(t,e){this.linkedSheets=[];let s=t;(t==null?void 0:t.source)instanceof gt&&(s={texture:t,data:e});const{texture:r,data:n,cachePrefix:a=""}=s;this.cachePrefix=a,this._texture=r instanceof D?r:null,this.textureSource=r.source,this.textures={},this.animations={},this.data=n;const o=parseFloat(n.meta.scale);o?(this.resolution=o,r.source.resolution=this.resolution):this.resolution=r.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=we.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const s=we.BATCH_SIZE;for(;e-t<s&&e<this._frameKeys.length;){const r=this._frameKeys[e],n=this._frames[r],a=n.frame;if(a){let o=null,h=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new V(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?o=new V(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new V(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new V(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[r]=new D({source:this.textureSource,frame:o,orig:c,trim:h,rotate:n.rotated?2:0,defaultAnchor:n.anchor,defaultBorders:n.borders,label:r.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let s=0;s<t[e].length;s++){const r=t[e][s];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*we.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*we.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};An.BATCH_SIZE=1e3;let Xi=An;const Io=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Cn(i,t,e){const s={};if(i.forEach(r=>{s[r]=t}),Object.keys(t.textures).forEach(r=>{s[`${t.cachePrefix}${r}`]=t.textures[r]}),!e){const r=nt.dirname(i[0]);t.linkedSheets.forEach((n,a)=>{const o=Cn([`${r}/${t.data.meta.related_multi_packs[a]}`],n,!0);Object.assign(s,o)})}return s}const Bo={extension:P.Asset,cache:{test:i=>i instanceof Xi,getCacheableAssets:(i,t)=>Cn(i,t,!1)},resolver:{extension:{type:P.ResolveParser,name:"resolveSpritesheet"},test:i=>{const e=i.split("?")[0].split("."),s=e.pop(),r=e.pop();return s==="json"&&Io.includes(r)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=ae.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:P.LoadParser,priority:Ft.Normal,name:"spritesheetLoader"},async testParse(i,t){return nt.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var d,f;const{texture:s,imageFilename:r,textureOptions:n,cachePrefix:a}=(t==null?void 0:t.data)??{};let o=nt.dirname(t.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let h;if(s instanceof D)h=s;else{const u=Js(o+(r??i.meta.image),t.src);h=(await e.load([{src:u,data:n}]))[u]}const l=new Xi({texture:h.source,data:i,cachePrefix:a});await l.parse();const c=(d=i==null?void 0:i.meta)==null?void 0:d.related_multi_packs;if(Array.isArray(c)){const u=[];for(const g of c){if(typeof g!="string")continue;let p=o+g;(f=t.data)!=null&&f.ignoreMultiPack||(p=Js(p,t.src),u.push(e.load({src:p,data:{textureOptions:n,ignoreMultiPack:!0}})))}const m=await Promise.all(u);l.linkedSheets=m,m.forEach(g=>{g.linkedSheets=[l].concat(l.linkedSheets.filter(p=>p!==g))})}return l},async unload(i,t,e){await e.unload(i.textureSource._sourceOrigin),i.destroy(!1)}}};tt.add(Bo);const Is=Object.create(null),qi=Object.create(null);function pi(i,t){let e=qi[i];return e===void 0&&(Is[t]===void 0&&(Is[t]=1),qi[i]=e=Is[t]++),e}let Kt;function Tn(){return(!Kt||Kt!=null&&Kt.isContextLost())&&(Kt=U.get().createCanvas().getContext("webgl",{})),Kt}let Ze;function Ro(){if(!Ze){Ze="mediump";const i=Tn();i&&i.getShaderPrecisionFormat&&(Ze=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?"highp":"mediump")}return Ze}function Fo(i,t,e){return t?i:e?(i=i.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${i}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${i}
        `}function Lo(i,t,e){const s=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(i.substring(0,9)!=="precision"){let r=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return r==="highp"&&s!=="highp"&&(r="mediump"),`precision ${r} float;
${i}`}else if(s!=="highp"&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}function Do(i,t){return t?`#version 300 es
${i}`:i}const Oo={},Go={};function zo(i,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const s=e?Oo:Go;return s[t]?(s[t]++,t+=`-${s[t]}`):s[t]=1,i.indexOf("#define SHADER_NAME")!==-1?i:`${`#define SHADER_NAME ${t}`}
${i}`}function Wo(i,t){return t?i.replace("#version 300 es",""):i}const Bs={stripVersion:Wo,ensurePrecision:Lo,addProgramDefines:Fo,setProgramName:zo,insertVersion:Do},me=Object.create(null),Mn=class ti{constructor(t){t={...ti.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Ro()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let r=t.fragment,n=t.vertex;Object.keys(Bs).forEach(a=>{const o=s[a];r=Bs[a](r,o,!0),n=Bs[a](n,o,!1)}),this.fragment=r,this.vertex=n,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=pi(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,me[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return me[e]||(me[e]=new ti(t),me[e]._cacheKey=e),me[e]}};Mn.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let Pn=Mn;const Ki={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function Uo(i){return Ki[i]??Ki.float32}const $o={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function Ho({source:i,entryPoint:t}){const e={},s=i.indexOf(`fn ${t}`);if(s!==-1){const r=i.indexOf("->",s);if(r!==-1){const n=i.substring(s,r),a=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let o;for(;(o=a.exec(n))!==null;){const h=$o[o[3]]??"float32";e[o[2]]={location:parseInt(o[1],10),format:h,stride:Uo(h).stride,offset:0,instance:!1,start:0}}}}return e}function Rs(i){var d,f;const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,r=/var(<[^>]+>)? (\w+)/,n=/:\s*(\w+)/,a=/struct\s+(\w+)\s*{([^}]+)}/g,o=/(\w+)\s*:\s*([\w\<\>]+)/g,h=/struct\s+(\w+)/,l=(d=i.match(t))==null?void 0:d.map(u=>({group:parseInt(u.match(e)[1],10),binding:parseInt(u.match(s)[1],10),name:u.match(r)[2],isUniform:u.match(r)[1]==="<uniform>",type:u.match(n)[1]}));if(!l)return{groups:[],structs:[]};const c=((f=i.match(a))==null?void 0:f.map(u=>{const m=u.match(h)[1],g=u.match(o).reduce((p,x)=>{const[y,_]=x.split(":");return p[y.trim()]=_.trim(),p},{});return g?{name:m,members:g}:null}).filter(({name:u})=>l.some(m=>m.type===u)))??[];return{groups:l,structs:c}}var ve=(i=>(i[i.VERTEX=1]="VERTEX",i[i.FRAGMENT=2]="FRAGMENT",i[i.COMPUTE=4]="COMPUTE",i))(ve||{});function No({groups:i}){const t=[];for(let e=0;e<i.length;e++){const s=i[e];t[s.group]||(t[s.group]=[]),s.isUniform?t[s.group].push({binding:s.binding,visibility:ve.VERTEX|ve.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?t[s.group].push({binding:s.binding,visibility:ve.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"&&t[s.group].push({binding:s.binding,visibility:ve.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function Vo({groups:i}){const t=[];for(let e=0;e<i.length;e++){const s=i[e];t[s.group]||(t[s.group]={}),t[s.group][s.name]=s.binding}return t}function Yo(i,t){const e=new Set,s=new Set,r=[...i.structs,...t.structs].filter(a=>e.has(a.name)?!1:(e.add(a.name),!0)),n=[...i.groups,...t.groups].filter(a=>{const o=`${a.name}-${a.binding}`;return s.has(o)?!1:(s.add(o),!0)});return{structs:r,groups:n}}const ge=Object.create(null);class ms{constructor(t){var o,h;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:s,layout:r,gpuLayout:n,name:a}=t;if(this.name=a,this.fragment=e,this.vertex=s,e.source===s.source){const l=Rs(e.source);this.structsAndGroups=l}else{const l=Rs(s.source),c=Rs(e.source);this.structsAndGroups=Yo(l,c)}this.layout=r??Vo(this.structsAndGroups),this.gpuLayout=n??No(this.structsAndGroups),this.autoAssignGlobalUniforms=((o=this.layout[0])==null?void 0:o.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((h=this.layout[1])==null?void 0:h.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,s=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=pi(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=Ho(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ge[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return ge[e]||(ge[e]=new ms(t),ge[e]._cacheKey=e),ge[e]}}const kn=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],jo=kn.reduce((i,t)=>(i[t]=!0,i),{});function Xo(i,t){switch(i){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const En=class In{constructor(t,e){this._touched=0,this.uid=X("uniform"),this._resourceType="uniformGroup",this._resourceId=X("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...In.defaultOptions,...e},this.uniformStructures=t;const s={};for(const r in t){const n=t[r];if(n.name=r,n.size=n.size??1,!jo[n.type]){const a=n.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(a){const[,o,h]=a;throw new Error(`Uniform type ${n.type} is not supported. Use type: '${o}', size: ${h} instead.`)}throw new Error(`Uniform type ${n.type} is not supported. Supported uniform types are: ${kn.join(", ")}`)}n.value??(n.value=Xo(n.type,n.size)),s[r]=n.value}this.uniforms=s,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=pi(Object.keys(s).map(r=>`${r}-${t[r].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};En.defaultOptions={ubo:!1,isStatic:!1};let Bn=En;class as{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const s in t){const r=t[s];this.setResource(r,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const s in this.resources)t[e++]=this.resources[s]._resourceId;this._key=t.join("|")}setResource(t,e){var r,n;const s=this.resources[e];t!==s&&(s&&((r=t.off)==null||r.call(t,"change",this.onResourceChange,this)),(n=t.on)==null||n.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const s in e)e[s]._touched=t}destroy(){var e;const t=this.resources;for(const s in t){const r=t[s];(e=r==null?void 0:r.off)==null||e.call(r,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const s in e)e[s]===t&&(e[s]=null)}else this._updateKey()}}var ei=(i=>(i[i.WEBGL=1]="WEBGL",i[i.WEBGPU=2]="WEBGPU",i[i.BOTH=3]="BOTH",i))(ei||{});class mi extends mt{constructor(t){super(),this.uid=X("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:s,groups:r,resources:n,compatibleRenderers:a,groupMap:o}=t;this.gpuProgram=e,this.glProgram=s,a===void 0&&(a=0,e&&(a|=ei.WEBGPU),s&&(a|=ei.WEBGL)),this.compatibleRenderers=a;const h={};if(!n&&!r&&(n={}),n&&r)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&r&&!o)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&r&&o)for(const l in o)for(const c in o[l]){const d=o[l][c];h[d]={group:l,binding:c,name:d}}else if(e&&r&&!o){const l=e.structsAndGroups.groups;o={},l.forEach(c=>{o[c.group]=o[c.group]||{},o[c.group][c.binding]=c.name,h[c.name]=c})}else if(n){r={},o={},e&&e.structsAndGroups.groups.forEach(d=>{o[d.group]=o[d.group]||{},o[d.group][d.binding]=d.name,h[d.name]=d});let l=0;for(const c in n)h[c]||(r[99]||(r[99]=new as,this._ownedBindGroups.push(r[99])),h[c]={group:99,binding:l,name:c},o[99]=o[99]||{},o[99][l]=c,l++);for(const c in n){const d=c;let f=n[c];!f.source&&!f._resourceType&&(f=new Bn(f));const u=h[d];u&&(r[u.group]||(r[u.group]=new as,this._ownedBindGroups.push(r[u.group])),r[u.group].setResource(f,u.binding))}}this.groups=r,this._uniformBindMap=o,this.resources=this._buildResourceAccessor(r,h)}addResource(t,e,s){var r,n;(r=this._uniformBindMap)[e]||(r[e]={}),(n=this._uniformBindMap[e])[s]||(n[s]=t),this.groups[e]||(this.groups[e]=new as,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const s={};for(const r in e){const n=e[r];Object.defineProperty(s,n.name,{get(){return t[n.group].getResource(n.binding)},set(a){t[n.group].setResource(a,n.binding)}})}return s}destroy(t=!1){var e,s;this.emit("destroy",this),t&&((e=this.gpuProgram)==null||e.destroy(),(s=this.glProgram)==null||s.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(r=>{r.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:s,...r}=t;let n,a;return e&&(n=ms.from(e)),s&&(a=Pn.from(s)),new mi({gpuProgram:n,glProgram:a,...r})}}const si=[];tt.handleByNamedList(P.Environment,si);async function qo(i){if(!i)for(let t=0;t<si.length;t++){const e=si[t];if(e.value.test()){await e.value.load();return}}}let xe;function Ko(){if(typeof xe=="boolean")return xe;try{xe=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{xe=!1}return xe}function Zi(i,t,e=2){const s=t&&t.length,r=s?t[0]*e:i.length;let n=Rn(i,0,r,e,!0);const a=[];if(!n||n.next===n.prev)return a;let o,h,l;if(s&&(n=eh(i,t,n,e)),i.length>80*e){o=i[0],h=i[1];let c=o,d=h;for(let f=e;f<r;f+=e){const u=i[f],m=i[f+1];u<o&&(o=u),m<h&&(h=m),u>c&&(c=u),m>d&&(d=m)}l=Math.max(c-o,d-h),l=l!==0?32767/l:0}return Re(n,a,e,o,h,l,0),a}function Rn(i,t,e,s,r){let n;if(r===uh(i,t,e,s)>0)for(let a=t;a<e;a+=s)n=Qi(a/s|0,i[a],i[a+1],n);else for(let a=e-s;a>=t;a-=s)n=Qi(a/s|0,i[a],i[a+1],n);return n&&ne(n,n.next)&&(Le(n),n=n.next),n}function qt(i,t){if(!i)return i;t||(t=i);let e=i,s;do if(s=!1,!e.steiner&&(ne(e,e.next)||Y(e.prev,e,e.next)===0)){if(Le(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function Re(i,t,e,s,r,n,a){if(!i)return;!a&&n&&ah(i,s,r,n);let o=i;for(;i.prev!==i.next;){const h=i.prev,l=i.next;if(n?Qo(i,s,r,n):Zo(i)){t.push(h.i,i.i,l.i),Le(i),i=l.next,o=l.next;continue}if(i=l,i===o){a?a===1?(i=Jo(qt(i),t),Re(i,t,e,s,r,n,2)):a===2&&th(i,t,e,s,r,n):Re(qt(i),t,e,s,r,n,1);break}}}function Zo(i){const t=i.prev,e=i,s=i.next;if(Y(t,e,s)>=0)return!1;const r=t.x,n=e.x,a=s.x,o=t.y,h=e.y,l=s.y,c=Math.min(r,n,a),d=Math.min(o,h,l),f=Math.max(r,n,a),u=Math.max(o,h,l);let m=s.next;for(;m!==t;){if(m.x>=c&&m.x<=f&&m.y>=d&&m.y<=u&&Se(r,o,n,h,a,l,m.x,m.y)&&Y(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Qo(i,t,e,s){const r=i.prev,n=i,a=i.next;if(Y(r,n,a)>=0)return!1;const o=r.x,h=n.x,l=a.x,c=r.y,d=n.y,f=a.y,u=Math.min(o,h,l),m=Math.min(c,d,f),g=Math.max(o,h,l),p=Math.max(c,d,f),x=ii(u,m,t,e,s),y=ii(g,p,t,e,s);let _=i.prevZ,b=i.nextZ;for(;_&&_.z>=x&&b&&b.z<=y;){if(_.x>=u&&_.x<=g&&_.y>=m&&_.y<=p&&_!==r&&_!==a&&Se(o,c,h,d,l,f,_.x,_.y)&&Y(_.prev,_,_.next)>=0||(_=_.prevZ,b.x>=u&&b.x<=g&&b.y>=m&&b.y<=p&&b!==r&&b!==a&&Se(o,c,h,d,l,f,b.x,b.y)&&Y(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;_&&_.z>=x;){if(_.x>=u&&_.x<=g&&_.y>=m&&_.y<=p&&_!==r&&_!==a&&Se(o,c,h,d,l,f,_.x,_.y)&&Y(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=y;){if(b.x>=u&&b.x<=g&&b.y>=m&&b.y<=p&&b!==r&&b!==a&&Se(o,c,h,d,l,f,b.x,b.y)&&Y(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Jo(i,t){let e=i;do{const s=e.prev,r=e.next.next;!ne(s,r)&&Ln(s,e,e.next,r)&&Fe(s,r)&&Fe(r,s)&&(t.push(s.i,e.i,r.i),Le(e),Le(e.next),e=i=r),e=e.next}while(e!==i);return qt(e)}function th(i,t,e,s,r,n){let a=i;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&lh(a,o)){let h=Dn(a,o);a=qt(a,a.next),h=qt(h,h.next),Re(a,t,e,s,r,n,0),Re(h,t,e,s,r,n,0);return}o=o.next}a=a.next}while(a!==i)}function eh(i,t,e,s){const r=[];for(let n=0,a=t.length;n<a;n++){const o=t[n]*s,h=n<a-1?t[n+1]*s:i.length,l=Rn(i,o,h,s,!1);l===l.next&&(l.steiner=!0),r.push(hh(l))}r.sort(sh);for(let n=0;n<r.length;n++)e=ih(r[n],e);return e}function sh(i,t){let e=i.x-t.x;if(e===0&&(e=i.y-t.y,e===0)){const s=(i.next.y-i.y)/(i.next.x-i.x),r=(t.next.y-t.y)/(t.next.x-t.x);e=s-r}return e}function ih(i,t){const e=rh(i,t);if(!e)return t;const s=Dn(e,i);return qt(s,s.next),qt(e,e.next)}function rh(i,t){let e=t;const s=i.x,r=i.y;let n=-1/0,a;if(ne(i,e))return e;do{if(ne(i,e.next))return e.next;if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const d=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(d<=s&&d>n&&(n=d,a=e.x<e.next.x?e:e.next,d===s))return a}e=e.next}while(e!==t);if(!a)return null;const o=a,h=a.x,l=a.y;let c=1/0;e=a;do{if(s>=e.x&&e.x>=h&&s!==e.x&&Fn(r<l?s:n,r,h,l,r<l?n:s,r,e.x,e.y)){const d=Math.abs(r-e.y)/(s-e.x);Fe(e,i)&&(d<c||d===c&&(e.x>a.x||e.x===a.x&&nh(a,e)))&&(a=e,c=d)}e=e.next}while(e!==o);return a}function nh(i,t){return Y(i.prev,i,t.prev)<0&&Y(t.next,i,i.next)<0}function ah(i,t,e,s){let r=i;do r.z===0&&(r.z=ii(r.x,r.y,t,e,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==i);r.prevZ.nextZ=null,r.prevZ=null,oh(r)}function oh(i){let t,e=1;do{let s=i,r;i=null;let n=null;for(t=0;s;){t++;let a=s,o=0;for(let l=0;l<e&&(o++,a=a.nextZ,!!a);l++);let h=e;for(;o>0||h>0&&a;)o!==0&&(h===0||!a||s.z<=a.z)?(r=s,s=s.nextZ,o--):(r=a,a=a.nextZ,h--),n?n.nextZ=r:i=r,r.prevZ=n,n=r;s=a}n.nextZ=null,e*=2}while(t>1);return i}function ii(i,t,e,s,r){return i=(i-e)*r|0,t=(t-s)*r|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function hh(i){let t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Fn(i,t,e,s,r,n,a,o){return(r-a)*(t-o)>=(i-a)*(n-o)&&(i-a)*(s-o)>=(e-a)*(t-o)&&(e-a)*(n-o)>=(r-a)*(s-o)}function Se(i,t,e,s,r,n,a,o){return!(i===a&&t===o)&&Fn(i,t,e,s,r,n,a,o)}function lh(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!ch(i,t)&&(Fe(i,t)&&Fe(t,i)&&dh(i,t)&&(Y(i.prev,i,t.prev)||Y(i,t.prev,t))||ne(i,t)&&Y(i.prev,i,i.next)>0&&Y(t.prev,t,t.next)>0)}function Y(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function ne(i,t){return i.x===t.x&&i.y===t.y}function Ln(i,t,e,s){const r=Je(Y(i,t,e)),n=Je(Y(i,t,s)),a=Je(Y(e,s,i)),o=Je(Y(e,s,t));return!!(r!==n&&a!==o||r===0&&Qe(i,e,t)||n===0&&Qe(i,s,t)||a===0&&Qe(e,i,s)||o===0&&Qe(e,t,s))}function Qe(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Je(i){return i>0?1:i<0?-1:0}function ch(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Ln(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function Fe(i,t){return Y(i.prev,i,i.next)<0?Y(i,t,i.next)>=0&&Y(i,i.prev,t)>=0:Y(i,t,i.prev)<0||Y(i,i.next,t)<0}function dh(i,t){let e=i,s=!1;const r=(i.x+t.x)/2,n=(i.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&r<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==i);return s}function Dn(i,t){const e=ri(i.i,i.x,i.y),s=ri(t.i,t.x,t.y),r=i.next,n=t.prev;return i.next=t,t.prev=i,e.next=r,r.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}function Qi(i,t,e,s){const r=ri(i,t,e);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Le(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ri(i,t,e){return{i,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function uh(i,t,e,s){let r=0;for(let n=t,a=e-s;n<e;n+=s)r+=(i[a]-i[n])*(i[n+1]+i[a+1]),a=n;return r}const fh=Zi.default||Zi;var On=(i=>(i[i.NONE=0]="NONE",i[i.COLOR=16384]="COLOR",i[i.STENCIL=1024]="STENCIL",i[i.DEPTH=256]="DEPTH",i[i.COLOR_DEPTH=16640]="COLOR_DEPTH",i[i.COLOR_STENCIL=17408]="COLOR_STENCIL",i[i.DEPTH_STENCIL=1280]="DEPTH_STENCIL",i[i.ALL=17664]="ALL",i))(On||{});class ph{constructor(t){this.items=[],this._name=t}emit(t,e,s,r,n,a,o,h){const{name:l,items:c}=this;for(let d=0,f=c.length;d<f;d++)c[d][l](t,e,s,r,n,a,o,h);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const mh=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Gn=class zn extends mt{constructor(t){super(),this.uid=X("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...mh,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await qo(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const s in this._systemsHash)t={...this._systemsHash[s].constructor.defaultOptions,...t};t={...zn.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let s=0;s<this.runners.init.items.length;s++)await this.runners.init.items[s].init(t);this._initOptions=t}render(t,e){let s=t;if(s instanceof xt&&(s={container:s},e&&(R(z,"passing a second argument is deprecated, please use render options instead"),s.target=e.renderTexture)),s.target||(s.target=this.view.renderTarget),s.target===this.view.renderTarget&&(this._lastObjectRendered=s.container,s.clearColor??(s.clearColor=this.background.colorRgba),s.clear??(s.clear=this.background.clearBeforeRender)),s.clearColor){const r=Array.isArray(s.clearColor)&&s.clearColor.length===4;s.clearColor=r?s.clearColor:q.shared.setValue(s.clearColor).toArray()}s.transform||(s.container.updateLocalTransform(),s.transform=s.container.localTransform),s.container.visible&&(s.container.enableRenderGroup(),this.runners.prerender.emit(s),this.runners.renderStart.emit(s),this.runners.render.emit(s),this.runners.renderEnd.emit(s),this.runners.postrender.emit(s))}resize(t,e,s){const r=this.view.resolution;this.view.resize(t,e,s),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),s!==void 0&&s!==r&&this.runners.resolutionChange.emit(s)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=On.ALL);const{clear:s,clearColor:r,target:n}=t;q.shared.setValue(r??this.background.colorRgba),e.renderTarget.clear(n,s,q.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new ph(e)})}_addSystems(t){let e;for(e in t){const s=t[e];this._addSystem(s.value,s.name)}}_addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const r in this.runners)this.runners[r].add(s);return this}_addPipes(t,e){const s=e.reduce((r,n)=>(r[n.name]=n.value,r),{});t.forEach(r=>{const n=r.value,a=r.name,o=s[a];this.renderPipes[a]=new n(this,o?new o:null),this.runners.destroy.add(this.renderPipes[a])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(e=>{e.destroy()}),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&We.release(),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!Ko())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Gn.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let Wn=Gn,ts;function gh(i){return ts!==void 0||(ts=(()=>{var e;const t={stencil:!0,failIfMajorPerformanceCaveat:i??Wn.defaultOptions.failIfMajorPerformanceCaveat};try{if(!U.get().getWebGLRenderingContext())return!1;let r=U.get().createCanvas().getContext("webgl",t);const n=!!((e=r==null?void 0:r.getContextAttributes())!=null&&e.stencil);if(r){const a=r.getExtension("WEBGL_lose_context");a&&a.loseContext()}return r=null,n}catch{return!1}})()),ts}let es;async function xh(i={}){return es!==void 0||(es=await(async()=>{const t=U.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(i)).requestDevice(),!0}catch{return!1}})()),es}const Ji=["webgl","webgpu","canvas"];async function yh(i){let t=[];i.preference?(t.push(i.preference),Ji.forEach(n=>{n!==i.preference&&t.push(n)})):t=Ji.slice();let e,s={};for(let n=0;n<t.length;n++){const a=t[n];if(a==="webgpu"&&await xh()){const{WebGPURenderer:o}=await Be(async()=>{const{WebGPURenderer:h}=await import("./WebGPURenderer-CvFuZXVi.js");return{WebGPURenderer:h}},__vite__mapDeps([3,2,4]));e=o,s={...i,...i.webgpu};break}else if(a==="webgl"&&gh(i.failIfMajorPerformanceCaveat??Wn.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:o}=await Be(async()=>{const{WebGLRenderer:h}=await import("./WebGLRenderer-BKkLpvl-.js");return{WebGLRenderer:h}},__vite__mapDeps([5,2,4]));e=o,s={...i,...i.webgl};break}else if(a==="canvas")throw s={...i},new Error("CanvasRenderer is not yet implemented")}if(delete s.webgpu,delete s.webgl,!e)throw new Error("No available renderer for the current environment");const r=new e;return await r.init(s),r}const Un="8.14.1";class $n{static init(){var t;(t=globalThis.__PIXI_APP_INIT__)==null||t.call(globalThis,this,Un)}static destroy(){}}$n.extension=P.Application;class _h{constructor(t){this._renderer=t}init(){var t;(t=globalThis.__PIXI_RENDERER_INIT__)==null||t.call(globalThis,this._renderer,Un)}destroy(){this._renderer=null}}_h.extension={type:[P.WebGLSystem,P.WebGPUSystem],name:"initHook",priority:-10};const Hn=class ni{constructor(...t){this.stage=new xt,t[0]!==void 0&&R(z,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await yh(t),ni._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return R(z,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const s=ni._plugins.slice(0);s.reverse(),s.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Hn._plugins=[];let Nn=Hn;tt.handleByList(P.Application,Nn._plugins);tt.add($n);class Vn extends mt{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return R(z,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return R(z,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return R(z,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return R(z,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return R(z,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const s in this.chars)(e=this.chars[s].texture)==null||e.destroy();this.chars=null,t&&(this.pages.forEach(s=>s.texture.destroy(!0)),this.pages=null)}}/**
 * tiny-lru
 *
 * @copyright 2025 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.4.5
 */class bh{constructor(t=0,e=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=s,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,s=this.resetTtl){let r=null;if(this.has(t))this.set(t,e,!0,s);else{this.max>0&&this.size===this.max&&(r={...this.first},this.evict(!0));let n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=n:this.last.next=n,this.last=n}return r}set(t,e,s=!1,r=this.resetTtl){let n=this.items[t];return s||n!==void 0?(n.value=e,s===!1&&r&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(n)):(this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=n:this.last.next=n,this.last=n),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function Yn(i=1e3,t=0,e=!1){if(isNaN(i)||i<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new bh(i,t,e)}const wh=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function ls(i){const t=typeof i.fontSize=="number"?`${i.fontSize}px`:i.fontSize;let e=i.fontFamily;Array.isArray(i.fontFamily)||(e=i.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let r=e[s].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!wh.includes(r)&&(r=`"${r}"`),e[s]=r}return`${i.fontStyle} ${i.fontVariant} ${i.fontWeight} ${t} ${e.join(",")}`}const Fs={willReadFrequently:!0},yt=class M{static get experimentalLetterSpacingSupported(){let t=M._experimentalLetterSpacingSupported;if(t===void 0){const e=U.get().getCanvasRenderingContext2D().prototype;t=M._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,s,r,n,a,o,h,l){this.text=t,this.style=e,this.width=s,this.height=r,this.lines=n,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=h,this.fontProperties=l}static measureText(t=" ",e,s=M._canvas,r=e.wordWrap){var y;const n=`${t}-${e.styleKey}-wordWrap-${r}`;if(M._measurementCache.has(n))return M._measurementCache.get(n);const a=ls(e),o=M.measureFont(a);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);const h=M.__context;h.font=a;const c=(r?M._wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),d=new Array(c.length);let f=0;for(let _=0;_<c.length;_++){const b=M._measureText(c[_],e.letterSpacing,h);d[_]=b,f=Math.max(f,b)}const u=((y=e._stroke)==null?void 0:y.width)||0;let m=f+u;e.dropShadow&&(m+=e.dropShadow.distance);const g=e.lineHeight||o.fontSize;let p=Math.max(g,o.fontSize+u)+(c.length-1)*(g+e.leading);e.dropShadow&&(p+=e.dropShadow.distance);const x=new M(t,e,m,p,c,d,g+e.leading,f,o);return M._measurementCache.set(n,x),x}static _measureText(t,e,s){let r=!1;M.experimentalLetterSpacingSupported&&(M.experimentalLetterSpacing?(s.letterSpacing=`${e}px`,s.textLetterSpacing=`${e}px`,r=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));const n=s.measureText(t);let a=n.width;const o=-n.actualBoundingBoxLeft;let l=n.actualBoundingBoxRight-o;if(a>0)if(r)a-=e,l-=e;else{const c=(M.graphemeSegmenter(t).length-1)*e;a+=c,l+=c}return Math.max(a,l)}static _wordWrap(t,e,s=M._canvas){const r=s.getContext("2d",Fs);let n=0,a="",o="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,d=M._collapseSpaces(c),f=M._collapseNewlines(c);let u=!d;const m=e.wordWrapWidth+l,g=M._tokenize(t);for(let p=0;p<g.length;p++){let x=g[p];if(M._isNewline(x)){if(!f){o+=M._addLine(a),u=!d,a="",n=0;continue}x=" "}if(d){const _=M.isBreakingSpace(x),b=M.isBreakingSpace(a[a.length-1]);if(_&&b)continue}const y=M._getFromCache(x,l,h,r);if(y>m)if(a!==""&&(o+=M._addLine(a),a="",n=0),M.canBreakWords(x,e.breakWords)){const _=M.wordWrapSplit(x);for(let b=0;b<_.length;b++){let S=_[b],v=S,w=1;for(;_[b+w];){const k=_[b+w];if(!M.canBreakChars(v,k,x,b,e.breakWords))S+=k;else break;v=k,w++}b+=w-1;const E=M._getFromCache(S,l,h,r);E+n>m&&(o+=M._addLine(a),u=!1,a="",n=0),a+=S,n+=E}}else{a.length>0&&(o+=M._addLine(a),a="",n=0);const _=p===g.length-1;o+=M._addLine(x,!_),u=!1,a="",n=0}else y+n>m&&(u=!1,o+=M._addLine(a),a="",n=0),(a.length>0||!M.isBreakingSpace(x)||u)&&(a+=x,n+=y)}return o+=M._addLine(a,!1),o}static _addLine(t,e=!0){return t=M._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,s,r){let n=s[t];return typeof n!="number"&&(n=M._measureText(t,e,r)+e,s[t]=n),n}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const s=t[e];if(!M.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:M._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:M._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let s="";if(typeof t!="string")return e;for(let r=0;r<t.length;r++){const n=t[r],a=t[r+1];if(M.isBreakingSpace(n,a)||M._isNewline(n)){s!==""&&(e.push(s),s=""),n==="\r"&&a===`
`?(e.push(`\r
`),r++):e.push(n);continue}s+=n}return s!==""&&e.push(s),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,r,n){return!0}static wordWrapSplit(t){return M.graphemeSegmenter(t)}static measureFont(t){if(M._fonts[t])return M._fonts[t];const e=M._context;e.font=t;const s=e.measureText(M.METRICS_STRING+M.BASELINE_SYMBOL),r={ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent,fontSize:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent};return M._fonts[t]=r,r}static clearMetrics(t=""){t?delete M._fonts[t]:M._fonts={}}static get _canvas(){if(!M.__canvas){let t;try{const e=new OffscreenCanvas(0,0),s=e.getContext("2d",Fs);if(s!=null&&s.measureText)return M.__canvas=e,e;t=U.get().createCanvas()}catch{t=U.get().createCanvas()}t.width=t.height=10,M.__canvas=t}return M.__canvas}static get _context(){return M.__context||(M.__context=M._canvas.getContext("2d",Fs)),M.__context}};yt.METRICS_STRING="|q";yt.BASELINE_SYMBOL="M";yt.BASELINE_MULTIPLIER=1.4;yt.HEIGHT_MULTIPLIER=2;yt.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>{const e=i.segment(t),s=[];let r=0;for(const n of e)s[r++]=n.segment;return s}}return i=>[...i]})();yt.experimentalLetterSpacing=!1;yt._fonts={};yt._newlines=[10,13];yt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];yt._measurementCache=Yn(1e3);let wt=yt;const tr=[{offset:0,color:"white"},{offset:1,color:"black"}],gi=class ai{constructor(...t){this.uid=X("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=vh(t);e={...e.type==="radial"?ai.defaultRadialOptions:ai.defaultLinearOptions,...qr(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(r=>{this.addColorStop(r.offset,r.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:q.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:s,y:r}=this.end,n=s-t,a=r-e;const o=n<0||a<0;if(this._wrapMode==="clamp-to-edge"){if(n<0){const p=t;t=s,s=p,n*=-1}if(a<0){const p=e;e=r,r=p,a*=-1}}const h=this.colorStops.length?this.colorStops:tr,l=this._textureSize,{canvas:c,context:d}=sr(l,1),f=o?d.createLinearGradient(this._textureSize,0,0,0):d.createLinearGradient(0,0,this._textureSize,0);er(f,h),d.fillStyle=f,d.fillRect(0,0,l,1),this.texture=new D({source:new Xt({resource:c,addressMode:this._wrapMode})});const u=Math.sqrt(n*n+a*a),m=Math.atan2(a,n),g=new F;g.scale(u/l,1),g.rotate(m),g.translate(t,e),this.textureSpace==="local"&&g.scale(l,l),this.transform=g}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:tr,e=this._textureSize,{canvas:s,context:r}=sr(e,e),{x:n,y:a}=this.center,{x:o,y:h}=this.outerCenter,l=this.innerRadius,c=this.outerRadius,d=o-c,f=h-c,u=e/(c*2),m=(n-d)*u,g=(a-f)*u,p=r.createRadialGradient(m,g,l*u,(o-d)*u,(h-f)*u,c*u);er(p,t),r.fillStyle=t[t.length-1].color,r.fillRect(0,0,e,e),r.fillStyle=p,r.translate(m,g),r.rotate(this.rotation),r.scale(1,this.scale),r.translate(-m,-g),r.fillRect(0,0,e,e),this.texture=new D({source:new Xt({resource:s,addressMode:this._wrapMode})});const x=new F;x.scale(1/u,1/u),x.translate(d,f),this.textureSpace==="local"&&x.scale(e,e),this.transform=x}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};gi.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};gi.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let Pt=gi;function er(i,t){for(let e=0;e<t.length;e++){const s=t[e];i.addColorStop(s.offset,s.color)}}function sr(i,t){const e=U.get().createCanvas(i,t),s=e.getContext("2d");return{canvas:e,context:s}}function vh(i){let t=i[0]??{};return(typeof t=="number"||i[1])&&(R("8.5.2","use options object instead"),t={type:"linear",start:{x:i[0],y:i[1]},end:{x:i[2],y:i[3]},textureSpace:i[4],textureSize:i[5]??Pt.defaultLinearOptions.textureSize}),t}const ir={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class gs{constructor(t,e){this.uid=X("fillPattern"),this._tick=0,this.transform=new F,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=ir[e].addressModeU,t.source.style.addressModeV=ir[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var Sh=Ch,Ls={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},Ah=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function Ch(i){var t=[];return i.replace(Ah,function(e,s,r){var n=s.toLowerCase();for(r=Mh(r),n=="m"&&r.length>2&&(t.push([s].concat(r.splice(0,2))),n="l",s=s=="m"?"l":"L");;){if(r.length==Ls[n])return r.unshift(s),t.push(r);if(r.length<Ls[n])throw new Error("malformed path data");t.push([s].concat(r.splice(0,Ls[n])))}}),t}var Th=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function Mh(i){var t=i.match(Th);return t?t.map(Number):[]}const Ph=Vr(Sh);function kh(i,t){const e=Ph(i),s=[];let r=null,n=0,a=0;for(let o=0;o<e.length;o++){const h=e[o],l=h[0],c=h;switch(l){case"M":n=c[1],a=c[2],t.moveTo(n,a);break;case"m":n+=c[1],a+=c[2],t.moveTo(n,a);break;case"H":n=c[1],t.lineTo(n,a);break;case"h":n+=c[1],t.lineTo(n,a);break;case"V":a=c[1],t.lineTo(n,a);break;case"v":a+=c[1],t.lineTo(n,a);break;case"L":n=c[1],a=c[2],t.lineTo(n,a);break;case"l":n+=c[1],a+=c[2],t.lineTo(n,a);break;case"C":n=c[5],a=c[6],t.bezierCurveTo(c[1],c[2],c[3],c[4],n,a);break;case"c":t.bezierCurveTo(n+c[1],a+c[2],n+c[3],a+c[4],n+c[5],a+c[6]),n+=c[5],a+=c[6];break;case"S":n=c[3],a=c[4],t.bezierCurveToShort(c[1],c[2],n,a);break;case"s":t.bezierCurveToShort(n+c[1],a+c[2],n+c[3],a+c[4]),n+=c[3],a+=c[4];break;case"Q":n=c[3],a=c[4],t.quadraticCurveTo(c[1],c[2],n,a);break;case"q":t.quadraticCurveTo(n+c[1],a+c[2],n+c[3],a+c[4]),n+=c[3],a+=c[4];break;case"T":n=c[1],a=c[2],t.quadraticCurveToShort(n,a);break;case"t":n+=c[1],a+=c[2],t.quadraticCurveToShort(n,a);break;case"A":n=c[6],a=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,a);break;case"a":n+=c[6],a+=c[7],t.arcToSvg(c[1],c[2],c[3],c[4],c[5],n,a);break;case"Z":case"z":t.closePath(),s.length>0&&(r=s.pop(),r?(n=r.startX,a=r.startY):(n=0,a=0)),r=null;break;default:N(`Unknown SVG path command: ${l}`)}l!=="Z"&&l!=="z"&&r===null&&(r={startX:n,startY:a},s.push(r))}return t}class xi{constructor(t=0,e=0,s=0){this.type="circle",this.x=t,this.y=e,this.radius=s}clone(){return new xi(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let r=this.x-t,n=this.y-e;return r*=r,n*=n,r+n<=s}strokeContains(t,e,s,r=.5){if(this.radius===0)return!1;const n=this.x-t,a=this.y-e,o=this.radius,h=(1-r)*s,l=Math.sqrt(n*n+a*a);return l<=o+h&&l>o-(s-h)}getBounds(t){return t||(t=new V),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class yi{constructor(t=0,e=0,s=0,r=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=s,this.halfHeight=r}clone(){return new yi(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(t-this.x)/this.halfWidth,r=(e-this.y)/this.halfHeight;return s*=s,r*=r,s+r<=1}strokeContains(t,e,s,r=.5){const{halfWidth:n,halfHeight:a}=this;if(n<=0||a<=0)return!1;const o=s*(1-r),h=s-o,l=n-h,c=a-h,d=n+o,f=a+o,u=t-this.x,m=e-this.y,g=u*u/(l*l)+m*m/(c*c),p=u*u/(d*d)+m*m/(f*f);return g>1&&p<=1}getBounds(t){return t||(t=new V),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function Eh(i,t,e,s,r,n){const a=i-e,o=t-s,h=r-e,l=n-s,c=a*h+o*l,d=h*h+l*l;let f=-1;d!==0&&(f=c/d);let u,m;f<0?(u=e,m=s):f>1?(u=r,m=n):(u=e+f*h,m=s+f*l);const g=i-u,p=t-m;return g*g+p*p}let Ih,Bh;class Pe{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const s=[];for(let r=0,n=e.length;r<n;r++)s.push(e[r].x,e[r].y);e=s}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,s=e.length;for(let r=0;r<s;r+=2){const n=e[r],a=e[r+1],o=e[(r+2)%s],h=e[(r+3)%s];t+=(o-n)*(h+a)}return t<0}containsPolygon(t){const e=this.getBounds(Ih),s=t.getBounds(Bh);if(!e.containsRect(s))return!1;const r=t.points;for(let n=0;n<r.length;n+=2){const a=r[n],o=r[n+1];if(!this.contains(a,o))return!1}return!0}clone(){const t=this.points.slice(),e=new Pe(t);return e.closePath=this.closePath,e}contains(t,e){let s=!1;const r=this.points.length/2;for(let n=0,a=r-1;n<r;a=n++){const o=this.points[n*2],h=this.points[n*2+1],l=this.points[a*2],c=this.points[a*2+1];h>e!=c>e&&t<(l-o)*((e-h)/(c-h))+o&&(s=!s)}return s}strokeContains(t,e,s,r=.5){const n=s*s,a=n*(1-r),o=n-a,{points:h}=this,l=h.length-(this.closePath?0:2);for(let c=0;c<l;c+=2){const d=h[c],f=h[c+1],u=h[(c+2)%h.length],m=h[(c+3)%h.length],g=Eh(t,e,d,f,u,m),p=Math.sign((u-d)*(e-f)-(m-f)*(t-d));if(g<=(p<0?o:a))return!0}return!1}getBounds(t){t||(t=new V);const e=this.points;let s=1/0,r=-1/0,n=1/0,a=-1/0;for(let o=0,h=e.length;o<h;o+=2){const l=e[o],c=e[o+1];s=l<s?l:s,r=l>r?l:r,n=c<n?c:n,a=c>a?c:a}return t.x=s,t.width=r-s,t.y=n,t.height=a-n,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return R("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return R("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const ss=(i,t,e,s,r,n,a)=>{const o=i-e,h=t-s,l=Math.sqrt(o*o+h*h);return l>=r-n&&l<=r+a};class _i{constructor(t=0,e=0,s=0,r=0,n=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=s,this.height=r,this.radius=n}getBounds(t){return t||(t=new V),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new _i(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let r=t-(this.x+s),n=e-(this.y+s);const a=s*s;if(r*r+n*n<=a||(r=t-(this.x+this.width-s),r*r+n*n<=a)||(n=e-(this.y+this.height-s),r*r+n*n<=a)||(r=t-(this.x+s),r*r+n*n<=a))return!0}return!1}strokeContains(t,e,s,r=.5){const{x:n,y:a,width:o,height:h,radius:l}=this,c=s*(1-r),d=s-c,f=n+l,u=a+l,m=o-l*2,g=h-l*2,p=n+o,x=a+h;return(t>=n-c&&t<=n+d||t>=p-d&&t<=p+c)&&e>=u&&e<=u+g||(e>=a-c&&e<=a+d||e>=x-d&&e<=x+c)&&t>=f&&t<=f+m?!0:t<f&&e<u&&ss(t,e,f,u,l,d,c)||t>p-l&&e<u&&ss(t,e,p-l,u,l,d,c)||t>p-l&&e>x-l&&ss(t,e,p-l,x-l,l,d,c)||t<f&&e>x-l&&ss(t,e,f,x-l,l,d,c)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const jn={};function Rh(i,t,e){let s=2166136261;for(let r=0;r<t;r++)s^=i[r].uid,s=Math.imul(s,16777619),s>>>=0;return jn[s]||Fh(i,t,s,e)}function Fh(i,t,e,s){const r={};let n=0;for(let o=0;o<s;o++){const h=o<t?i[o]:D.EMPTY.source;r[n++]=h.source,r[n++]=h.style}const a=new as(r);return jn[e]=a,a}class rr{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function nr(i,t){const e=i.byteLength/8|0,s=new Float64Array(i,0,e);new Float64Array(t,0,e).set(s);const n=i.byteLength-e*8;if(n>0){const a=new Uint8Array(i,e*8,n);new Uint8Array(t,e*8,n).set(a)}}const Lh={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var Dh=(i=>(i[i.DISABLED=0]="DISABLED",i[i.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",i[i.MASK_ACTIVE=2]="MASK_ACTIVE",i[i.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",i[i.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",i[i.NONE=5]="NONE",i))(Dh||{});function ar(i,t){return t.alphaMode==="no-premultiply-alpha"&&Lh[i]||i}const Oh=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Gh(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function zh(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const s=Oh.replace(/%forloop%/gi,Gh(i));if(t.shaderSource(e,s),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}}finally{t.deleteShader(e)}return i}let Zt=null;function Wh(){var t;if(Zt)return Zt;const i=Tn();return Zt=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),Zt=zh(Zt,i),(t=i.getExtension("WEBGL_lose_context"))==null||t.loseContext(),Zt}class Uh{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class $h{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new Uh,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const ke=[];let cs=0;We.register({clear:()=>{if(ke.length>0)for(const i of ke)i&&i.destroy();ke.length=0,cs=0}});function or(){return cs>0?ke[--cs]:new $h}function hr(i){ke[cs++]=i}let ye=0;const Xn=class qn{constructor(t){this.uid=X("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...qn.defaultOptions,...t},t.maxTextures||(R("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=Wh());const{maxTextures:e,attributesInitialSize:s,indicesInitialSize:r}=t;this.attributeBuffer=new rr(s*4),this.indexBuffer=new Uint16Array(r),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)hr(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const s=t._batch.textures.ids[e._source.uid];return!s&&s!==0?!1:(t._textureId=s,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let s=or(),r=s.textures;r.clear();const n=e[this.elementStart];let a=ar(n.blendMode,n.texture._source),o=n.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const h=this.attributeBuffer.float32View,l=this.attributeBuffer.uint32View,c=this.indexBuffer;let d=this._batchIndexSize,f=this._batchIndexStart,u="startBatch";const m=this.maxTextures;for(let g=this.elementStart;g<this.elementSize;++g){const p=e[g];e[g]=null;const y=p.texture._source,_=ar(p.blendMode,y),b=a!==_||o!==p.topology;if(y._batchTick===ye&&!b){p._textureId=y._textureBindLocation,d+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,h,l,p._attributeStart,p._textureId),this.packQuadIndex(c,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,h,l,p._attributeStart,p._textureId),this.packIndex(p,c,p._indexStart,p._attributeStart/this.vertexSize)),p._batch=s;continue}y._batchTick=ye,(r.count>=m||b)&&(this._finishBatch(s,f,d-f,r,a,o,t,u),u="renderBatch",f=d,a=_,o=p.topology,s=or(),r=s.textures,r.clear(),++ye),p._textureId=y._textureBindLocation=r.count,r.ids[y.uid]=r.count,r.textures[r.count++]=y,p._batch=s,d+=p.indexSize,p.packAsQuad?(this.packQuadAttributes(p,h,l,p._attributeStart,p._textureId),this.packQuadIndex(c,p._indexStart,p._attributeStart/this.vertexSize)):(this.packAttributes(p,h,l,p._attributeStart,p._textureId),this.packIndex(p,c,p._indexStart,p._attributeStart/this.vertexSize))}r.count>0&&(this._finishBatch(s,f,d-f,r,a,o,t,u),f=d,++ye),this.elementStart=this.elementSize,this._batchIndexStart=f,this._batchIndexSize=d}_finishBatch(t,e,s,r,n,a,o,h){t.gpuBindGroup=null,t.bindGroup=null,t.action=h,t.batcher=this,t.textures=r,t.blendMode=n,t.topology=a,t.start=e,t.size=s,++ye,this.batches[this.batchIndex++]=t,o.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),s=new rr(e);nr(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(t){const e=this.indexBuffer;let s=Math.max(t,e.length*1.5);s+=s%2;const r=s>65535?new Uint32Array(s):new Uint16Array(s);if(r.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let n=0;n<e.length;n++)r[n]=e[n];else nr(e.buffer,r.buffer);this.indexBuffer=r}packQuadIndex(t,e,s){t[e]=s+0,t[e+1]=s+1,t[e+2]=s+2,t[e+3]=s+0,t[e+4]=s+2,t[e+5]=s+3}packIndex(t,e,s,r){const n=t.indices,a=t.indexSize,o=t.indexOffset,h=t.attributeOffset;for(let l=0;l<a;l++)e[s++]=r+n[l+o]-h}destroy(){if(this.batches!==null){for(let t=0;t<this.batches.length;t++)hr(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]&&(this._elements[t]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Xn.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let Hh=Xn;var it=(i=>(i[i.MAP_READ=1]="MAP_READ",i[i.MAP_WRITE=2]="MAP_WRITE",i[i.COPY_SRC=4]="COPY_SRC",i[i.COPY_DST=8]="COPY_DST",i[i.INDEX=16]="INDEX",i[i.VERTEX=32]="VERTEX",i[i.UNIFORM=64]="UNIFORM",i[i.STORAGE=128]="STORAGE",i[i.INDIRECT=256]="INDIRECT",i[i.QUERY_RESOLVE=512]="QUERY_RESOLVE",i[i.STATIC=1024]="STATIC",i))(it||{});class De extends mt{constructor(t){let{data:e,size:s}=t;const{usage:r,label:n,shrinkToFit:a}=t;super(),this.uid=X("buffer"),this._resourceType="buffer",this._resourceId=X("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,s??(s=e==null?void 0:e.byteLength);const o=!!e;this.descriptor={size:s,usage:r,mappedAtCreation:o,label:n},this.shrinkToFit=a??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&it.STATIC)}set static(t){t?this.descriptor.usage|=it.STATIC:this.descriptor.usage&=~it.STATIC}setDataWithSize(t,e,s){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){s&&this.emit("update",this);return}const r=this._data;if(this._data=t,this._dataInt32=null,!r||r.length!==t.length){!this.shrinkToFit&&r&&t.byteLength<r.byteLength?s&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=X("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function Kn(i,t){if(!(i instanceof De)){let e=t?it.INDEX:it.VERTEX;i instanceof Array&&(t?(i=new Uint32Array(i),e=it.INDEX|it.COPY_DST):(i=new Float32Array(i),e=it.VERTEX|it.COPY_DST)),i=new De({data:i,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return i}function Nh(i,t,e){const s=i.getAttribute(t);if(!s)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const r=s.buffer.data;let n=1/0,a=1/0,o=-1/0,h=-1/0;const l=r.BYTES_PER_ELEMENT,c=(s.offset||0)/l,d=(s.stride||2*4)/l;for(let f=c;f<r.length;f+=d){const u=r[f],m=r[f+1];u>o&&(o=u),m>h&&(h=m),u<n&&(n=u),m<a&&(a=m)}return e.minX=n,e.minY=a,e.maxX=o,e.maxY=h,e}function Vh(i){return(i instanceof De||Array.isArray(i)||i.BYTES_PER_ELEMENT)&&(i={buffer:i}),i.buffer=Kn(i.buffer,!1),i}class Yh extends mt{constructor(t={}){super(),this.uid=X("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new pt,this._boundsDirty=!0;const{attributes:e,indexBuffer:s,topology:r}=t;if(this.buffers=[],this.attributes={},e)for(const n in e)this.addAttribute(n,e[n]);this.instanceCount=t.instanceCount??1,s&&this.addIndex(s),this.topology=r||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const s=Vh(e);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=s}addIndex(t){this.indexBuffer=Kn(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,Nh(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const jh=new Float32Array(1),Xh=new Uint32Array(1);class qh extends Yh{constructor(){const e=new De({data:jh,label:"attribute-batch-buffer",usage:it.VERTEX|it.COPY_DST,shrinkToFit:!1}),s=new De({data:Xh,label:"index-batch-buffer",usage:it.INDEX|it.COPY_DST,shrinkToFit:!1}),r=6*4;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:r,offset:0},aUV:{buffer:e,format:"float32x2",stride:r,offset:2*4},aColor:{buffer:e,format:"unorm8x4",stride:r,offset:4*4},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:r,offset:5*4}},indexBuffer:s})}}function lr(i,t,e){if(i)for(const s in i){const r=s.toLocaleLowerCase(),n=t[r];if(n){let a=i[s];s==="header"&&(a=a.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&n.push(`//----${e}----//`),n.push(a)}else N(`${s} placement hook does not exist in shader`)}}const Kh=/\{\{(.*?)\}\}/g;function cr(i){var s;const t={};return(((s=i.match(Kh))==null?void 0:s.map(r=>r.replace(/[{()}]/g,"")))??[]).forEach(r=>{t[r]=[]}),t}function dr(i,t){let e;const s=/@in\s+([^;]+);/g;for(;(e=s.exec(i))!==null;)t.push(e[1])}function ur(i,t,e=!1){const s=[];dr(t,s),i.forEach(o=>{o.header&&dr(o.header,s)});const r=s;e&&r.sort();const n=r.map((o,h)=>`       @location(${h}) ${o},`).join(`
`);let a=t.replace(/@in\s+[^;]+;\s*/g,"");return a=a.replace("{{in}}",`
${n}
`),a}function fr(i,t){let e;const s=/@out\s+([^;]+);/g;for(;(e=s.exec(i))!==null;)t.push(e[1])}function Zh(i){const e=/\b(\w+)\s*:/g.exec(i);return e?e[1]:""}function Qh(i){const t=/@.*?\s+/g;return i.replace(t,"")}function Jh(i,t){const e=[];fr(t,e),i.forEach(h=>{h.header&&fr(h.header,e)});let s=0;const r=e.sort().map(h=>h.indexOf("builtin")>-1?h:`@location(${s++}) ${h}`).join(`,
`),n=e.sort().map(h=>`       var ${Qh(h)};`).join(`
`),a=`return VSOutput(
            ${e.sort().map(h=>` ${Zh(h)}`).join(`,
`)});`;let o=t.replace(/@out\s+[^;]+;\s*/g,"");return o=o.replace("{{struct}}",`
${r}
`),o=o.replace("{{start}}",`
${n}
`),o=o.replace("{{return}}",`
${a}
`),o}function pr(i,t){let e=i;for(const s in t){const r=t[s];r.join(`
`).length?e=e.replace(`{{${s}}}`,`//-----${s} START-----//
${r.join(`
`)}
//----${s} FINISH----//`):e=e.replace(`{{${s}}}`,"")}return e}const Bt=Object.create(null),Ds=new Map;let tl=0;function el({template:i,bits:t}){const e=Zn(i,t);if(Bt[e])return Bt[e];const{vertex:s,fragment:r}=il(i,t);return Bt[e]=Qn(s,r,t),Bt[e]}function sl({template:i,bits:t}){const e=Zn(i,t);return Bt[e]||(Bt[e]=Qn(i.vertex,i.fragment,t)),Bt[e]}function il(i,t){const e=t.map(a=>a.vertex).filter(a=>!!a),s=t.map(a=>a.fragment).filter(a=>!!a);let r=ur(e,i.vertex,!0);r=Jh(e,r);const n=ur(s,i.fragment,!0);return{vertex:r,fragment:n}}function Zn(i,t){return t.map(e=>(Ds.has(e)||Ds.set(e,tl++),Ds.get(e))).sort((e,s)=>e-s).join("-")+i.vertex+i.fragment}function Qn(i,t,e){const s=cr(i),r=cr(t);return e.forEach(n=>{lr(n.vertex,s,n.name),lr(n.fragment,r,n.name)}),{vertex:pr(i,s),fragment:pr(t,r)}}const rl=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,nl=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,al=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,ol=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,hl={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},ll={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function cl({bits:i,name:t}){const e=el({template:{fragment:nl,vertex:rl},bits:[hl,...i]});return ms.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function dl({bits:i,name:t}){return new Pn({name:t,...sl({template:{vertex:al,fragment:ol},bits:[ll,...i]})})}const ul={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},fl={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},Os={};function pl(i){const t=[];if(i===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let s=0;s<i;s++)t.push(`@group(1) @binding(${e++}) var textureSource${s+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${s+1}: sampler;`)}return t.join(`
`)}function ml(i){const t=[];if(i===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<i;e++)e===i-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function gl(i){return Os[i]||(Os[i]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${pl(i)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${ml(i)}
            `}}),Os[i]}const Gs={};function xl(i){const t=[];for(let e=0;e<i;e++)e>0&&t.push("else"),e<i-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function yl(i){return Gs[i]||(Gs[i]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${i}];

            `,main:`

                ${xl(i)}
            `}}),Gs[i]}const _l={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},bl={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},mr={};function wl(i){let t=mr[i];if(t)return t;const e=new Int32Array(i);for(let s=0;s<i;s++)e[s]=s;return t=mr[i]=new Bn({uTextures:{value:e,type:"i32",size:i}},{isStatic:!0}),t}class vl extends mi{constructor(t){const e=dl({name:"batch",bits:[fl,yl(t),bl]}),s=cl({name:"batch",bits:[ul,gl(t),_l]});super({glProgram:e,gpuProgram:s,resources:{batchSamplers:wl(t)}})}}let zs=null;const Jn=class ta extends Hh{constructor(t){super(t),this.geometry=new qh,this.name=ta.extension.name,this.vertexSize=6,zs??(zs=new vl(t.maxTextures)),this.shader=zs}packAttributes(t,e,s,r,n){const a=n<<16|t.roundPixels&65535,o=t.transform,h=o.a,l=o.b,c=o.c,d=o.d,f=o.tx,u=o.ty,{positions:m,uvs:g}=t,p=t.color,x=t.attributeOffset,y=x+t.attributeSize;for(let _=x;_<y;_++){const b=_*2,S=m[b],v=m[b+1];e[r++]=h*S+c*v+f,e[r++]=d*v+l*S+u,e[r++]=g[b],e[r++]=g[b+1],s[r++]=p,s[r++]=a}}packQuadAttributes(t,e,s,r,n){const a=t.texture,o=t.transform,h=o.a,l=o.b,c=o.c,d=o.d,f=o.tx,u=o.ty,m=t.bounds,g=m.maxX,p=m.minX,x=m.maxY,y=m.minY,_=a.uvs,b=t.color,S=n<<16|t.roundPixels&65535;e[r+0]=h*p+c*y+f,e[r+1]=d*y+l*p+u,e[r+2]=_.x0,e[r+3]=_.y0,s[r+4]=b,s[r+5]=S,e[r+6]=h*g+c*y+f,e[r+7]=d*y+l*g+u,e[r+8]=_.x1,e[r+9]=_.y1,s[r+10]=b,s[r+11]=S,e[r+12]=h*g+c*x+f,e[r+13]=d*x+l*g+u,e[r+14]=_.x2,e[r+15]=_.y2,s[r+16]=b,s[r+17]=S,e[r+18]=h*p+c*x+f,e[r+19]=d*x+l*p+u,e[r+20]=_.x3,e[r+21]=_.y3,s[r+22]=b,s[r+23]=S}};Jn.extension={type:[P.Batcher],name:"default"};let Sl=Jn;function Al(i,t,e,s,r,n,a,o=null){let h=0;e*=t,r*=n;const l=o.a,c=o.b,d=o.c,f=o.d,u=o.tx,m=o.ty;for(;h<a;){const g=i[e],p=i[e+1];s[r]=l*g+d*p+u,s[r+1]=c*g+f*p+m,r+=n,e+=t,h++}}function Cl(i,t,e,s){let r=0;for(t*=e;r<s;)i[t]=0,i[t+1]=0,t+=e,r++}function ea(i,t,e,s,r){const n=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,c=t.ty;e||(e=0),s||(s=2),r||(r=i.length/s-e);let d=e*s;for(let f=0;f<r;f++){const u=i[d],m=i[d+1];i[d]=n*u+o*m+l,i[d+1]=a*u+h*m+c,d+=s}}const Tl=new F;class sa{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,s=this.renderable;return s?an(e,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||Tl}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const Oe={extension:{type:P.ShapeBuilder,name:"circle"},build(i,t){let e,s,r,n,a,o;if(i.type==="circle"){const b=i;if(a=o=b.radius,a<=0)return!1;e=b.x,s=b.y,r=n=0}else if(i.type==="ellipse"){const b=i;if(a=b.halfWidth,o=b.halfHeight,a<=0||o<=0)return!1;e=b.x,s=b.y,r=n=0}else{const b=i,S=b.width/2,v=b.height/2;e=b.x+S,s=b.y+v,a=o=Math.max(0,Math.min(b.radius,Math.min(S,v))),r=S-a,n=v-o}if(r<0||n<0)return!1;const h=Math.ceil(2.3*Math.sqrt(a+o)),l=h*8+(r?4:0)+(n?4:0);if(l===0)return!1;if(h===0)return t[0]=t[6]=e+r,t[1]=t[3]=s+n,t[2]=t[4]=e-r,t[5]=t[7]=s-n,!0;let c=0,d=h*4+(r?2:0)+2,f=d,u=l,m=r+a,g=n,p=e+m,x=e-m,y=s+g;if(t[c++]=p,t[c++]=y,t[--d]=y,t[--d]=x,n){const b=s-g;t[f++]=x,t[f++]=b,t[--u]=b,t[--u]=p}for(let b=1;b<h;b++){const S=Math.PI/2*(b/h),v=r+Math.cos(S)*a,w=n+Math.sin(S)*o,E=e+v,k=e-v,A=s+w,C=s-w;t[c++]=E,t[c++]=A,t[--d]=A,t[--d]=k,t[f++]=k,t[f++]=C,t[--u]=C,t[--u]=E}m=r,g=n+o,p=e+m,x=e-m,y=s+g;const _=s-g;return t[c++]=p,t[c++]=y,t[--u]=_,t[--u]=p,r&&(t[c++]=x,t[c++]=y,t[--u]=_,t[--u]=x),!0},triangulate(i,t,e,s,r,n){if(i.length===0)return;let a=0,o=0;for(let c=0;c<i.length;c+=2)a+=i[c],o+=i[c+1];a/=i.length/2,o/=i.length/2;let h=s;t[h*e]=a,t[h*e+1]=o;const l=h++;for(let c=0;c<i.length;c+=2)t[h*e]=i[c],t[h*e+1]=i[c+1],c>0&&(r[n++]=h,r[n++]=l,r[n++]=h-1),h++;r[n++]=l+1,r[n++]=l,r[n++]=h-1}},Ml={...Oe,extension:{...Oe.extension,name:"ellipse"}},Pl={...Oe,extension:{...Oe.extension,name:"roundedRectangle"}},ia=1e-4,gr=1e-4;function kl(i){const t=i.length;if(t<6)return 1;let e=0;for(let s=0,r=i[t-2],n=i[t-1];s<t;s+=2){const a=i[s],o=i[s+1];e+=(a-r)*(o+n),r=a,n=o}return e<0?-1:1}function xr(i,t,e,s,r,n,a,o){const h=i-e*r,l=t-s*r,c=i+e*n,d=t+s*n;let f,u;a?(f=s,u=-e):(f=-s,u=e);const m=h+f,g=l+u,p=c+f,x=d+u;return o.push(m,g),o.push(p,x),2}function zt(i,t,e,s,r,n,a,o){const h=e-i,l=s-t;let c=Math.atan2(h,l),d=Math.atan2(r-i,n-t);o&&c<d?c+=Math.PI*2:!o&&c>d&&(d+=Math.PI*2);let f=c;const u=d-c,m=Math.abs(u),g=Math.sqrt(h*h+l*l),p=(15*m*Math.sqrt(g)/Math.PI>>0)+1,x=u/p;if(f+=x,o){a.push(i,t),a.push(e,s);for(let y=1,_=f;y<p;y++,_+=x)a.push(i,t),a.push(i+Math.sin(_)*g,t+Math.cos(_)*g);a.push(i,t),a.push(r,n)}else{a.push(e,s),a.push(i,t);for(let y=1,_=f;y<p;y++,_+=x)a.push(i+Math.sin(_)*g,t+Math.cos(_)*g),a.push(i,t);a.push(r,n),a.push(i,t)}return p*2}function El(i,t,e,s,r,n){const a=ia;if(i.length===0)return;const o=t;let h=o.alignment;if(t.alignment!==.5){let O=kl(i);h=(h-.5)*O+.5}const l=new et(i[0],i[1]),c=new et(i[i.length-2],i[i.length-1]),d=s,f=Math.abs(l.x-c.x)<a&&Math.abs(l.y-c.y)<a;if(d){i=i.slice(),f&&(i.pop(),i.pop(),c.set(i[i.length-2],i[i.length-1]));const O=(l.x+c.x)*.5,Et=(c.y+l.y)*.5;i.unshift(O,Et),i.push(O,Et)}const u=r,m=i.length/2;let g=i.length;const p=u.length/2,x=o.width/2,y=x*x,_=o.miterLimit*o.miterLimit;let b=i[0],S=i[1],v=i[2],w=i[3],E=0,k=0,A=-(S-w),C=b-v,G=0,B=0,$=Math.sqrt(A*A+C*C);A/=$,C/=$,A*=x,C*=x;const kt=h,T=(1-kt)*2,I=kt*2;d||(o.cap==="round"?g+=zt(b-A*(T-I)*.5,S-C*(T-I)*.5,b-A*T,S-C*T,b+A*I,S+C*I,u,!0)+2:o.cap==="square"&&(g+=xr(b,S,A,C,T,I,!0,u))),u.push(b-A*T,S-C*T),u.push(b+A*I,S+C*I);for(let O=1;O<m-1;++O){b=i[(O-1)*2],S=i[(O-1)*2+1],v=i[O*2],w=i[O*2+1],E=i[(O+1)*2],k=i[(O+1)*2+1],A=-(S-w),C=b-v,$=Math.sqrt(A*A+C*C),A/=$,C/=$,A*=x,C*=x,G=-(w-k),B=v-E,$=Math.sqrt(G*G+B*B),G/=$,B/=$,G*=x,B*=x;const Et=v-b,ce=S-w,de=v-E,ue=k-w,Ci=Et*de+ce*ue,Ue=ce*de-ue*Et,fe=Ue<0;if(Math.abs(Ue)<.001*Math.abs(Ci)){u.push(v-A*T,w-C*T),u.push(v+A*I,w+C*I),Ci>=0&&(o.join==="round"?g+=zt(v,w,v-A*T,w-C*T,v-G*T,w-B*T,u,!1)+4:g+=2,u.push(v-G*I,w-B*I),u.push(v+G*T,w+B*T));continue}const Ti=(-A+b)*(-C+w)-(-A+v)*(-C+S),Mi=(-G+E)*(-B+w)-(-G+v)*(-B+k),$e=(Et*Mi-de*Ti)/Ue,He=(ue*Ti-ce*Mi)/Ue,_s=($e-v)*($e-v)+(He-w)*(He-w),Lt=v+($e-v)*T,Dt=w+(He-w)*T,Ot=v-($e-v)*I,Gt=w-(He-w)*I,Aa=Math.min(Et*Et+ce*ce,de*de+ue*ue),Pi=fe?T:I,Ca=Aa+Pi*Pi*y;_s<=Ca?o.join==="bevel"||_s/y>_?(fe?(u.push(Lt,Dt),u.push(v+A*I,w+C*I),u.push(Lt,Dt),u.push(v+G*I,w+B*I)):(u.push(v-A*T,w-C*T),u.push(Ot,Gt),u.push(v-G*T,w-B*T),u.push(Ot,Gt)),g+=2):o.join==="round"?fe?(u.push(Lt,Dt),u.push(v+A*I,w+C*I),g+=zt(v,w,v+A*I,w+C*I,v+G*I,w+B*I,u,!0)+4,u.push(Lt,Dt),u.push(v+G*I,w+B*I)):(u.push(v-A*T,w-C*T),u.push(Ot,Gt),g+=zt(v,w,v-A*T,w-C*T,v-G*T,w-B*T,u,!1)+4,u.push(v-G*T,w-B*T),u.push(Ot,Gt)):(u.push(Lt,Dt),u.push(Ot,Gt)):(u.push(v-A*T,w-C*T),u.push(v+A*I,w+C*I),o.join==="round"?fe?g+=zt(v,w,v+A*I,w+C*I,v+G*I,w+B*I,u,!0)+2:g+=zt(v,w,v-A*T,w-C*T,v-G*T,w-B*T,u,!1)+2:o.join==="miter"&&_s/y<=_&&(fe?(u.push(Ot,Gt),u.push(Ot,Gt)):(u.push(Lt,Dt),u.push(Lt,Dt)),g+=2),u.push(v-G*T,w-B*T),u.push(v+G*I,w+B*I),g+=2)}b=i[(m-2)*2],S=i[(m-2)*2+1],v=i[(m-1)*2],w=i[(m-1)*2+1],A=-(S-w),C=b-v,$=Math.sqrt(A*A+C*C),A/=$,C/=$,A*=x,C*=x,u.push(v-A*T,w-C*T),u.push(v+A*I,w+C*I),d||(o.cap==="round"?g+=zt(v-A*(T-I)*.5,w-C*(T-I)*.5,v-A*T,w-C*T,v+A*I,w+C*I,u,!1)+2:o.cap==="square"&&(g+=xr(v,w,A,C,T,I,!1,u)));const le=gr*gr;for(let O=p;O<g+p-2;++O)b=u[O*2],S=u[O*2+1],v=u[(O+1)*2],w=u[(O+1)*2+1],E=u[(O+2)*2],k=u[(O+2)*2+1],!(Math.abs(b*(w-k)+v*(k-S)+E*(S-w))<le)&&n.push(O,O+1,O+2)}function Il(i,t,e,s){const r=ia;if(i.length===0)return;const n=i[0],a=i[1],o=i[i.length-2],h=i[i.length-1],l=t||Math.abs(n-o)<r&&Math.abs(a-h)<r,c=e,d=i.length/2,f=c.length/2;for(let u=0;u<d;u++)c.push(i[u*2]),c.push(i[u*2+1]);for(let u=0;u<d-1;u++)s.push(f+u,f+u+1);l&&s.push(f+d-1,f)}function ra(i,t,e,s,r,n,a){const o=fh(i,t,2);if(!o)return;for(let l=0;l<o.length;l+=3)n[a++]=o[l]+r,n[a++]=o[l+1]+r,n[a++]=o[l+2]+r;let h=r*s;for(let l=0;l<i.length;l+=2)e[h]=i[l],e[h+1]=i[l+1],h+=s}const Bl=[],Rl={extension:{type:P.ShapeBuilder,name:"polygon"},build(i,t){for(let e=0;e<i.points.length;e++)t[e]=i.points[e];return!0},triangulate(i,t,e,s,r,n){ra(i,Bl,t,e,s,r,n)}},Fl={extension:{type:P.ShapeBuilder,name:"rectangle"},build(i,t){const e=i,s=e.x,r=e.y,n=e.width,a=e.height;return n>0&&a>0?(t[0]=s,t[1]=r,t[2]=s+n,t[3]=r,t[4]=s+n,t[5]=r+a,t[6]=s,t[7]=r+a,!0):!1},triangulate(i,t,e,s,r,n){let a=0;s*=e,t[s+a]=i[0],t[s+a+1]=i[1],a+=e,t[s+a]=i[2],t[s+a+1]=i[3],a+=e,t[s+a]=i[6],t[s+a+1]=i[7],a+=e,t[s+a]=i[4],t[s+a+1]=i[5],a+=e;const o=s/e;r[n++]=o,r[n++]=o+1,r[n++]=o+2,r[n++]=o+1,r[n++]=o+3,r[n++]=o+2}},Ll={extension:{type:P.ShapeBuilder,name:"triangle"},build(i,t){return t[0]=i.x,t[1]=i.y,t[2]=i.x2,t[3]=i.y2,t[4]=i.x3,t[5]=i.y3,!0},triangulate(i,t,e,s,r,n){let a=0;s*=e,t[s+a]=i[0],t[s+a+1]=i[1],a+=e,t[s+a]=i[2],t[s+a+1]=i[3],a+=e,t[s+a]=i[4],t[s+a+1]=i[5];const o=s/e;r[n++]=o,r[n++]=o+1,r[n++]=o+2}},Dl=new F,Ol=new V;function Gl(i,t,e,s){const r=t.matrix?i.copyFrom(t.matrix).invert():i.identity();if(t.textureSpace==="local"){const a=e.getBounds(Ol);t.width&&a.pad(t.width);const{x:o,y:h}=a,l=1/a.width,c=1/a.height,d=-o*l,f=-h*c,u=r.a,m=r.b,g=r.c,p=r.d;r.a*=l,r.b*=l,r.c*=c,r.d*=c,r.tx=d*u+f*g+r.tx,r.ty=d*m+f*p+r.ty}else r.translate(t.texture.frame.x,t.texture.frame.y),r.scale(1/t.texture.source.width,1/t.texture.source.height);const n=t.texture.source.style;return!(t.fill instanceof Pt)&&n.addressMode==="clamp-to-edge"&&(n.addressMode="repeat",n.update()),s&&r.append(Dl.copyFrom(s).invert()),r}const xs={};tt.handleByMap(P.ShapeBuilder,xs);tt.add(Fl,Rl,Ll,Oe,Ml,Pl);const zl=new V,Wl=new F;function Ul(i,t){const{geometryData:e,batches:s}=t;s.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let r=0;r<i.instructions.length;r++){const n=i.instructions[r];if(n.action==="texture")$l(n.data,s,e);else if(n.action==="fill"||n.action==="stroke"){const a=n.action==="stroke",o=n.data.path.shapePath,h=n.data.style,l=n.data.hole;a&&l&&yr(l.shapePath,h,!0,s,e),l&&(o.shapePrimitives[o.shapePrimitives.length-1].holes=l.shapePath.shapePrimitives),yr(o,h,a,s,e)}}}function $l(i,t,e){const s=[],r=xs.rectangle,n=zl;n.x=i.dx,n.y=i.dy,n.width=i.dw,n.height=i.dh;const a=i.transform;if(!r.build(n,s))return;const{vertices:o,uvs:h,indices:l}=e,c=l.length,d=o.length/2;a&&ea(s,a),r.triangulate(s,o,2,d,l,c);const f=i.image,u=f.uvs;h.push(u.x0,u.y0,u.x1,u.y1,u.x3,u.y3,u.x2,u.y2);const m=ht.get(sa);m.indexOffset=c,m.indexSize=l.length-c,m.attributeOffset=d,m.attributeSize=o.length/2-d,m.baseColor=i.style,m.alpha=i.alpha,m.texture=f,m.geometryData=e,t.push(m)}function yr(i,t,e,s,r){const{vertices:n,uvs:a,indices:o}=r;i.shapePrimitives.forEach(({shape:h,transform:l,holes:c})=>{const d=[],f=xs[h.type];if(!f.build(h,d))return;const u=o.length,m=n.length/2;let g="triangle-list";if(l&&ea(d,l),e){const _=h.closePath??!0,b=t;b.pixelLine?(Il(d,_,n,o),g="line-list"):El(d,b,!1,_,n,o)}else if(c){const _=[],b=d.slice();Hl(c).forEach(v=>{_.push(b.length/2),b.push(...v)}),ra(b,_,n,2,m,o,u)}else f.triangulate(d,n,2,m,o,u);const p=a.length/2,x=t.texture;if(x!==D.WHITE){const _=Gl(Wl,t,h,l);Al(n,2,m,a,p,2,n.length/2-m,_)}else Cl(a,p,2,n.length/2-m);const y=ht.get(sa);y.indexOffset=u,y.indexSize=o.length-u,y.attributeOffset=m,y.attributeSize=n.length/2-m,y.baseColor=t.color,y.alpha=t.alpha,y.texture=x,y.geometryData=r,y.topology=g,s.push(y)})}function Hl(i){const t=[];for(let e=0;e<i.length;e++){const s=i[e].shape,r=[];xs[s.type].build(s,r)&&t.push(r)}return t}class Nl{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class Vl{constructor(){this.instructions=new cn}init(t){this.batcher=new Sl({maxTextures:t}),this.instructions.reset()}get geometry(){return R(Oa,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const bi=class oi{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){oi.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??oi.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Ul(t,e);const s=t.batchMode;t.customShader||s==="no-batch"?e.isBatchable=!1:s==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=ht.get(Vl,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:s,geometryData:r}=this._gpuContextHash[t.uid],n=r.vertices.length,a=r.indices.length;for(let c=0;c<s.length;c++)s[c].applyTransform=!1;const o=e.batcher;o.ensureAttributeBuffer(n),o.ensureIndexBuffer(a),o.begin();for(let c=0;c<s.length;c++){const d=s[c];o.add(d)}o.finish(e.instructions);const h=o.geometry;h.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),h.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!0);const l=o.batches;for(let c=0;c<l.length;c++){const d=l[c];d.bindGroup=Rh(d.textures.textures,d.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new Nl;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(ht.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(s=>{ht.return(s)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};bi.extension={type:[P.WebGLSystem,P.WebGPUSystem,P.CanvasSystem],name:"graphicsContext"};bi.defaultOptions={bezierSmoothness:.5};let na=bi;const Yl=8,is=11920929e-14,jl=1;function aa(i,t,e,s,r,n,a,o,h,l){const d=Math.min(.99,Math.max(0,l??na.defaultOptions.bezierSmoothness));let f=(jl-d)/1;return f*=f,Xl(t,e,s,r,n,a,o,h,i,f),i}function Xl(i,t,e,s,r,n,a,o,h,l){hi(i,t,e,s,r,n,a,o,h,l,0),h.push(a,o)}function hi(i,t,e,s,r,n,a,o,h,l,c){if(c>Yl)return;const d=(i+e)/2,f=(t+s)/2,u=(e+r)/2,m=(s+n)/2,g=(r+a)/2,p=(n+o)/2,x=(d+u)/2,y=(f+m)/2,_=(u+g)/2,b=(m+p)/2,S=(x+_)/2,v=(y+b)/2;if(c>0){let w=a-i,E=o-t;const k=Math.abs((e-a)*E-(s-o)*w),A=Math.abs((r-a)*E-(n-o)*w);if(k>is&&A>is){if((k+A)*(k+A)<=l*(w*w+E*E)){h.push(S,v);return}}else if(k>is){if(k*k<=l*(w*w+E*E)){h.push(S,v);return}}else if(A>is){if(A*A<=l*(w*w+E*E)){h.push(S,v);return}}else if(w=S-(i+a)/2,E=v-(t+o)/2,w*w+E*E<=l){h.push(S,v);return}}hi(i,t,d,f,x,y,S,v,h,l,c+1),hi(S,v,_,b,g,p,a,o,h,l,c+1)}const ql=8,Kl=11920929e-14,Zl=1;function Ql(i,t,e,s,r,n,a,o){const l=Math.min(.99,Math.max(0,o??na.defaultOptions.bezierSmoothness));let c=(Zl-l)/1;return c*=c,Jl(t,e,s,r,n,a,i,c),i}function Jl(i,t,e,s,r,n,a,o){li(a,i,t,e,s,r,n,o,0),a.push(r,n)}function li(i,t,e,s,r,n,a,o,h){if(h>ql)return;const l=(t+s)/2,c=(e+r)/2,d=(s+n)/2,f=(r+a)/2,u=(l+d)/2,m=(c+f)/2;let g=n-t,p=a-e;const x=Math.abs((s-n)*p-(r-a)*g);if(x>Kl){if(x*x<=o*(g*g+p*p)){i.push(u,m);return}}else if(g=u-(t+n)/2,p=m-(e+a)/2,g*g+p*p<=o){i.push(u,m);return}li(i,t,e,l,c,u,m,o,h+1),li(i,u,m,d,f,n,a,o,h+1)}function oa(i,t,e,s,r,n,a,o){let h=Math.abs(r-n);(!a&&r>n||a&&n>r)&&(h=2*Math.PI-h),o||(o=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(h/Math.PI)))),o=Math.max(o,3);let l=h/o,c=r;l*=a?-1:1;for(let d=0;d<o+1;d++){const f=Math.cos(c),u=Math.sin(c),m=t+f*s,g=e+u*s;i.push(m,g),c+=l}}function tc(i,t,e,s,r,n){const a=i[i.length-2],h=i[i.length-1]-e,l=a-t,c=r-e,d=s-t,f=Math.abs(h*d-l*c);if(f<1e-8||n===0){(i[i.length-2]!==t||i[i.length-1]!==e)&&i.push(t,e);return}const u=h*h+l*l,m=c*c+d*d,g=h*c+l*d,p=n*Math.sqrt(u)/f,x=n*Math.sqrt(m)/f,y=p*g/u,_=x*g/m,b=p*d+x*l,S=p*c+x*h,v=l*(x+y),w=h*(x+y),E=d*(p+_),k=c*(p+_),A=Math.atan2(w-S,v-b),C=Math.atan2(k-S,E-b);oa(i,b+t,S+e,n,A,C,l*c>d*h)}const Ee=Math.PI*2,Ws={centerX:0,centerY:0,ang1:0,ang2:0},Us=({x:i,y:t},e,s,r,n,a,o,h)=>{i*=e,t*=s;const l=r*i-n*t,c=n*i+r*t;return h.x=l+a,h.y=c+o,h};function ec(i,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),s=t===1.5707963267948966?.551915024494:e,r=Math.cos(i),n=Math.sin(i),a=Math.cos(i+t),o=Math.sin(i+t);return[{x:r-n*s,y:n+r*s},{x:a+o*s,y:o-a*s},{x:a,y:o}]}const _r=(i,t,e,s)=>{const r=i*s-t*e<0?-1:1;let n=i*e+t*s;return n>1&&(n=1),n<-1&&(n=-1),r*Math.acos(n)},sc=(i,t,e,s,r,n,a,o,h,l,c,d,f)=>{const u=Math.pow(r,2),m=Math.pow(n,2),g=Math.pow(c,2),p=Math.pow(d,2);let x=u*m-u*p-m*g;x<0&&(x=0),x/=u*p+m*g,x=Math.sqrt(x)*(a===o?-1:1);const y=x*r/n*d,_=x*-n/r*c,b=l*y-h*_+(i+e)/2,S=h*y+l*_+(t+s)/2,v=(c-y)/r,w=(d-_)/n,E=(-c-y)/r,k=(-d-_)/n,A=_r(1,0,v,w);let C=_r(v,w,E,k);o===0&&C>0&&(C-=Ee),o===1&&C<0&&(C+=Ee),f.centerX=b,f.centerY=S,f.ang1=A,f.ang2=C};function ic(i,t,e,s,r,n,a,o=0,h=0,l=0){if(n===0||a===0)return;const c=Math.sin(o*Ee/360),d=Math.cos(o*Ee/360),f=d*(t-s)/2+c*(e-r)/2,u=-c*(t-s)/2+d*(e-r)/2;if(f===0&&u===0)return;n=Math.abs(n),a=Math.abs(a);const m=Math.pow(f,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(a,2);m>1&&(n*=Math.sqrt(m),a*=Math.sqrt(m)),sc(t,e,s,r,n,a,h,l,c,d,f,u,Ws);let{ang1:g,ang2:p}=Ws;const{centerX:x,centerY:y}=Ws;let _=Math.abs(p)/(Ee/4);Math.abs(1-_)<1e-7&&(_=1);const b=Math.max(Math.ceil(_),1);p/=b;let S=i[i.length-2],v=i[i.length-1];const w={x:0,y:0};for(let E=0;E<b;E++){const k=ec(g,p),{x:A,y:C}=Us(k[0],n,a,d,c,x,y,w),{x:G,y:B}=Us(k[1],n,a,d,c,x,y,w),{x:$,y:kt}=Us(k[2],n,a,d,c,x,y,w);aa(i,S,v,A,C,G,B,$,kt),S=$,v=kt,g+=p}}function rc(i,t,e){const s=(a,o)=>{const h=o.x-a.x,l=o.y-a.y,c=Math.sqrt(h*h+l*l),d=h/c,f=l/c;return{len:c,nx:d,ny:f}},r=(a,o)=>{a===0?i.moveTo(o.x,o.y):i.lineTo(o.x,o.y)};let n=t[t.length-1];for(let a=0;a<t.length;a++){const o=t[a%t.length],h=o.radius??e;if(h<=0){r(a,o),n=o;continue}const l=t[(a+1)%t.length],c=s(o,n),d=s(o,l);if(c.len<1e-4||d.len<1e-4){r(a,o),n=o;continue}let f=Math.asin(c.nx*d.ny-c.ny*d.nx),u=1,m=!1;c.nx*d.nx-c.ny*-d.ny<0?f<0?f=Math.PI+f:(f=Math.PI-f,u=-1,m=!0):f>0&&(u=-1,m=!0);const g=f/2;let p,x=Math.abs(Math.cos(g)*h/Math.sin(g));x>Math.min(c.len/2,d.len/2)?(x=Math.min(c.len/2,d.len/2),p=Math.abs(x*Math.sin(g)/Math.cos(g))):p=h;const y=o.x+d.nx*x+-d.ny*p*u,_=o.y+d.ny*x+d.nx*p*u,b=Math.atan2(c.ny,c.nx)+Math.PI/2*u,S=Math.atan2(d.ny,d.nx)-Math.PI/2*u;a===0&&i.moveTo(y+Math.cos(b)*p,_+Math.sin(b)*p),i.arc(y,_,p,b,S,m),n=o}}function nc(i,t,e,s){const r=(o,h)=>Math.sqrt((o.x-h.x)**2+(o.y-h.y)**2),n=(o,h,l)=>({x:o.x+(h.x-o.x)*l,y:o.y+(h.y-o.y)*l}),a=t.length;for(let o=0;o<a;o++){const h=t[(o+1)%a],l=h.radius??e;if(l<=0){o===0?i.moveTo(h.x,h.y):i.lineTo(h.x,h.y);continue}const c=t[o],d=t[(o+2)%a],f=r(c,h);let u;if(f<1e-4)u=h;else{const p=Math.min(f/2,l);u=n(h,c,p/f)}const m=r(d,h);let g;if(m<1e-4)g=h;else{const p=Math.min(m/2,l);g=n(h,d,p/m)}o===0?i.moveTo(u.x,u.y):i.lineTo(u.x,u.y),i.quadraticCurveTo(h.x,h.y,g.x,g.y,s)}}const ac=new V;class oc{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new pt,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const s=this._currentPoly.points,r=s[s.length-2],n=s[s.length-1];return(r!==t||n!==e)&&s.push(t,e),this}arc(t,e,s,r,n,a){this._ensurePoly(!1);const o=this._currentPoly.points;return oa(o,t,e,s,r,n,a),this}arcTo(t,e,s,r,n){this._ensurePoly();const a=this._currentPoly.points;return tc(a,t,e,s,r,n),this}arcToSvg(t,e,s,r,n,a,o){const h=this._currentPoly.points;return ic(h,this._currentPoly.lastX,this._currentPoly.lastY,a,o,t,e,s,r,n),this}bezierCurveTo(t,e,s,r,n,a,o){this._ensurePoly();const h=this._currentPoly;return aa(this._currentPoly.points,h.lastX,h.lastY,t,e,s,r,n,a,o),this}quadraticCurveTo(t,e,s,r,n){this._ensurePoly();const a=this._currentPoly;return Ql(this._currentPoly.points,a.lastX,a.lastY,t,e,s,r,n),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const s=this.shapePrimitives,r=s.length;for(let n=0;n<t.instructions.length;n++){const a=t.instructions[n];this[a.action](...a.data)}if(t.checkForHoles&&s.length-r>1){let n=null;for(let a=r;a<s.length;a++){const o=s[a];if(o.shape.type==="polygon"){const h=o.shape,l=n==null?void 0:n.shape;l&&l.containsPolygon(h)?(n.holes||(n.holes=[]),n.holes.push(o),s.copyWithin(a,a+1),s.length--,a--):n=o}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,s,r,n){return this.drawShape(new V(t,e,s,r),n),this}circle(t,e,s,r){return this.drawShape(new xi(t,e,s),r),this}poly(t,e,s){const r=new Pe(t);return r.closePath=e,this.drawShape(r,s),this}regularPoly(t,e,s,r,n=0,a){r=Math.max(r|0,3);const o=-1*Math.PI/2+n,h=Math.PI*2/r,l=[];for(let c=0;c<r;c++){const d=o-c*h;l.push(t+s*Math.cos(d),e+s*Math.sin(d))}return this.poly(l,!0,a),this}roundPoly(t,e,s,r,n,a=0,o){if(r=Math.max(r|0,3),n<=0)return this.regularPoly(t,e,s,r,a);const h=s*Math.sin(Math.PI/r)-.001;n=Math.min(n,h);const l=-1*Math.PI/2+a,c=Math.PI*2/r,d=(r-2)*Math.PI/r/2;for(let f=0;f<r;f++){const u=f*c+l,m=t+s*Math.cos(u),g=e+s*Math.sin(u),p=u+Math.PI+d,x=u-Math.PI-d,y=m+n*Math.cos(p),_=g+n*Math.sin(p),b=m+n*Math.cos(x),S=g+n*Math.sin(x);f===0?this.moveTo(y,_):this.lineTo(y,_),this.quadraticCurveTo(m,g,b,S,o)}return this.closePath()}roundShape(t,e,s=!1,r){return t.length<3?this:(s?nc(this,t,e,r):rc(this,t,e),this.closePath())}filletRect(t,e,s,r,n){if(n===0)return this.rect(t,e,s,r);const a=Math.min(s,r)/2,o=Math.min(a,Math.max(-a,n)),h=t+s,l=e+r,c=o<0?-o:0,d=Math.abs(o);return this.moveTo(t,e+d).arcTo(t+c,e+c,t+d,e,d).lineTo(h-d,e).arcTo(h-c,e+c,h,e+d,d).lineTo(h,l-d).arcTo(h-c,l-c,t+s-d,l,d).lineTo(t+d,l).arcTo(t+c,l-c,t,l-d,d).closePath()}chamferRect(t,e,s,r,n,a){if(n<=0)return this.rect(t,e,s,r);const o=Math.min(n,Math.min(s,r)/2),h=t+s,l=e+r,c=[t+o,e,h-o,e,h,e+o,h,l-o,h-o,l,t+o,l,t,l-o,t,e+o];for(let d=c.length-1;d>=2;d-=2)c[d]===c[d-2]&&c[d-1]===c[d-3]&&c.splice(d-1,2);return this.poly(c,!0,a)}ellipse(t,e,s,r,n){return this.drawShape(new yi(t,e,s,r),n),this}roundRect(t,e,s,r,n,a){return this.drawShape(new _i(t,e,s,r,n),a),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let s=this._currentPoly;return s&&this.endPoly(),s=new Pe,s.points.push(t,e),this._currentPoly=s,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Pe,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let s=e.shape.x,r=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const n=e.transform,a=s;s=n.a*s+n.c*r+n.tx,r=n.b*a+n.d*r+n.ty}this._currentPoly.points.push(s,r)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];this[s.action](...s.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let s=0;s<e.length;s++){const r=e[s],n=r.shape.getBounds(ac);r.transform?t.addRect(n,r.transform):t.addRect(n)}return t}}class Tt{constructor(t,e=!1){this.instructions=[],this.uid=X("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?kh(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new oc(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,s,r,n){const a=this.instructions[this.instructions.length-1],o=this.getLastPoint(et.shared);let h=0,l=0;if(!a||a.action!=="bezierCurveTo")h=o.x,l=o.y;else{h=a.data[2],l=a.data[3];const c=o.x,d=o.y;h=c+(c-h),l=d+(d-l)}return this.instructions.push({action:"bezierCurveTo",data:[h,l,t,e,s,r,n]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,s){const r=this.instructions[this.instructions.length-1],n=this.getLastPoint(et.shared);let a=0,o=0;if(!r||r.action!=="quadraticCurveTo")a=n.x,o=n.y;else{a=r.data[0],o=r.data[1];const h=n.x,l=n.y;a=h+(h-a),o=l+(l-o)}return this.instructions.push({action:"quadraticCurveTo",data:[a,o,t,e,s]}),this._dirty=!0,this}rect(t,e,s,r,n){return this.instructions.push({action:"rect",data:[t,e,s,r,n]}),this._dirty=!0,this}circle(t,e,s,r){return this.instructions.push({action:"circle",data:[t,e,s,r]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,s,r,n,a,o){n||(n=r/2);const h=-1*Math.PI/2+a,l=s*2,c=Math.PI*2/l,d=[];for(let f=0;f<l;f++){const u=f%2?n:r,m=f*c+h;d.push(t+u*Math.cos(m),e+u*Math.sin(m))}return this.poly(d,!0,o),this}clone(t=!1){const e=new Tt;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const r=this.instructions[s];e.instructions.push({action:r.action,data:r.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,s=t.b,r=t.c,n=t.d,a=t.tx,o=t.ty;let h=0,l=0,c=0,d=0,f=0,u=0,m=0,g=0;for(let p=0;p<this.instructions.length;p++){const x=this.instructions[p],y=x.data;switch(x.action){case"moveTo":case"lineTo":h=y[0],l=y[1],y[0]=e*h+r*l+a,y[1]=s*h+n*l+o;break;case"bezierCurveTo":c=y[0],d=y[1],f=y[2],u=y[3],h=y[4],l=y[5],y[0]=e*c+r*d+a,y[1]=s*c+n*d+o,y[2]=e*f+r*u+a,y[3]=s*f+n*u+o,y[4]=e*h+r*l+a,y[5]=s*h+n*l+o;break;case"quadraticCurveTo":c=y[0],d=y[1],h=y[2],l=y[3],y[0]=e*c+r*d+a,y[1]=s*c+n*d+o,y[2]=e*h+r*l+a,y[3]=s*h+n*l+o;break;case"arcToSvg":h=y[5],l=y[6],m=y[0],g=y[1],y[0]=e*m+r*g,y[1]=s*m+n*g,y[5]=e*h+r*l+a,y[6]=s*h+n*l+o;break;case"circle":y[4]=_e(y[3],t);break;case"rect":y[4]=_e(y[4],t);break;case"ellipse":y[8]=_e(y[8],t);break;case"roundRect":y[5]=_e(y[5],t);break;case"addPath":y[0].transform(t);break;case"poly":y[2]=_e(y[2],t);break;default:N("unknown transform action",x.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,s=this.instructions[e];if(!s)return t.x=0,t.y=0,t;for(;s.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;s=this.instructions[e]}switch(s.action){case"moveTo":case"lineTo":t.x=s.data[0],t.y=s.data[1];break;case"quadraticCurveTo":t.x=s.data[2],t.y=s.data[3];break;case"bezierCurveTo":t.x=s.data[4],t.y=s.data[5];break;case"arc":case"arcToSvg":t.x=s.data[5],t.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(t);break}return t}}function _e(i,t){return i?i.prepend(t):t.clone()}function j(i,t,e){const s=i.getAttribute(t);return s?Number(s):e}function hc(i,t){const e=i.querySelectorAll("defs");for(let s=0;s<e.length;s++){const r=e[s];for(let n=0;n<r.children.length;n++){const a=r.children[n];switch(a.nodeName.toLowerCase()){case"lineargradient":t.defs[a.id]=lc(a);break;case"radialgradient":t.defs[a.id]=cc();break}}}}function lc(i){const t=j(i,"x1",0),e=j(i,"y1",0),s=j(i,"x2",1),r=j(i,"y2",0),n=i.getAttribute("gradientUnits")||"objectBoundingBox",a=new Pt(t,e,s,r,n==="objectBoundingBox"?"local":"global");for(let o=0;o<i.children.length;o++){const h=i.children[o],l=j(h,"offset",0),c=q.shared.setValue(h.getAttribute("stop-color")).toNumber();a.addColorStop(l,c)}return a}function cc(i){return N("[SVG Parser] Radial gradients are not yet supported"),new Pt(0,0,1,0)}function br(i){const t=i.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const wr={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function ha(i,t){const e=i.getAttribute("style"),s={},r={},n={strokeStyle:s,fillStyle:r,useFill:!1,useStroke:!1};for(const a in wr){const o=i.getAttribute(a);o&&vr(t,n,a,o.trim())}if(e){const a=e.split(";");for(let o=0;o<a.length;o++){const h=a[o].trim(),[l,c]=h.split(":");wr[l]&&vr(t,n,l,c.trim())}}return{strokeStyle:n.useStroke?s:null,fillStyle:n.useFill?r:null,useFill:n.useFill,useStroke:n.useStroke}}function vr(i,t,e,s){switch(e){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const r=br(s);t.strokeStyle.fill=i.defs[r]}else t.strokeStyle.color=q.shared.setValue(s).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const r=br(s);t.fillStyle.fill=i.defs[r]}else t.fillStyle.color=q.shared.setValue(s).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(s);break;case"stroke-opacity":t.strokeStyle.alpha=Number(s);break;case"opacity":t.fillStyle.alpha=Number(s),t.strokeStyle.alpha=Number(s);break}}function dc(i){if(i.length<=2)return!0;const t=i.map(o=>o.area).sort((o,h)=>h-o),[e,s]=t,r=t[t.length-1],n=e/s,a=s/r;return!(n>3&&a<2)}function uc(i){return i.split(/(?=[Mm])/).filter(s=>s.trim().length>0)}function fc(i){const t=i.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),s=[],r=[];for(let c=0;c<e.length;c+=2)c+1<e.length&&(s.push(e[c]),r.push(e[c+1]));if(s.length===0||r.length===0)return 0;const n=Math.min(...s),a=Math.max(...s),o=Math.min(...r),h=Math.max(...r);return(a-n)*(h-o)}function Sr(i,t){const e=new Tt(i,!1);for(const s of e.instructions)t.instructions.push(s)}function pc(i,t){if(typeof i=="string"){const a=document.createElement("div");a.innerHTML=i.trim(),i=a.querySelector("svg")}const e={context:t,defs:{},path:new Tt};hc(i,e);const s=i.children,{fillStyle:r,strokeStyle:n}=ha(i,e);for(let a=0;a<s.length;a++){const o=s[a];o.nodeName.toLowerCase()!=="defs"&&la(o,e,r,n)}return t}function la(i,t,e,s){const r=i.children,{fillStyle:n,strokeStyle:a}=ha(i,t);n&&e?e={...e,...n}:n&&(e=n),a&&s?s={...s,...a}:a&&(s=a);const o=!e&&!s;o&&(e={color:0});let h,l,c,d,f,u,m,g,p,x,y,_,b,S,v,w,E;switch(i.nodeName.toLowerCase()){case"path":{S=i.getAttribute("d");const k=i.getAttribute("fill-rule"),A=uc(S),C=k==="evenodd",G=A.length>1;if(C&&G){const $=A.map(T=>({path:T,area:fc(T)}));if($.sort((T,I)=>I.area-T.area),A.length>3||!dc($))for(let T=0;T<$.length;T++){const I=$[T],le=T===0;t.context.beginPath();const O=new Tt(void 0,!0);Sr(I.path,O),t.context.path(O),le?(e&&t.context.fill(e),s&&t.context.stroke(s)):t.context.cut()}else for(let T=0;T<$.length;T++){const I=$[T],le=T%2===1;t.context.beginPath();const O=new Tt(void 0,!0);Sr(I.path,O),t.context.path(O),le?t.context.cut():(e&&t.context.fill(e),s&&t.context.stroke(s))}}else{const $=k?k==="evenodd":!0;v=new Tt(S,$),t.context.path(v),e&&t.context.fill(e),s&&t.context.stroke(s)}break}case"circle":m=j(i,"cx",0),g=j(i,"cy",0),p=j(i,"r",0),t.context.ellipse(m,g,p,p),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"rect":h=j(i,"x",0),l=j(i,"y",0),w=j(i,"width",0),E=j(i,"height",0),x=j(i,"rx",0),y=j(i,"ry",0),x||y?t.context.roundRect(h,l,w,E,x||y):t.context.rect(h,l,w,E),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"ellipse":m=j(i,"cx",0),g=j(i,"cy",0),x=j(i,"rx",0),y=j(i,"ry",0),t.context.beginPath(),t.context.ellipse(m,g,x,y),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"line":c=j(i,"x1",0),d=j(i,"y1",0),f=j(i,"x2",0),u=j(i,"y2",0),t.context.beginPath(),t.context.moveTo(c,d),t.context.lineTo(f,u),s&&t.context.stroke(s);break;case"polygon":b=i.getAttribute("points"),_=b.match(/\d+/g).map(k=>parseInt(k,10)),t.context.poly(_,!0),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"polyline":b=i.getAttribute("points"),_=b.match(/\d+/g).map(k=>parseInt(k,10)),t.context.poly(_,!1),s&&t.context.stroke(s);break;case"g":case"svg":break;default:{N(`[SVG parser] <${i.nodeName}> elements unsupported`);break}}o&&(e=null);for(let k=0;k<r.length;k++)la(r[k],t,e,s)}function mc(i){return q.isColorLike(i)}function Ar(i){return i instanceof gs}function Cr(i){return i instanceof Pt}function gc(i){return i instanceof D}function xc(i,t,e){const s=q.shared.setValue(t??0);return i.color=s.toNumber(),i.alpha=s.alpha===1?e.alpha:s.alpha,i.texture=D.WHITE,{...e,...i}}function yc(i,t,e){return i.texture=t,{...e,...i}}function Tr(i,t,e){return i.fill=t,i.color=16777215,i.texture=t.texture,i.matrix=t.transform,{...e,...i}}function Mr(i,t,e){return t.buildGradient(),i.fill=t,i.color=16777215,i.texture=t.texture,i.matrix=t.transform,i.textureSpace=t.textureSpace,{...e,...i}}function _c(i,t){const e={...t,...i},s=q.shared.setValue(e.color);return e.alpha*=s.alpha,e.color=s.toNumber(),e}function Yt(i,t){if(i==null)return null;const e={},s=i;return mc(i)?xc(e,i,t):gc(i)?yc(e,i,t):Ar(i)?Tr(e,i,t):Cr(i)?Mr(e,i,t):s.fill&&Ar(s.fill)?Tr(s,s.fill,t):s.fill&&Cr(s.fill)?Mr(s,s.fill,t):_c(s,t)}function ds(i,t){const{width:e,alignment:s,miterLimit:r,cap:n,join:a,pixelLine:o,...h}=t,l=Yt(i,h);return l?{width:e,alignment:s,miterLimit:r,cap:n,join:a,pixelLine:o,...l}:null}const bc=new et,Pr=new F,wi=class bt extends mt{constructor(){super(...arguments),this.uid=X("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new Tt,this._transform=new F,this._fillStyle={...bt.defaultFillStyle},this._strokeStyle={...bt.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new pt,this._boundsDirty=!0}clone(){const t=new bt;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Yt(t,bt.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=ds(t,bt.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Yt(t,bt.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Yt(t,bt.defaultStrokeStyle),this}texture(t,e,s,r,n,a){return this.instructions.push({action:"texture",data:{image:t,dx:s||0,dy:r||0,dw:n||t.frame.width,dh:a||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?q.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new Tt,this}fill(t,e){let s;const r=this.instructions[this.instructions.length-1];return this._tick===0&&(r==null?void 0:r.action)==="stroke"?s=r.data.path:s=this._activePath.clone(),s?(t!=null&&(e!==void 0&&typeof t=="number"&&(R(z,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=Yt(t,bt.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(et.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const s=this.instructions[this.instructions.length-1];return this._tick===0&&(s==null?void 0:s.action)==="fill"?e=s.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=ds(t,bt.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],s=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(s);else{e.data.hole=s;break}}return this._initNextPathLocation(),this}arc(t,e,s,r,n,a){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,s,r,n,a),this}arcTo(t,e,s,r,n){this._tick++;const a=this._transform;return this._activePath.arcTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*s+a.c*r+a.tx,a.b*s+a.d*r+a.ty,n),this}arcToSvg(t,e,s,r,n,a,o){this._tick++;const h=this._transform;return this._activePath.arcToSvg(t,e,s,r,n,h.a*a+h.c*o+h.tx,h.b*a+h.d*o+h.ty),this}bezierCurveTo(t,e,s,r,n,a,o){this._tick++;const h=this._transform;return this._activePath.bezierCurveTo(h.a*t+h.c*e+h.tx,h.b*t+h.d*e+h.ty,h.a*s+h.c*r+h.tx,h.b*s+h.d*r+h.ty,h.a*n+h.c*a+h.tx,h.b*n+h.d*a+h.ty,o),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,s,r){return this._tick++,this._activePath.ellipse(t,e,s,r,this._transform.clone()),this}circle(t,e,s){return this._tick++,this._activePath.circle(t,e,s,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty),this}moveTo(t,e){this._tick++;const s=this._transform,r=this._activePath.instructions,n=s.a*t+s.c*e+s.tx,a=s.b*t+s.d*e+s.ty;return r.length===1&&r[0].action==="moveTo"?(r[0].data[0]=n,r[0].data[1]=a,this):(this._activePath.moveTo(n,a),this)}quadraticCurveTo(t,e,s,r,n){this._tick++;const a=this._transform;return this._activePath.quadraticCurveTo(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,a.a*s+a.c*r+a.tx,a.b*s+a.d*r+a.ty,n),this}rect(t,e,s,r){return this._tick++,this._activePath.rect(t,e,s,r,this._transform.clone()),this}roundRect(t,e,s,r,n){return this._tick++,this._activePath.roundRect(t,e,s,r,n,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,s,r,n=0,a){return this._tick++,this._activePath.regularPoly(t,e,s,r,n,a),this}roundPoly(t,e,s,r,n,a){return this._tick++,this._activePath.roundPoly(t,e,s,r,n,a),this}roundShape(t,e,s,r){return this._tick++,this._activePath.roundShape(t,e,s,r),this}filletRect(t,e,s,r,n){return this._tick++,this._activePath.filletRect(t,e,s,r,n),this}chamferRect(t,e,s,r,n,a){return this._tick++,this._activePath.chamferRect(t,e,s,r,n,a),this}star(t,e,s,r,n=0,a=0){return this._tick++,this._activePath.star(t,e,s,r,n,a,this._transform.clone()),this}svg(t){return this._tick++,pc(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,s,r,n,a){return t instanceof F?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,s,r,n,a),this)}transform(t,e,s,r,n,a){return t instanceof F?(this._transform.append(t),this):(Pr.set(t,e,s,r,n,a),this._transform.append(Pr),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const s=this.instructions[e],r=s.action;if(r==="fill"){const n=s.data;t.addBounds(n.path.bounds)}else if(r==="texture"){const n=s.data;t.addFrame(n.dx,n.dy,n.dx+n.dw,n.dy+n.dh,n.transform)}if(r==="stroke"){const n=s.data,a=n.style.alignment,o=n.style.width*(1-a),h=n.path.bounds;t.addFrame(h.minX-o,h.minY-o,h.maxX+o,h.maxY+o)}}return t}containsPoint(t){var r;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let s=!1;for(let n=0;n<e.length;n++){const a=e[n],o=a.data,h=o.path;if(!a.action||!h)continue;const l=o.style,c=h.shapePath.shapePrimitives;for(let d=0;d<c.length;d++){const f=c[d].shape;if(!l||!f)continue;const u=c[d].transform,m=u?u.applyInverse(t,bc):t;if(a.action==="fill")s=f.contains(m.x,m.y);else{const p=l;s=f.strokeContains(m.x,m.y,p.width,p.alignment)}const g=o.hole;if(g){const p=(r=g.shapePath)==null?void 0:r.shapePrimitives;if(p)for(let x=0;x<p.length;x++)p[x].shape.contains(m.x,m.y)&&(s=!1)}if(s)return!0}}return s}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(s)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(s))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};wi.defaultFillStyle={color:16777215,alpha:1,texture:D.WHITE,matrix:null,fill:null,textureSpace:"local"};wi.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:D.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let at=wi;const vi=class Qt extends mt{constructor(t={}){super(),this.uid=X("textStyle"),this._tick=0,wc(t);const e={...Qt.defaultTextStyle,...t};for(const s in e){const r=s;this[r]=e[s]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...Qt.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...Qt.defaultDropShadow}):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...at.defaultFillStyle,...t},()=>{this._fill=Yt({...this._originalFill},at.defaultFillStyle)})),this._fill=Yt(t===0?"black":t,at.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...at.defaultStrokeStyle,...t},()=>{this._stroke=ds({...this._originalStroke},at.defaultStrokeStyle)})),this._stroke=ds(t,at.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=Qt.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new Qt({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){var s,r,n,a;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const o=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(s=this._fill)!=null&&s.texture&&this._fill.texture.destroy(o),(r=this._originalFill)!=null&&r.texture&&this._originalFill.texture.destroy(o),(n=this._stroke)!=null&&n.texture&&this._stroke.texture.destroy(o),(a=this._originalStroke)!=null&&a.texture&&this._originalStroke.texture.destroy(o)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(s,r,n)=>(s[r]===n||(s[r]=n,e==null||e(r,n),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(q.isColorLike(t)||t instanceof Pt||t instanceof gs)}};vi.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};vi.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Ge=vi;function wc(i){const t=i;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Ge.defaultDropShadow;i.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){R(z,"strokeThickness is now a part of stroke");const e=t.stroke;let s={};if(q.isColorLike(e))s.color=e;else if(e instanceof Pt||e instanceof gs)s.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))s=e;else throw new Error("Invalid stroke value.");i.stroke={...s,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(R(z,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&N("The number of fill colors must match the number of fill gradient stops.");const e=new Pt({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),s=t.fillGradientStops.slice(),r=t.fill.map(n=>q.shared.setValue(n).toNumber());s.forEach((n,a)=>{e.addColorStop(n,r[a])}),i.fill={fill:e}}}class vc{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const s=U.get().createCanvas();s.width=t,s.height=e;const r=s.getContext("2d");return{canvas:s,context:r}}getOptimalCanvasAndContext(t,e,s=1){t=Math.ceil(t*s-1e-6),e=Math.ceil(e*s-1e-6),t=se(t),e=se(e);const r=(t<<17)+(e<<1);this._canvasPool[r]||(this._canvasPool[r]=[]);let n=this._canvasPool[r].pop();return n||(n=this._createCanvasAndContext(t,e)),n}returnCanvasAndContext(t){const e=t.canvas,{width:s,height:r}=e,n=(s<<17)+(r<<1);t.context.resetTransform(),t.context.clearRect(0,0,s,r),this._canvasPool[n].push(t)}clear(){this._canvasPool={}}}const ze=new vc;We.register(ze);const kr=1e5;function us(i,t,e,s=0){if(i.texture===D.WHITE&&!i.fill)return q.shared.setValue(i.color).setAlpha(i.alpha??1).toHexa();if(i.fill){if(i.fill instanceof gs){const r=i.fill,n=t.createPattern(r.texture.source.resource,"repeat"),a=r.transform.copyTo(F.shared);return a.scale(r.texture.frame.width,r.texture.frame.height),n.setTransform(a),n}else if(i.fill instanceof Pt){const r=i.fill,n=r.type==="linear",a=r.textureSpace==="local";let o=1,h=1;a&&e&&(o=e.width+s,h=e.height+s);let l,c=!1;if(n){const{start:d,end:f}=r;l=t.createLinearGradient(d.x*o,d.y*h,f.x*o,f.y*h),c=Math.abs(f.x-d.x)<Math.abs((f.y-d.y)*.1)}else{const{center:d,innerRadius:f,outerCenter:u,outerRadius:m}=r;l=t.createRadialGradient(d.x*o,d.y*h,f*o,u.x*o,u.y*h,m*o)}if(c&&a&&e){const d=e.lineHeight/h;for(let f=0;f<e.lines.length;f++){const u=(f*e.lineHeight+s/2)/h;r.colorStops.forEach(m=>{const g=u+m.offset*d;l.addColorStop(Math.floor(g*kr)/kr,q.shared.setValue(m.color).toHex())})}}else r.colorStops.forEach(d=>{l.addColorStop(d.offset,q.shared.setValue(d.color).toHex())});return l}}else{const r=t.createPattern(i.texture.source.resource,"repeat"),n=i.matrix.copyTo(F.shared);return n.scale(i.texture.frame.width,i.texture.frame.height),r.setTransform(n),r}return N("FillStyle not recognised",i),"red"}const ca=class da extends Vn{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...da.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const s=e.style.clone();e.overrideFill&&(s._fill.color=16777215,s._fill.alpha=1,s._fill.texture=D.WHITE,s._fill.fill=null),this.applyFillAsTint=e.overrideFill;const r=s.fontSize;s.fontSize=this.baseMeasurementFontSize;const n=ls(s);e.overrideSize?s._stroke&&(s._stroke.width*=this.baseRenderedFontSize/r):s.fontSize=this.baseRenderedFontSize=r,this._style=s,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof ie?e.textureStyle:new ie(e.textureStyle)),this.fontMetrics=wt.measureFont(n),this.lineHeight=s.lineHeight||this.fontMetrics.fontSize||s.fontSize}ensureCharacters(t){var p,x;const e=wt.graphemeSegmenter(t).filter(y=>!this._currentChars.includes(y)).filter((y,_,b)=>b.indexOf(y)===_);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let s;this._currentPageIndex===-1?s=this._nextPage():s=this.pages[this._currentPageIndex];let{canvas:r,context:n}=s.canvasAndContext,a=s.texture.source;const o=this._style;let h=this._currentX,l=this._currentY,c=this._currentMaxCharHeight;const d=this.baseRenderedFontSize/this.baseMeasurementFontSize,f=this._padding*d;let u=!1;const m=r.width/this.resolution,g=r.height/this.resolution;for(let y=0;y<e.length;y++){const _=e[y],b=wt.measureText(_,o,r,!1);b.lineHeight=b.height;const S=b.width*d,v=Math.ceil((o.fontStyle==="italic"?2:1)*S),w=b.height*d,E=v+f*2,k=w+f*2;if(u=!1,_!==`
`&&_!=="\r"&&_!=="	"&&_!==" "&&(u=!0,c=Math.ceil(Math.max(k,c))),h+E>m&&(l+=c,c=k,h=0,l+c>g)){a.update();const C=this._nextPage();r=C.canvasAndContext.canvas,n=C.canvasAndContext.context,a=C.texture.source,h=0,l=0,c=0}const A=S/d-(((p=o.dropShadow)==null?void 0:p.distance)??0)-(((x=o._stroke)==null?void 0:x.width)??0);if(this.chars[_]={id:_.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:A,kerning:{}},u){this._drawGlyph(n,b,h+f,l+f,d,o);const C=a.width*d,G=a.height*d,B=new V(h/C*a.width,l/G*a.height,E/C*a.width,k/G*a.height);this.chars[_].texture=new D({source:a,frame:B}),h+=Math.ceil(E)}}a.update(),this._currentX=h,this._currentY=l,this._currentMaxCharHeight=c,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return R(z,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const s=this._measureCache;for(let r=0;r<t.length;r++){const n=t[r];for(let a=0;a<this._currentChars.length;a++){const o=this._currentChars[a];let h=s[n];h||(h=s[n]=e.measureText(n).width);let l=s[o];l||(l=s[o]=e.measureText(o).width);let c=e.measureText(n+o).width,d=c-(h+l);d&&(this.chars[n].kerning[o]=d),c=e.measureText(n+o).width,d=c-(h+l),d&&(this.chars[o].kerning[n]=d)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=ze.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const s=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),r=new D({source:new Xt({resource:e.canvas,resolution:s,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(r.source.style=this._textureStyle);const n={canvasAndContext:e,texture:r};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,s){e.fontSize=this.baseRenderedFontSize,t.scale(s,s),t.font=ls(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const r=e._stroke,n=(r==null?void 0:r.width)??0;if(r&&(t.lineWidth=n,t.lineJoin=r.join,t.miterLimit=r.miterLimit,t.strokeStyle=us(r,t)),e._fill&&(t.fillStyle=us(e._fill,t)),e.dropShadow){const a=e.dropShadow,o=q.shared.setValue(a.color).toArray(),h=a.blur*s,l=a.distance*s;t.shadowColor=`rgba(${o[0]*255},${o[1]*255},${o[2]*255},${a.alpha})`,t.shadowBlur=h,t.shadowOffsetX=Math.cos(a.angle)*l,t.shadowOffsetY=Math.sin(a.angle)*l}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,s,r,n,a){const o=e.text,h=e.fontProperties,l=a._stroke,c=((l==null?void 0:l.width)??0)*n,d=s+c/2,f=r-c/2,u=h.descent*n,m=e.lineHeight*n;let g=!1;a.stroke&&c&&(g=!0,t.strokeText(o,d,f+m-u));const{shadowBlur:p,shadowOffsetX:x,shadowOffsetY:y}=t;a._fill&&(g&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(o,d,f+m-u)),g&&(t.shadowBlur=p,t.shadowOffsetX=x,t.shadowOffsetY=y)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:s}=this.pages[t];ze.returnCanvasAndContext(e),s.destroy(!0)}this.pages=null}};ca.defaultOptions={textureSize:512,style:new Ge,mipmap:!0};let Er=ca;function Sc(i,t,e,s){const r={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};r.offsetY=e.baseLineOffset;let n=r.lines[0],a=null,o=!0;const h={width:0,start:0,index:0,positions:[],chars:[]},l=e.baseMeasurementFontSize/t.fontSize,c=t.letterSpacing*l,d=t.wordWrapWidth*l,f=t.lineHeight?t.lineHeight*l:e.lineHeight,u=t.wordWrap&&t.breakWords,m=x=>{const y=n.width;for(let _=0;_<h.index;_++){const b=x.positions[_];n.chars.push(x.chars[_]),n.charPositions.push(b+y)}n.width+=x.width,o=!1,h.width=0,h.index=0,h.chars.length=0},g=()=>{let x=n.chars.length-1;if(s){let y=n.chars[x];for(;y===" ";)n.width-=e.chars[y].xAdvance,y=n.chars[--x]}r.width=Math.max(r.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,r.lines.push(n),r.height+=f},p=x=>x-c>d;for(let x=0;x<i.length+1;x++){let y;const _=x===i.length;_||(y=i[x]);const b=e.chars[y]||e.chars[" "];if(/(?:\s)/.test(y)||y==="\r"||y===`
`||_){if(!o&&t.wordWrap&&p(n.width+h.width)?(g(),m(h),_||n.charPositions.push(0)):(h.start=n.width,m(h),_||n.charPositions.push(0)),y==="\r"||y===`
`)g();else if(!_){const E=b.xAdvance+(b.kerning[a]||0)+c;n.width+=E,n.spaceWidth=E,n.spacesIndex.push(n.charPositions.length),n.chars.push(y)}}else{const w=b.kerning[a]||0,E=b.xAdvance+w+c;u&&p(n.width+h.width+E)&&(m(h),g()),h.positions[h.index++]=h.width+w,h.chars.push(y),h.width+=E}a=y}return g(),t.align==="center"?Ac(r):t.align==="right"?Cc(r):t.align==="justify"&&Tc(r),r}function Ac(i){for(let t=0;t<i.lines.length;t++){const e=i.lines[t],s=i.width/2-e.width/2;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=s}}function Cc(i){for(let t=0;t<i.lines.length;t++){const e=i.lines[t],s=i.width-e.width;for(let r=0;r<e.charPositions.length;r++)e.charPositions[r]+=s}}function Tc(i){const t=i.width;for(let e=0;e<i.lines.length;e++){const s=i.lines[e];let r=0,n=s.spacesIndex[r++],a=0;const o=s.spacesIndex.length,l=(t-s.width)/o;for(let c=0;c<s.charPositions.length;c++)c===n&&(n=s.spacesIndex[r++],a+=l),s.charPositions[c]+=a}}function Mc(i){if(i==="")return[];typeof i=="string"&&(i=[i]);const t=[];for(let e=0,s=i.length;e<s;e++){const r=i[e];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);if(r[0].length===0||r[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const n=r[0].charCodeAt(0),a=r[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,h=a;o<=h;o++)t.push(String.fromCharCode(o))}else t.push(...Array.from(r))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let rs=0;class Pc{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=Yn(1e3)}getFont(t,e){var a;let s=`${e.fontFamily}-bitmap`,r=!0;if(e._fill.fill&&!e._stroke?(s+=e._fill.fill.styleKey,r=!1):(e._stroke||e.dropShadow)&&(s=`${e.styleKey}-bitmap`,r=!1),!H.has(s)){const o=Object.create(e);o.lineHeight=0;const h=new Er({style:o,overrideFill:r,overrideSize:!0,...this.defaultOptions});rs++,rs>50&&N("BitmapText",`You have dynamically created ${rs} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),h.once("destroy",()=>{rs--,H.remove(s)}),H.set(s,h)}const n=H.get(s);return(a=n.ensureCharacters)==null||a.call(n,t),n}getLayout(t,e,s=!0){const r=this.getFont(t,e),n=`${t}-${e.styleKey}-${s}`;if(this.measureCache.has(n))return this.measureCache.get(n);const a=wt.graphemeSegmenter(t),o=Sc(a,e,r,s);return this.measureCache.set(n,o),o}measureText(t,e,s=!0){return this.getLayout(t,e,s)}install(...t){var l,c,d,f;let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:(l=t[2])==null?void 0:l.chars,resolution:(c=t[2])==null?void 0:c.resolution,padding:(d=t[2])==null?void 0:d.padding,skipKerning:(f=t[2])==null?void 0:f.skipKerning},R(z,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const s=e==null?void 0:e.name;if(!s)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const r=e.style,n=r instanceof Ge?r:new Ge(r),a=e.dynamicFill??this._canUseTintForStyle(n),o=new Er({style:n,overrideFill:a,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),h=Mc(e.chars);return o.ensureCharacters(h.join("")),H.set(`${s}-bitmap`,o),o.once("destroy",()=>H.remove(`${s}-bitmap`)),o}uninstall(t){const e=`${t}-bitmap`,s=H.get(e);s&&s.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const Ir=new Pc;class ua extends Vn{constructor(t,e){super();const{textures:s,data:r}=t;Object.keys(r.pages).forEach(n=>{const a=r.pages[parseInt(n,10)],o=s[a.id];this.pages.push({texture:o})}),Object.keys(r.chars).forEach(n=>{const a=r.chars[n],{frame:o,source:h,rotate:l}=s[a.page],c=W.transformRectCoords(a,o,l,new V),d=new D({frame:c,orig:new V(0,0,a.width,a.height),source:h,rotate:l});this.chars[n]={id:n.codePointAt(0),xOffset:a.xOffset,yOffset:a.yOffset,xAdvance:a.xAdvance,kerning:a.kerning??{},texture:d}}),this.baseRenderedFontSize=r.fontSize,this.baseMeasurementFontSize=r.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:r.fontSize},this.baseLineOffset=r.baseLineOffset,this.lineHeight=r.lineHeight,this.fontFamily=r.fontFamily,this.distanceField=r.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){Ir.install(t)}static uninstall(t){Ir.uninstall(t)}}const $s={test(i){return typeof i=="string"&&i.startsWith("info face=")},parse(i){const t=i.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const d in t){const f=t[d].match(/^[a-z]+/gm)[0],u=t[d].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),m={};for(const g in u){const p=u[g].split("="),x=p[0],y=p[1].replace(/"/gm,""),_=parseFloat(y),b=isNaN(_)?y:_;m[x]=b}e[f].push(m)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=e.info,[n]=e.common,[a]=e.distanceField??[];a&&(s.distanceField={range:parseInt(a.distanceRange,10),type:a.fieldType}),s.fontSize=parseInt(r.size,10),s.fontFamily=r.face,s.lineHeight=parseInt(n.lineHeight,10);const o=e.page;for(let d=0;d<o.length;d++)s.pages.push({id:parseInt(o[d].id,10)||0,file:o[d].file});const h={};s.baseLineOffset=s.lineHeight-parseInt(n.base,10);const l=e.char;for(let d=0;d<l.length;d++){const f=l[d],u=parseInt(f.id,10);let m=f.letter??f.char??String.fromCharCode(u);m==="space"&&(m=" "),h[u]=m,s.chars[m]={id:u,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}const c=e.kerning||[];for(let d=0;d<c.length;d++){const f=parseInt(c[d].first,10),u=parseInt(c[d].second,10),m=parseInt(c[d].amount,10);s.chars[h[u]].kerning[h[f]]=m}return s}},Br={test(i){const t=i;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(i){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=i.getElementsByTagName("info")[0],s=i.getElementsByTagName("common")[0],r=i.getElementsByTagName("distanceField")[0];r&&(t.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const n=i.getElementsByTagName("page"),a=i.getElementsByTagName("char"),o=i.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let l=0;l<n.length;l++)t.pages.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});const h={};t.baseLineOffset=t.lineHeight-parseInt(s.getAttribute("base"),10);for(let l=0;l<a.length;l++){const c=a[l],d=parseInt(c.getAttribute("id"),10);let f=c.getAttribute("letter")??c.getAttribute("char")??String.fromCharCode(d);f==="space"&&(f=" "),h[d]=f,t.chars[f]={id:d,page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xOffset:parseInt(c.getAttribute("xoffset"),10),yOffset:parseInt(c.getAttribute("yoffset"),10),xAdvance:parseInt(c.getAttribute("xadvance"),10),kerning:{}}}for(let l=0;l<o.length;l++){const c=parseInt(o[l].getAttribute("first"),10),d=parseInt(o[l].getAttribute("second"),10),f=parseInt(o[l].getAttribute("amount"),10);t.chars[h[d]].kerning[h[c]]=f}return t}},Rr={test(i){return typeof i=="string"&&i.includes("<font>")?Br.test(U.get().parseXML(i)):!1},parse(i){return Br.parse(U.get().parseXML(i))}},kc=[".xml",".fnt"],Ec={extension:{type:P.CacheParser,name:"cacheBitmapFont"},test:i=>i instanceof ua,getCacheableAssets(i,t){const e={};return i.forEach(s=>{e[s]=t,e[`${s}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},Ic={extension:{type:P.LoadParser,priority:Ft.Normal},name:"loadBitmapFont",id:"bitmap-font",test(i){return kc.includes(nt.extname(i).toLowerCase())},async testParse(i){return $s.test(i)||Rr.test(i)},async parse(i,t,e){const s=$s.test(i)?$s.parse(i):Rr.parse(i),{src:r}=t,{pages:n}=s,a=[],o=s.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let d=0;d<n.length;++d){const f=n[d].file;let u=nt.join(nt.dirname(r),f);u=Js(u,r),a.push({src:u,data:o})}const h=await e.load(a),l=a.map(d=>h[d.src]);return new ua({data:s,textures:l},r)},async load(i,t){return await(await U.get().fetch(i)).text()},async unload(i,t,e){await Promise.all(i.pages.map(s=>e.unload(s.texture.source._sourceOrigin))),i.destroy()}};class Bc{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<e;s++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Rc={extension:{type:P.CacheParser,name:"cacheTextureArray"},test:i=>Array.isArray(i)&&i.every(t=>t instanceof D),getCacheableAssets:(i,t)=>{const e={};return i.forEach(s=>{t.forEach((r,n)=>{e[s+(n===0?"":n+1)]=r})}),e}};async function fa(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Fc={extension:{type:P.DetectionParser,priority:1},test:async()=>fa("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")},Fr=["png","jpg","jpeg"],Lc={extension:{type:P.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Fr],remove:async i=>i.filter(t=>!Fr.includes(t))},Dc="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ys(i){return Dc?!1:document.createElement("video").canPlayType(i)!==""}const Oc={extension:{type:P.DetectionParser,priority:0},test:async()=>ys("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")},Gc={extension:{type:P.DetectionParser,priority:0},test:async()=>ys("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")},zc={extension:{type:P.DetectionParser,priority:0},test:async()=>ys("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")},Wc={extension:{type:P.DetectionParser,priority:0},test:async()=>fa("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")},pa=class os{constructor(){this.loadOptions={...os.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,s)=>(this._parsersValidated=!1,t[e]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const s={promise:null,parser:null};return s.promise=(async()=>{var a,o;let r=null,n=null;if((e.parser||e.loadParser)&&(n=this._parserHash[e.parser||e.loadParser],e.loadParser&&N(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),n||N(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!n){for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];if(l.load&&((a=l.test)!=null&&a.call(l,t,e,this))){n=l;break}}if(!n)return N(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await n.load(t,e,this),s.parser=n;for(let h=0;h<this.parsers.length;h++){const l=this.parsers[h];l.parse&&l.parse&&await((o=l.testParse)==null?void 0:o.call(l,r,e,this))&&(r=await l.parse(r,e,this)||r,s.parser=l)}return r})(),s}async load(t,e){this._parsersValidated||this._validateParsers();const s=typeof e=="function"?{...os.defaultOptions,...this.loadOptions,onProgress:e}:{...os.defaultOptions,...this.loadOptions,...e||{}},{onProgress:r,onError:n,strategy:a,retryCount:o,retryDelay:h}=s;let l=0;const c={},d=hs(t),f=ut(t,g=>({alias:[g],src:g,data:{}})),u=f.reduce((g,p)=>g+(p.progressSize||1),0),m=f.map(async g=>{const p=nt.toAbsolute(g.src);c[g.src]||(await this._loadAssetWithRetry(p,g,{onProgress:r,onError:n,strategy:a,retryCount:o,retryDelay:h},c),l+=g.progressSize||1,r&&r(l/u))});return await Promise.all(m),d?c[f[0].src]:c}async unload(t){const s=ut(t,r=>({alias:[r],src:r})).map(async r=>{var o,h;const n=nt.toAbsolute(r.src),a=this.promiseCache[n];if(a){const l=await a.promise;delete this.promiseCache[n],await((h=(o=a.parser)==null?void 0:o.unload)==null?void 0:h.call(o,l,r,this))}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?N("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&N(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}async _loadAssetWithRetry(t,e,s,r){let n=0;const{onError:a,strategy:o,retryCount:h,retryDelay:l}=s,c=d=>new Promise(f=>setTimeout(f,d));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,e)),r[e.src]=await this.promiseCache[t].promise;return}catch(d){delete this.promiseCache[t],delete r[e.src],n++;const f=o!=="retry"||n>h;if(o==="retry"&&!f){a&&a(d,e),await c(l);continue}if(o==="skip"){a&&a(d,e);return}throw a&&a(d,e),new Error(`[Loader.load] Failed to load ${t}.
${d}`)}}};pa.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let Uc=pa;function oe(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function he(i,t){const e=i.split("?")[0],s=nt.extname(e).toLowerCase();return Array.isArray(t)?t.includes(s):s===t}const $c=".json",Hc="application/json",Nc={extension:{type:P.LoadParser,priority:Ft.Low},name:"loadJson",id:"json",test(i){return oe(i,Hc)||he(i,$c)},async load(i){return await(await U.get().fetch(i)).json()}},Vc=".txt",Yc="text/plain",jc={name:"loadTxt",id:"text",extension:{type:P.LoadParser,priority:Ft.Low,name:"loadTxt"},test(i){return oe(i,Yc)||he(i,Vc)},async load(i){return await(await U.get().fetch(i)).text()}},Xc=["normal","bold","100","200","300","400","500","600","700","800","900"],qc=[".ttf",".otf",".woff",".woff2"],Kc=["font/ttf","font/otf","font/woff","font/woff2"],Zc=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Qc(i){const t=nt.extname(i),r=nt.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1));let n=r.length>0;for(const o of r)if(!o.match(Zc)){n=!1;break}let a=r.join(" ");return n||(a=`"${a.replace(/[\\"]/g,"\\$&")}"`),a}const Jc=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function td(i){return Jc.test(i)?i:encodeURI(i)}const ed={extension:{type:P.LoadParser,priority:Ft.Low},name:"loadWebFont",id:"web-font",test(i){return oe(i,Kc)||he(i,qc)},async load(i,t){var s,r,n;const e=U.get().getFontFaceSet();if(e){const a=[],o=((s=t.data)==null?void 0:s.family)??Qc(i),h=((n=(r=t.data)==null?void 0:r.weights)==null?void 0:n.filter(c=>Xc.includes(c)))??["normal"],l=t.data??{};for(let c=0;c<h.length;c++){const d=h[c],f=new FontFace(o,`url(${td(i)})`,{...l,weight:d});await f.load(),e.add(f),a.push(f)}return H.has(`${o}-and-url`)?H.get(`${o}-and-url`).entries.push({url:i,faces:a}):H.set(`${o}-and-url`,{entries:[{url:i,faces:a}]}),a.length===1?a[0]:a}return N("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){const t=Array.isArray(i)?i:[i],e=t[0].family,s=H.get(`${e}-and-url`),r=s.entries.find(n=>n.faces.some(a=>t.indexOf(a)!==-1));r.faces=r.faces.filter(n=>t.indexOf(n)===-1),r.faces.length===0&&(s.entries=s.entries.filter(n=>n!==r)),t.forEach(n=>{U.get().getFontFaceSet().delete(n)}),s.entries.length===0&&H.remove(`${e}-and-url`)}};function Si(i,t=1){var s;const e=(s=ae.RETINA_PREFIX)==null?void 0:s.exec(i);return e?parseFloat(e[1]):t}function Ai(i,t,e){i.label=e,i._sourceOrigin=e;const s=new D({source:i,label:e}),r=()=>{delete t.promiseCache[e],H.has(e)&&H.remove(e)};return s.source.once("destroy",()=>{t.promiseCache[e]&&(N("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),r())}),s.once("destroy",()=>{i.destroyed||(N("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),s}const sd=".svg",id="image/svg+xml",rd={extension:{type:P.LoadParser,priority:Ft.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(i){return oe(i,id)||he(i,sd)},async load(i,t,e){var s;return((s=t.data)==null?void 0:s.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?ad(i):nd(i,t,e,this.config.crossOrigin)},unload(i){i.destroy(!0)}};async function nd(i,t,e,s){var p,x,y;const r=await U.get().fetch(i),n=U.get().createImage();n.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await r.text())}`,n.crossOrigin=s,await n.decode();const a=((p=t.data)==null?void 0:p.width)??n.width,o=((x=t.data)==null?void 0:x.height)??n.height,h=((y=t.data)==null?void 0:y.resolution)||Si(i),l=Math.ceil(a*h),c=Math.ceil(o*h),d=U.get().createCanvas(l,c),f=d.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(n,0,0,a*h,o*h);const{parseAsGraphicsContext:u,...m}=t.data??{},g=new Xt({resource:d,alphaMode:"premultiply-alpha-on-upload",resolution:h,...m});return Ai(g,e,i)}async function ad(i){const e=await(await U.get().fetch(i)).text(),s=new at;return s.svg(e),s}const od=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let te=null,ci=class{constructor(){te||(te=URL.createObjectURL(new Blob([od],{type:"application/javascript"}))),this.worker=new Worker(te)}};ci.revokeObjectURL=function(){te&&(URL.revokeObjectURL(te),te=null)};const hd=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let ee=null;class ma{constructor(){ee||(ee=URL.createObjectURL(new Blob([hd],{type:"application/javascript"}))),this.worker=new Worker(ee)}}ma.revokeObjectURL=function(){ee&&(URL.revokeObjectURL(ee),ee=null)};let Lr=0,Hs;class ld{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new ci;e.addEventListener("message",s=>{e.terminate(),ci.revokeObjectURL(),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){var s;return this._run("loadImageBitmap",[t,(s=e==null?void 0:e.data)==null?void 0:s.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){Hs===void 0&&(Hs=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<Hs&&(this._createdWorkers++,t=new ma().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){this._resolveHash[t.uuid]&&(t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),delete this._resolveHash[t.uuid])}async _run(t,e){await this._initWorkers();const s=new Promise((r,n)=>{this._queue.push({id:t,arguments:e,resolve:r,reject:n})});return this._next(),s}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),s=e.id;this._resolveHash[Lr]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Lr++,id:s})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t==null||t(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const Dr=new ld,cd=[".jpeg",".jpg",".png",".webp",".avif"],dd=["image/jpeg","image/png","image/webp","image/avif"];async function ud(i,t){var r;const e=await U.get().fetch(i);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${e.status} ${e.statusText}`);const s=await e.blob();return((r=t==null?void 0:t.data)==null?void 0:r.alphaMode)==="premultiplied-alpha"?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const ga={name:"loadTextures",id:"texture",extension:{type:P.LoadParser,priority:Ft.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return oe(i,dd)||he(i,cd)},async load(i,t,e){var n;let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Dr.isImageBitmapSupported()?s=await Dr.loadImageBitmap(i,t):s=await ud(i,t):s=await new Promise((a,o)=>{s=U.get().createImage(),s.crossOrigin=this.config.crossOrigin,s.src=i,s.complete?a(s):(s.onload=()=>{a(s)},s.onerror=o)});const r=new Xt({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:((n=t.data)==null?void 0:n.resolution)||Si(i),...t.data});return Ai(r,e,i)},unload(i){i.destroy(!0)}},fd=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let Ns,Vs;function pd(i,t,e){e===void 0&&!t.startsWith("data:")?i.crossOrigin=gd(t):e!==!1&&(i.crossOrigin=typeof e=="string"?e:"anonymous")}function md(i){return new Promise((t,e)=>{i.addEventListener("canplaythrough",s),i.addEventListener("error",r),i.load();function s(){n(),t()}function r(a){n(),e(a)}function n(){i.removeEventListener("canplaythrough",s),i.removeEventListener("error",r)}})}function gd(i,t=globalThis.location){if(i.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function xd(){const i=[],t=[];for(const e of fd){const s=Me.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;ys(s)&&(i.push(e),t.includes(s)||t.push(s))}return{validVideoExtensions:i,validVideoMime:t}}const yd={name:"loadVideo",id:"video",extension:{type:P.LoadParser,name:"loadVideo"},test(i){if(!Ns||!Vs){const{validVideoExtensions:s,validVideoMime:r}=xd();Ns=s,Vs=r}const t=oe(i,Vs),e=he(i,Ns);return t||e},async load(i,t,e){var h,l;const s={...Me.defaultOptions,resolution:((h=t.data)==null?void 0:h.resolution)||Si(i),alphaMode:((l=t.data)==null?void 0:l.alphaMode)||await bn(),...t.data},r=document.createElement("video"),n={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(n).forEach(c=>{const d=n[c];d!==void 0&&r.setAttribute(c,d)}),s.muted===!0&&(r.muted=!0),pd(r,i,s.crossorigin);const a=document.createElement("source");let o;if(s.mime)o=s.mime;else if(i.startsWith("data:"))o=i.slice(5,i.indexOf(";"));else if(!i.startsWith("blob:")){const c=i.split("?")[0].slice(i.lastIndexOf(".")+1).toLowerCase();o=Me.MIME_TYPES[c]||`video/${c}`}return a.src=i,o&&(a.type=o),new Promise(c=>{const d=async()=>{const f=new Me({...s,resource:r});r.removeEventListener("canplay",d),t.data.preload&&await md(r),c(Ai(f,e,i))};s.preload&&!s.autoPlay&&r.load(),r.addEventListener("canplay",d),r.appendChild(a)})},unload(i){i.destroy(!0)}},xa={extension:{type:P.ResolveParser,name:"resolveTexture"},test:ga.test,parse:i=>{var t;return{resolution:parseFloat(((t=ae.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:i.split(".").pop(),src:i}}},_d={extension:{type:P.ResolveParser,priority:-2,name:"resolveJson"},test:i=>ae.RETINA_PREFIX.test(i)&&i.endsWith(".json"),parse:xa.parse};class bd{constructor(){this._detections=[],this._initialized=!1,this.resolver=new ae,this.loader=new Uc,this.cache=H,this._backgroundLoader=new Bc(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var n,a;if(this._initialized){N("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let o=t.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}const e=((n=t.texturePreference)==null?void 0:n.resolution)??1,s=typeof e=="number"?[e]:e,r=await this._detectFormats({preferredFormats:(a=t.texturePreference)==null?void 0:a.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:s}}),t.preferences&&this.setPreferences(t.preferences),t.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...t.loadOptions})}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const s=hs(t),r=ut(t).map(o=>{if(typeof o!="string"){const h=this.resolver.getAlias(o);return h.some(l=>!this.resolver.hasKey(l))&&this.add(o),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),n=this.resolver.resolve(r),a=await this._mapLoadToResolve(n,e);return s?a[r[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let s=!1;typeof t=="string"&&(s=!0,t=[t]);const r=this.resolver.resolveBundle(t),n={},a=Object.keys(r);let o=0;const h=[],l=()=>{e==null||e(h.reduce((d,f)=>d+f,0)/o)},c=a.map((d,f)=>{const u=r[d],m=Object.values(u),p=[...new Set(m.flat())].reduce((x,y)=>x+(y.progressSize||1),0);return h.push(0),o+=p,this._mapLoadToResolve(u,x=>{h[f]=x*p,l()}).then(x=>{n[d]=x})});return await Promise.all(c),s?n[t[0]]:n}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return H.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=H.get(t[s]);return e}async _mapLoadToResolve(t,e){const s=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const r=await this.loader.load(s,e);this._backgroundLoader.active=!0;const n={};return s.forEach(a=>{const o=r[a.src],h=[a.src];a.alias&&h.push(...a.alias),h.forEach(l=>{n[l]=o}),H.set(h,o)}),n}async unload(t){this._initialized||await this.init();const e=ut(t).map(r=>typeof r!="string"?r.src:r),s=this.resolver.resolve(e);await this._unloadFromResolved(s)}async unloadBundle(t){this._initialized||await this.init(),t=ut(t);const e=this.resolver.resolveBundle(t),s=Object.keys(e).map(r=>this._unloadFromResolved(e[r]));await Promise.all(s)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(s=>{H.remove(s.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const s of t.detections)t.skipDetections||await s.test()?e=await s.add(e):t.skipDetections||(e=await s.remove(e));return e=e.filter((s,r)=>e.indexOf(s)===r),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(s=>s in t).forEach(s=>{e.config[s]=t[s]})})}}const At=new bd;tt.handleByList(P.LoadParser,At.loader.parsers).handleByList(P.ResolveParser,At.resolver.parsers).handleByList(P.CacheParser,At.cache.parsers).handleByList(P.DetectionParser,At.detections);tt.add(Rc,Lc,Fc,Wc,Oc,Gc,zc,Nc,jc,ed,rd,ga,yd,Ic,Ec,xa,_d);const Or={loader:P.LoadParser,resolver:P.ResolveParser,cache:P.CacheParser,detection:P.DetectionParser};tt.handle(P.Asset,i=>{const t=i.ref;Object.entries(Or).filter(([e])=>!!t[e]).forEach(([e,s])=>tt.add(Object.assign(t[e],{extension:t[e].extension??s})))},i=>{const t=i.ref;Object.keys(Or).filter(e=>!!t[e]).forEach(e=>tt.remove(t[e]))});class lt extends fi{constructor(t){t instanceof at&&(t={context:t});const{context:e,roundPixels:s,...r}=t||{};super({label:"Graphics",...r}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new at,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=s??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new lt(this._context.clone()):(this._ownedContext=null,new lt(this._context))}lineStyle(t,e,s){R(z,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const r={};return t&&(r.width=t),e&&(r.color=e),s&&(r.alpha=s),this.context.strokeStyle=r,this}beginFill(t,e){R(z,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return t!==void 0&&(s.color=t),e!==void 0&&(s.alpha=e),this.context.fillStyle=s,this}endFill(){R(z,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==at.defaultStrokeStyle.width||t.color!==at.defaultStrokeStyle.color||t.alpha!==at.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return R(z,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return R(z,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return R(z,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return R(z,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return R(z,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return R(z,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}class wd extends fi{constructor(t,e){const{text:s,resolution:r,style:n,anchor:a,width:o,height:h,roundPixels:l,...c}=t;super({...c}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=s??"",this.style=n,this.resolution=r??null,this.allowChildren=!1,this._anchor=new Q({_onUpdate:()=>{this.onViewUpdate()}}),a&&(this.anchor=a),this.roundPixels=l??!1,o!==void 0&&(this.width=o),h!==void 0&&(this.height=h)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),(e=this._style)==null||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,s=this.bounds.height,r=-e*this.anchor.x;let n=0;return t.x>=r&&t.x<=r+e&&(n=-s*this.anchor.y,t.y>=n&&t.y<=n+s)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t!=null&&t.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function vd(i,t){let e=i[0]??{};return(typeof e=="string"||i[1])&&(R(z,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:i[1]}),e}let Wt=null,St=null;function Sd(i,t){Wt||(Wt=U.get().createCanvas(256,128),St=Wt.getContext("2d",{willReadFrequently:!0}),St.globalCompositeOperation="copy",St.globalAlpha=1),(Wt.width<i||Wt.height<t)&&(Wt.width=se(i),Wt.height=se(t))}function Gr(i,t,e){for(let s=0,r=4*e*t;s<t;++s,r+=4)if(i[r+3]!==0)return!1;return!0}function zr(i,t,e,s,r){const n=4*t;for(let a=s,o=s*n+4*e;a<=r;++a,o+=n)if(i[o+3]!==0)return!1;return!0}function Ad(...i){let t=i[0];t.canvas||(t={canvas:i[0],resolution:i[1]});const{canvas:e}=t,s=Math.min(t.resolution??1,1),r=t.width??e.width,n=t.height??e.height;let a=t.output;if(Sd(r,n),!St)throw new TypeError("Failed to get canvas 2D context");St.drawImage(e,0,0,r,n,0,0,r*s,n*s);const h=St.getImageData(0,0,r,n).data;let l=0,c=0,d=r-1,f=n-1;for(;c<n&&Gr(h,r,c);)++c;if(c===n)return V.EMPTY;for(;Gr(h,r,f);)--f;for(;zr(h,r,l,c,f);)++l;for(;zr(h,r,d,c,f);)--d;return++d,++f,St.globalCompositeOperation="source-over",St.strokeRect(l,c,d-l,f-c),St.globalCompositeOperation="copy",a??(a=new V),a.set(l/s,c/s,(d-l)/s,(f-c)/s),a}const Wr=new V;class Cd{getCanvasAndContext(t){const{text:e,style:s,resolution:r=1}=t,n=s._getFinalPadding(),a=wt.measureText(e||" ",s),o=Math.ceil(Math.ceil(Math.max(1,a.width)+n*2)*r),h=Math.ceil(Math.ceil(Math.max(1,a.height)+n*2)*r),l=ze.getOptimalCanvasAndContext(o,h);this._renderTextToCanvas(e,s,n,r,l);const c=s.trim?Ad({canvas:l.canvas,width:o,height:h,resolution:1,output:Wr}):Wr.set(0,0,o,h);return{canvasAndContext:l,frame:c}}returnCanvasAndContext(t){ze.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,s,r,n){var _,b,S,v;const{canvas:a,context:o}=n,h=ls(e),l=wt.measureText(t||" ",e),c=l.lines,d=l.lineHeight,f=l.lineWidths,u=l.maxLineWidth,m=l.fontProperties,g=a.height;if(o.resetTransform(),o.scale(r,r),o.textBaseline=e.textBaseline,(_=e._stroke)!=null&&_.width){const w=e._stroke;o.lineWidth=w.width,o.miterLimit=w.miterLimit,o.lineJoin=w.join,o.lineCap=w.cap}o.font=h;let p,x;const y=e.dropShadow?2:1;for(let w=0;w<y;++w){const E=e.dropShadow&&w===0,k=E?Math.ceil(Math.max(1,g)+s*2):0,A=k*r;if(E){o.fillStyle="black",o.strokeStyle="black";const B=e.dropShadow,$=B.color,kt=B.alpha;o.shadowColor=q.shared.setValue($).setAlpha(kt).toRgbaString();const T=B.blur*r,I=B.distance*r;o.shadowBlur=T,o.shadowOffsetX=Math.cos(B.angle)*I,o.shadowOffsetY=Math.sin(B.angle)*I+A}else{if(o.fillStyle=e._fill?us(e._fill,o,l,s*2):null,(b=e._stroke)!=null&&b.width){const B=e._stroke.width*.5+s*2;o.strokeStyle=us(e._stroke,o,l,B)}o.shadowColor="black"}let C=(d-m.fontSize)/2;d-m.fontSize<0&&(C=0);const G=((S=e._stroke)==null?void 0:S.width)??0;for(let B=0;B<c.length;B++)p=G/2,x=G/2+B*d+m.ascent+C,e.align==="right"?p+=u-f[B]:e.align==="center"&&(p+=(u-f[B])/2),(v=e._stroke)!=null&&v.width&&this._drawLetterSpacing(c[B],e,n,p+s,x+s-k,!0),e._fill!==void 0&&this._drawLetterSpacing(c[B],e,n,p+s,x+s-k)}}_drawLetterSpacing(t,e,s,r,n,a=!1){const{context:o}=s,h=e.letterSpacing;let l=!1;if(wt.experimentalLetterSpacingSupported&&(wt.experimentalLetterSpacing?(o.letterSpacing=`${h}px`,o.textLetterSpacing=`${h}px`,l=!0):(o.letterSpacing="0px",o.textLetterSpacing="0px")),h===0||l){a?o.strokeText(t,r,n):o.fillText(t,r,n);return}let c=r;const d=wt.graphemeSegmenter(t);let f=o.measureText(t).width,u=0;for(let m=0;m<d.length;++m){const g=d[m];a?o.strokeText(g,c,n):o.fillText(g,c,n);let p="";for(let x=m+1;x<d.length;++x)p+=d[x];u=o.measureText(p).width,c+=f-u+h,f=u}}}const Ur=new Cd;class ft extends wd{constructor(...t){const e=vd(t,"Text");super(e,Ge),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof ie?e.textureStyle:new ie(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let s=0,r=0;if(this._style.trim){const{frame:n,canvasAndContext:a}=Ur.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Ur.returnCanvasAndContext(a),s=n.width,r=n.height}else{const n=wt.measureText(this._text,this._style);s=n.width,r=n.height}t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*r,t.maxY=t.minY+r}}tt.add(Pa,ka);function ya(){var r;const i=(r=window.Telegram)==null?void 0:r.WebApp;let t=window.innerWidth,e=window.innerHeight;if(i&&i.viewportStableHeight?(e=i.viewportStableHeight,console.log("Using Telegram stable viewport height:",e)):i&&i.viewportHeight&&(e=i.viewportHeight,console.log("Using Telegram viewport height:",e)),i&&i.safeAreaInset){const n=i.safeAreaInset.top||0,a=i.safeAreaInset.bottom||0;e=e-n-a,console.log(`Adjusting for safe area insets - top: ${n}, bottom: ${a}`)}return t=Math.max(320,t),e=Math.max(400,e),t/e>1&&(t=Math.min(t,e*1.5)),{width:t,height:e}}const $r=ya(),L={width:$r.width,height:$r.height,backgroundColor:991271,spawnInterval:50,defaultLocale:"lt",itemTypes:{CHIMKE:"chimke",VORINIO_DUMAI:"vorinio_dumai",VORINIO_SNIEGAS:"vorinio_sniegas",BUCKET:"bucket"}},_a={url:window.location.hostname==="localhost"?"ws://localhost:8080":"wss://server.pax.lt:8080"};function ba(){const i=ya(),t=L.width,e=L.height;L.width=i.width,L.height=i.height,console.log(`Game dimensions updated: ${t}x${e} -> ${L.width}x${L.height}`)}const Ae={scale:.8,yOffset:80,minX:40,maxXOffset:40},Z={minScale:.4,maxScale:.7,baseMinSpeed:2,baseMaxSpeed:3.5,minRotationSpeed:-.08,maxRotationSpeed:.08,minSwingSpeed:.02,maxSwingSpeed:.07,minSwingAmount:10,maxSwingAmount:20,getFontSize:()=>Math.max(12,Math.min(16,L.width/50))},Ce={speedIncreasePerScore:.1,maxSpeedMultiplier:5,spawnRateIncrease:2,minSpawnInterval:25},It={count:8,size:3,speed:3,life:30,fadeSpeed:.03},fs={chimke:{id:"chimke",nameKey:"items.chimke",descriptionKey:"items.chimkeDesc",texture:"weedLeafBrown",scoreValue:0,gameOver:!0,rarity:60,color:"#FF6B6B",particleColor:"#FF6B6B",haptic:"error"},vorinio_dumai:{id:"vorinio_dumai",nameKey:"items.vorinioDumai",descriptionKey:"items.vorinioDumaiDesc",texture:"weedLeaf",scoreValue:3,gameOver:!1,rarity:30,color:"#00FF00",particleColor:"#4CAF50",haptic:"light"},vorinio_sniegas:{id:"vorinio_sniegas",nameKey:"items.vorinioSniegas",descriptionKey:"items.vorinioSniegasDesc",texture:"snow",scoreValue:5,gameOver:!1,rarity:10,color:"#00FFFF",particleColor:"#87CEEB",haptic:"medium"}},Ie={bucket:{id:"bucket",nameKey:"powerups.bucket",descriptionKey:"powerups.bucketDescription",texture:"bucket",icon:"",rarity:5,spawnChance:.05,color:"#FFD700",particleColor:"#FFD700",haptic:"success",duration:5e3,effectType:"speed_multiplier",effectValue:.5}};function wa(){return Object.values(fs).reduce((i,t)=>i+t.rarity,0)}function va(){const i=wa();let t=Math.random()*i;for(const e of Object.values(fs))if(t-=e.rarity,t<=0)return e;return Object.values(fs)[0]}function Sa(){const i=Object.values(Ie);for(const t of i)if(Math.random()<t.spawnChance)return t;return null}Ie.bucket.spawnChance,Ie.bucket.duration,Ie.bucket.effectValue;const Td=Object.freeze(Object.defineProperty({__proto__:null,DIFFICULTY_CONFIG:Ce,GAME_CONFIG:L,ITEMS_CONFIG:fs,ITEM_CONFIG:Z,PARTICLE_CONFIG:It,PLAYER_CONFIG:Ae,POWERUPS_CONFIG:Ie,WS_CONFIG:_a,getRandomItem:va,getRandomPowerUp:Sa,getTotalItemRarity:wa,updateGameDimensions:ba},Symbol.toStringTag,{value:"Module"}));class Md{constructor(){this.textures={}}async loadAll(){try{return console.log("Loading assets..."),this.textures.basket=await At.load("/basket.svg"),console.log(" Basket loaded"),this.textures.weedLeaf=await At.load("/weed-leaf.svg"),console.log(" Weed leaf loaded"),this.textures.weedLeafBrown=await At.load("/weed-leaf-brown.svg"),console.log(" Brown leaf loaded"),this.textures.snow=await At.load("/assets/snow.svg"),console.log(" Snow loaded"),this.textures.bucket=await At.load("/assets/bucket.svg"),console.log(" Bucket loaded"),console.log("All assets loaded successfully!"),this.textures}catch(t){throw console.error("Error loading assets:",t),t}}getTexture(t){return this.textures[t]}}class Pd{constructor(t){this.sprite=new jt(t),this.sprite.anchor.set(.5,.5);const e=Math.min(Ae.scale,L.width/1e3);this.sprite.scale.set(e),this.updateBounds()}updateBounds(){this.sprite.x=L.width/2,this.sprite.y=L.height-Ae.yOffset}setupControls(t){t.addEventListener("mousemove",e=>this.handleMove(e,t)),t.addEventListener("touchstart",e=>this.handleTouch(e,t),{passive:!1}),t.addEventListener("touchmove",e=>this.handleTouch(e,t),{passive:!1}),t.addEventListener("touchend",e=>e.preventDefault(),{passive:!1})}handleMove(t,e){const s=e.getBoundingClientRect(),r=e.width/s.width,n=(t.clientX-s.left)*r;this.updatePosition(n)}handleTouch(t,e){if(t.preventDefault(),t.touches.length>0){const s=e.getBoundingClientRect(),r=e.width/s.width,n=(t.touches[0].clientX-s.left)*r;this.updatePosition(n)}}updatePosition(t){const e=Ae.minX,s=L.width-Ae.maxXOffset;this.sprite.x=Math.max(e,Math.min(s,t))}getBounds(){return this.sprite.getBounds()}addToStage(t){t.addChild(this.sprite)}}class kd{constructor(){this.translations=null,this.currentLocale="lt"}async load(t="lt"){try{const e=await fetch(`/locales/${t}.json`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return this.translations=await e.json(),this.currentLocale=t,this.translations}catch(e){throw console.error(`Failed to load locale ${t}:`,e),e}}t(t){if(!this.translations)return console.warn("Translations not loaded"),t;const e=t.split(".");let s=this.translations;for(const r of e)if(s&&typeof s=="object"&&r in s)s=s[r];else return console.warn(`Translation key not found: ${t}`),t;return s}}const J=new kd;class Ed{constructor(t,e,s=1){this.itemConfig=e,this.type=e.id,this.container=new xt,this.speedMultiplier=s,this.sprite=new jt(t),this.sprite.anchor.set(.5,.5);const r=Math.random()*(Z.maxScale-Z.minScale)+Z.minScale;this.sprite.scale.set(r);const n=J.t(e.nameKey),a=e.color;this.text=new ft({text:n.toUpperCase(),style:{fontFamily:"Arial",fontSize:Z.getFontSize(),fill:a,fontWeight:"bold",stroke:"#000000",strokeThickness:5,align:"center",dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:6,dropShadowDistance:2,dropShadowAngle:Math.PI/4}}),this.text.anchor.set(.5,.5),this.text.y=40,this.container.addChild(this.sprite),this.container.addChild(this.text),this.container.x=Math.random()*(L.width-80)+40,this.container.y=-50;const o=Math.random()*(Z.baseMaxSpeed-Z.baseMinSpeed)+Z.baseMinSpeed;this.speed=o*this.speedMultiplier,this.sprite.rotation=Math.random()*Math.PI*2,this.rotationSpeed=Math.random()*(Z.maxRotationSpeed-Z.minRotationSpeed)+Z.minRotationSpeed,this.swingOffset=Math.random()*Math.PI*2,this.swingSpeed=Math.random()*(Z.maxSwingSpeed-Z.minSwingSpeed)+Z.minSwingSpeed,this.swingAmount=Math.random()*(Z.maxSwingAmount-Z.minSwingAmount)+Z.minSwingAmount}update(t){this.container.y+=this.speed*t,this.sprite.rotation+=this.rotationSpeed*t,this.swingOffset+=this.swingSpeed*t,this.container.x+=Math.sin(this.swingOffset)*.5}isOffScreen(){return this.container.y>L.height+50}getBounds(){return this.container.getBounds()}addToStage(t){t.addChild(this.container)}removeFromStage(t){t.removeChild(this.container)}getPosition(){return{x:this.container.x,y:this.container.y}}isScoreable(){return this.itemConfig.scoreValue>0}getScoreValue(){return this.itemConfig.scoreValue||0}isGameOver(){return this.itemConfig.gameOver||!1}getConfig(){return this.itemConfig}updateSpeed(t){const e=this.speed/this.speedMultiplier;this.speedMultiplier=t,this.speed=e*this.speedMultiplier}}class Id{checkCollision(t,e){const s=t.getBounds(),r=e.getBounds();return s.x<r.x+r.width&&s.x+s.width>r.x&&s.y<r.y+r.height&&s.y+s.height>r.y}}class Bd{constructor(t){this.app=t}createCatchEffect(t,e,s="#4CAF50"){for(let r=0;r<It.count;r++){const n=new lt;n.circle(0,0,It.size),n.fill(s),n.x=t,n.y=e;const a=Math.PI*2*r/It.count;n.vx=Math.cos(a)*It.speed,n.vy=Math.sin(a)*It.speed,n.life=It.life,this.app.stage.addChild(n);const o=()=>{n.x+=n.vx,n.y+=n.vy,n.alpha-=It.fadeSpeed,n.life--,n.life<=0&&(this.app.stage.removeChild(n),this.app.ticker.remove(o))};this.app.ticker.add(o)}}}class Hr{constructor(){this.score=0,this.text=new ft({text:`${J.t("game.score")}: 0`,style:{fontFamily:"Arial",fontSize:36,fill:"#4CAF50",fontWeight:"bold",stroke:"#1B5E20",strokeThickness:4,dropShadow:!0,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:3}}),this.text.x=20,this.text.y=20}increment(){this.score++,this.updateDisplay()}add(t){this.score+=t,this.updateDisplay()}updateDisplay(){this.text.text=`${J.t("game.score")}: ${this.score}`}reset(){this.score=0,this.updateDisplay()}addToStage(t){t.addChild(this.text)}}class Rd{constructor(){this.container=new xt,this.speedMultiplier=1,this.background=new lt,this.container.addChild(this.background),this.iconText=new ft({text:"",style:{fontSize:28,fill:"#FFD700"}}),this.container.addChild(this.iconText),this.labelText=new ft({text:J.t("game.speed"),style:{fontFamily:"Arial",fontSize:16,fill:"#FFFFFF",fontWeight:"normal"}}),this.container.addChild(this.labelText),this.valueText=new ft({text:"1.0x",style:{fontFamily:"Arial",fontSize:24,fill:"#4CAF50",fontWeight:"bold",stroke:{color:"#1B5E20",width:3}}}),this.container.addChild(this.valueText),this.speedBars=[];for(let t=0;t<5;t++){const e=new lt;this.speedBars.push(e),this.container.addChild(e)}this.pulseScale=1,this.pulseDirection=1,this.glowAlpha=.5,this.updateDisplay(),this.updateLayout()}setSpeed(t){this.speedMultiplier=t,this.updateDisplay()}updateDisplay(){this.valueText.text=`${this.speedMultiplier.toFixed(1)}x`;const t=this.getSpeedColor(this.speedMultiplier);this.valueText.style.fill=t,this.iconText.text=this.getSpeedIcon(this.speedMultiplier),this.updateSpeedBars(),this.drawBackground()}getSpeedColor(t){return t>=2?"#FF6B6B":t>=1.5?"#FFA500":t>=1.2?"#FFD700":"#4CAF50"}getSpeedIcon(t){return t>=2?"":t>=1.5?"":t>=1.2?"":""}updateSpeedBars(){const e=Math.ceil(this.speedMultiplier/2.5*5);for(let s=0;s<5;s++){const r=this.speedBars[s];r.clear();const n=8,a=15-s*2,o=95+s*12,h=52;if(s<e){const l=this.getSpeedColor(this.speedMultiplier);r.roundRect(o,h-a,n,a,2),r.fill({color:parseInt(l.replace("#","0x")),alpha:.8})}else r.roundRect(o,h-a,n,a,2),r.fill({color:3355443,alpha:.3})}}drawBackground(){this.background.clear();const t=180,e=70,s=0,r=0,n=this.getSpeedColor(this.speedMultiplier),a=parseInt(n.replace("#","0x"));this.background.roundRect(s-2,r-2,t+4,e+4,12),this.background.fill({color:a,alpha:.2}),this.background.roundRect(s,r,t,e,10),this.background.fill({color:0,alpha:.7}),this.background.roundRect(s,r,t,e,10),this.background.stroke({color:a,width:2,alpha:.8})}updateLayout(){const t=L.width;this.container.x=t-200,this.container.y=20,this.iconText.x=10,this.iconText.y=8,this.labelText.x=45,this.labelText.y=12,this.valueText.x=45,this.valueText.y=32}animate(t=1){this.speedMultiplier>1.5?(this.pulseScale+=.02*this.pulseDirection*t,this.pulseScale>1.1?(this.pulseScale=1.1,this.pulseDirection=-1):this.pulseScale<1&&(this.pulseScale=1,this.pulseDirection=1),this.valueText.scale.set(this.pulseScale),this.iconText.scale.set(this.pulseScale)):(this.valueText.scale.set(1),this.iconText.scale.set(1)),this.glowAlpha+=.02*t,this.glowAlpha>1&&(this.glowAlpha=.5)}addToStage(t){t.addChild(this.container)}removeFromStage(t){t.removeChild(this.container)}updatePosition(){this.updateLayout()}destroy(){this.speedBars.forEach(t=>t.destroy()),this.speedBars=[],this.iconText.destroy(),this.labelText.destroy(),this.valueText.destroy(),this.background.destroy(),this.container.destroy({children:!0})}}class Fd{constructor(){this.container=new xt,this.active=!1,this.duration=0,this.elapsed=0,this.powerUpType="",this.background=new lt,this.container.addChild(this.background),this.iconText=new ft({text:"",style:{fontSize:32,fill:"#FFD700"}}),this.container.addChild(this.iconText),this.labelText=new ft({text:"",style:{fontFamily:"Arial",fontSize:16,fill:"#FFFFFF",fontWeight:"bold"}}),this.container.addChild(this.labelText),this.descriptionText=new ft({text:"",style:{fontFamily:"Arial",fontSize:12,fill:"#FFD700",fontWeight:"normal"}}),this.container.addChild(this.descriptionText),this.timerText=new ft({text:"5.0",style:{fontFamily:"Arial",fontSize:28,fill:"#4CAF50",fontWeight:"bold",stroke:{color:"#1B5E20",width:3}}}),this.container.addChild(this.timerText),this.progressBarBg=new lt,this.container.addChild(this.progressBarBg),this.progressBarFill=new lt,this.container.addChild(this.progressBarFill),this.pulseScale=1,this.pulseDirection=1,this.container.visible=!1,this.updateLayout()}start(t,e){Be(async()=>{const{POWERUPS_CONFIG:s}=await Promise.resolve().then(()=>Td);return{POWERUPS_CONFIG:s}},void 0).then(({POWERUPS_CONFIG:s})=>{const r=s[t];if(!r){console.error(`Power-up config not found: ${t}`);return}this.active=!0,this.powerUpType=t,this.duration=e,this.elapsed=0,this.container.visible=!0,this.iconText.text=r.icon||"",this.labelText.text=J.t(r.nameKey),this.descriptionText.text=J.t(r.descriptionKey),this.updateDisplay()})}stop(){this.active=!1,this.container.visible=!1}update(t){if(this.active)return this.elapsed+=t,this.elapsed>=this.duration?(this.stop(),!1):(this.updateDisplay(),this.animate(t/1e3),!0)}updateDisplay(){const t=Math.max(0,this.duration-this.elapsed),e=(t/1e3).toFixed(1);this.timerText.text=e+"s";const s=t/this.duration;s<.3?this.timerText.style.fill="#FF6B6B":s<.6?this.timerText.style.fill="#FFA500":this.timerText.style.fill="#4CAF50",this.drawProgressBar(),this.drawBackground()}drawBackground(){this.background.clear();const t=200,e=110,s=0,r=0;this.background.roundRect(s-2,r-2,t+4,e+4,12),this.background.fill({color:16766720,alpha:.3}),this.background.roundRect(s,r,t,e,10),this.background.fill({color:0,alpha:.8}),this.background.roundRect(s,r,t,e,10),this.background.stroke({color:16766720,width:2,alpha:.9})}drawProgressBar(){const n=1-this.elapsed/this.duration;this.progressBarBg.clear(),this.progressBarBg.roundRect(15,90,170,8,4),this.progressBarBg.fill({color:3355443,alpha:.5}),this.progressBarFill.clear();const a=170*n;if(a>0){this.progressBarFill.roundRect(15,90,a,8,4);let o=5025616;n<.3?o=16739179:n<.6&&(o=16753920),this.progressBarFill.fill({color:o,alpha:.9})}}animate(t){const e=t/16.67;this.pulseScale+=.02*this.pulseDirection*e,this.pulseScale>1.1?(this.pulseScale=1.1,this.pulseDirection=-1):this.pulseScale<1&&(this.pulseScale=1,this.pulseDirection=1),this.iconText.scale.set(this.pulseScale)}updateLayout(){const t=L.width;this.container.x=t/2-100,this.container.y=20,this.iconText.x=15,this.iconText.y=8,this.labelText.x=55,this.labelText.y=12,this.descriptionText.x=55,this.descriptionText.y=32,this.timerText.x=55,this.timerText.y=52}updatePosition(){this.updateLayout()}isActive(){return this.active}getRemainingTime(){return Math.max(0,this.duration-this.elapsed)}addToStage(t){t.addChild(this.container)}removeFromStage(t){t.removeChild(this.container)}destroy(){this.iconText.destroy(),this.labelText.destroy(),this.descriptionText.destroy(),this.timerText.destroy(),this.progressBarBg.destroy(),this.progressBarFill.destroy(),this.background.destroy(),this.container.destroy({children:!0})}}class Ld{constructor(t,e,s,r="#4CAF50",n=""){this.container=new xt,this.container.x=t,this.container.y=e,this.lifetime=0,this.maxLifetime=120,this.active=!0,this.velocityY=-2;const a=`+${s}`;this.scoreText=new ft({text:a,style:{fontFamily:"Arial",fontSize:48,fill:r,fontWeight:"bold",stroke:{color:"#000000",width:6},dropShadow:{color:"#000000",blur:8,angle:Math.PI/4,distance:4},align:"center"}}),this.scoreText.anchor.set(.5,.5),this.glowCircle=new lt,this.updateGlow(r),this.container.addChild(this.glowCircle),this.container.addChild(this.scoreText),n&&(this.itemText=new ft({text:n.toUpperCase(),style:{fontFamily:"Arial",fontSize:16,fill:"#FFFFFF",fontWeight:"bold",stroke:{color:"#000000",width:3},align:"center"}}),this.itemText.anchor.set(.5,.5),this.itemText.y=35,this.container.addChild(this.itemText)),this.container.scale.set(.5),this.scalePhase=0}updateGlow(t){this.glowCircle.clear();const e=parseInt(t.replace("#",""),16);this.glowCircle.circle(0,0,40),this.glowCircle.fill({color:e,alpha:.3}),this.glowCircle.circle(0,0,25),this.glowCircle.fill({color:e,alpha:.2}),this.glowCircle.circle(0,0,15),this.glowCircle.fill({color:e,alpha:.1})}update(t=1){if(!this.active)return!1;if(this.lifetime+=t,this.scalePhase<10){this.scalePhase+=t;const r=this.easeOutBack(Math.min(this.scalePhase/10,1));this.container.scale.set(r)}this.container.y+=this.velocityY*t,this.velocityY*=.98;const e=this.maxLifetime-30;if(this.lifetime>e){const r=(this.lifetime-e)/30;this.container.alpha=1-r}const s=1+Math.sin(this.lifetime*.2)*.15;return this.glowCircle.scale.set(s),this.lifetime>=this.maxLifetime?(this.active=!1,!1):!0}easeOutBack(t){return 1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2)}isActive(){return this.active}addToStage(t){t.addChild(this.container)}removeFromStage(t){this.container.parent===t&&t.removeChild(this.container)}destroy(){this.scoreText&&this.scoreText.destroy(),this.itemText&&this.itemText.destroy(),this.glowCircle&&this.glowCircle.destroy(),this.container&&this.container.destroy({children:!0})}}const Rt={LOADING:"loading",START_SCREEN:"start_screen",PLAYING:"playing",PAUSED:"paused",GAME_OVER:"game_over"};class Dd{constructor(){this.currentState=Rt.LOADING,this.previousState=null,this.listeners=new Map}setState(t){if(!Object.values(Rt).includes(t)){console.error(`Invalid game state: ${t}`);return}this.currentState!==t&&(this.previousState=this.currentState,this.currentState=t,console.log(`Game state changed: ${this.previousState} -> ${this.currentState}`),this.notifyListeners(t,this.previousState))}getState(){return this.currentState}isState(t){return this.currentState===t}isPlaying(){return this.currentState===Rt.PLAYING}addListener(t,e){this.listeners.set(t,e)}removeListener(t){this.listeners.delete(t)}notifyListeners(t,e){this.listeners.forEach(s=>{try{s(t,e)}catch(r){console.error("Error in state change listener:",r)}})}reset(){this.setState(Rt.START_SCREEN)}destroy(){this.listeners.clear()}}class Od{constructor(){this.ws=null,this.url=_a.url,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=3e3,this.messageHandlers=new Map,this.connected=!1}connect(){return new Promise((t,e)=>{try{console.log(`Connecting to WebSocket server: ${this.url}`),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{console.log(" WebSocket connected"),this.connected=!0,this.reconnectAttempts=0,t()},this.ws.onmessage=s=>{this.handleMessage(s.data)},this.ws.onclose=()=>{console.log(" WebSocket disconnected"),this.connected=!1,this.attemptReconnect()},this.ws.onerror=s=>{console.error("WebSocket error:",s),e(s)}}catch(s){console.error("Failed to create WebSocket:",s),e(s)}})}attemptReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`Reconnecting... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect().catch(t=>{console.error("Reconnection failed:",t)})},this.reconnectDelay)):console.error("Max reconnection attempts reached")}handleMessage(t){try{const e=JSON.parse(t),s=this.messageHandlers.get(e.type);s&&s.forEach(r=>r(e.payload)),!s&&e.type!=="HEARTBEAT"&&console.log("Received message:",e)}catch(e){console.error("Error handling message:",e)}}on(t,e){this.messageHandlers.has(t)||this.messageHandlers.set(t,[]),this.messageHandlers.get(t).push(e)}off(t,e){const s=this.messageHandlers.get(t);if(s){const r=s.indexOf(e);r>-1&&s.splice(r,1)}}send(t,e={}){if(!this.connected||!this.ws||this.ws.readyState!==WebSocket.OPEN)return console.warn("WebSocket not connected, cannot send message"),!1;try{return this.ws.send(JSON.stringify({type:t,payload:e})),!0}catch(s){return console.error("Error sending message:",s),!1}}submitScore(t,e,s={}){return new Promise((r,n)=>{if(!this.connected){n(new Error("Not connected to server"));return}const a=h=>{this.off("SCORE_SUBMITTED",a),this.off("ERROR",o),r(h)},o=h=>{this.off("SCORE_SUBMITTED",a),this.off("ERROR",o),n(new Error(h.message))};this.on("SCORE_SUBMITTED",a),this.on("ERROR",o),this.send("SUBMIT_SCORE",{username:t,score:e,telegramUserId:s.userId,telegramUsername:s.username}),setTimeout(()=>{this.off("SCORE_SUBMITTED",a),this.off("ERROR",o),n(new Error("Request timeout"))},1e4)})}getLeaderboard(t=100){return new Promise((e,s)=>{if(!this.connected){s(new Error("Not connected to server"));return}const r=a=>{this.off("LEADERBOARD",r),this.off("ERROR",n),e(a)},n=a=>{this.off("LEADERBOARD",r),this.off("ERROR",n),s(new Error(a.message))};this.on("LEADERBOARD",r),this.on("ERROR",n),this.send("GET_LEADERBOARD",{limit:t}),setTimeout(()=>{this.off("LEADERBOARD",r),this.off("ERROR",n),s(new Error("Request timeout"))},1e4)})}getPlayerStats(t){return new Promise((e,s)=>{if(!this.connected){s(new Error("Not connected to server"));return}const r=a=>{this.off("PLAYER_STATS",r),this.off("ERROR",n),e(a)},n=a=>{this.off("PLAYER_STATS",r),this.off("ERROR",n),s(new Error(a.message))};this.on("PLAYER_STATS",r),this.on("ERROR",n),this.send("GET_PLAYER_STATS",{username:t}),setTimeout(()=>{this.off("PLAYER_STATS",r),this.off("ERROR",n),s(new Error("Request timeout"))},1e4)})}isConnected(){return this.connected}disconnect(){this.ws&&(this.ws.close(),this.ws=null,this.connected=!1)}}const dt=new Od;class Gd{constructor(){this.storageKey="weedCatcherLeaderboard",this.maxLeaderboardSize=100,this.useWS=!0}async saveScore(t,e,s={}){if(console.log("Saving score:",{username:t,score:e}),this.useWS&&dt.isConnected())try{const r=await dt.submitScore(t,e,s);return console.log("Score saved via WebSocket:",r),{username:r.username,score:r.score,rank:r.rank,timestamp:r.created_at,playerStats:r.playerStats}}catch(r){console.warn("WebSocket unavailable, falling back to localStorage:",r),this.useWS=!1}return this.saveScoreLocal(t,e)}saveScoreLocal(t,e){const s={username:t,score:e,timestamp:new Date().toISOString(),id:this.generateScoreId()};try{const r=this.getLeaderboardLocal();r.push(s),r.sort((o,h)=>h.score-o.score);const n=r.slice(0,this.maxLeaderboardSize);localStorage.setItem(this.storageKey,JSON.stringify(n));const a=n.findIndex(o=>o.id===s.id)+1;return{...s,rank:a,totalPlayers:n.length}}catch(r){return console.error("Error saving score to localStorage:",r),{...s,rank:0,totalPlayers:0}}}async getLeaderboard(t=100){if(this.useWS&&dt.isConnected())try{return(await dt.getLeaderboard(t)).map(s=>({username:s.username,score:s.score||s.best_score,gamesPlayed:s.games_played,timestamp:s.last_played}))}catch(e){console.warn("WebSocket unavailable, using localStorage:",e),this.useWS=!1}return this.getLeaderboardLocal().slice(0,t)}getLeaderboardLocal(){try{const t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):[]}catch(t){return console.error("Error reading leaderboard from localStorage:",t),[]}}async getTopScores(t=10){return(await this.getLeaderboard(t)).slice(0,t)}async getPlayerBestScore(t){if(this.useWS&&dt.isConnected())try{return await dt.getPlayerStats(t)}catch(r){console.warn("WebSocket unavailable:",r),this.useWS=!1}const s=this.getLeaderboardLocal().filter(r=>r.username===t);return s.length===0?null:s.reduce((r,n)=>n.score>r.score?n:r)}async getStats(){if(this.useWS&&dt.isConnected())try{this.useWS=!1}catch(e){console.warn("WebSocket unavailable:",e),this.useWS=!1}const t=this.getLeaderboardLocal();return{totalGames:t.length,totalPlayers:new Set(t.map(e=>e.username)).size,highestScore:t.length>0?t[0].score:0,averageScore:t.length>0?Math.round(t.reduce((e,s)=>e+s.score,0)/t.length):0}}async isTopScore(t,e=10){const s=await this.getTopScores(e);return s.length<e||t>s[s.length-1].score}generateScoreId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}clearAllScores(){localStorage.removeItem(this.storageKey),console.log("All scores cleared")}}class zd{constructor(){this.currentScreen=null,this.stage=null,this.scoreService=null}setScoreService(t){this.scoreService=t}setStage(t){this.stage=t}hideCurrentScreen(){this.currentScreen&&this.stage&&(this.currentScreen.removeFromStage(this.stage),typeof this.currentScreen.destroy=="function"&&this.currentScreen.destroy(),this.currentScreen=null)}showStartScreen(){this.hideCurrentScreen();const t=document.getElementById("startScreen");t&&t.classList.remove("hidden")}hideStartScreen(){const t=document.getElementById("startScreen");t&&t.classList.add("hidden")}destroy(){this.hideCurrentScreen(),this.stage=null,this.scoreService=null}}class Wd{constructor(){this.modalElement=null,this.isOpen=!1}show({title:t,content:e,onClose:s}){this.close(),this.modalElement=document.createElement("div"),this.modalElement.className="fixed inset-0 z-50 flex items-center justify-center p-4 animate-slide-up";const r=document.createElement("div");r.className="absolute inset-0 glass-strong",r.onclick=()=>{this.close(),s&&s()},this.modalElement.appendChild(r);const n=document.createElement("div");n.className="relative z-10 w-full max-w-md mx-auto";const a=document.createElement("div");a.className=`
            bg-gradient-to-br from-emerald-950/95 to-emerald-900/90
            border-2 border-emerald-500/30
            rounded-2xl
            shadow-2xl shadow-black/50
            backdrop-blur-xl
            overflow-hidden
        `;const o=document.createElement("div");o.className="relative px-6 py-4 border-b border-emerald-500/20";const h=document.createElement("h2");h.className="text-2xl font-bold text-emerald-400 text-center",h.textContent=t,o.appendChild(h);const l=document.createElement("button");l.className=`
            absolute top-4 right-4
            w-8 h-8
            flex items-center justify-center
            text-gray-400 hover:text-white
            bg-emerald-950/50 hover:bg-emerald-900/70
            border border-emerald-500/20 hover:border-emerald-500/40
            rounded-lg
            transition-all duration-200
            text-xl
        `,l.innerHTML="",l.onclick=()=>{this.close(),s&&s()},o.appendChild(l),a.appendChild(o);const c=document.createElement("div");c.className="px-6 py-6 max-h-[60vh] overflow-y-auto",c.innerHTML=e,a.appendChild(c),n.appendChild(a),this.modalElement.appendChild(n),document.body.appendChild(this.modalElement),this.isOpen=!0,document.body.style.overflow="hidden"}close(){this.modalElement&&(this.modalElement.remove(),this.modalElement=null,this.isOpen=!1,document.body.style.overflow="")}isModalOpen(){return this.isOpen}}class Ud{constructor(){this.currentModal=null}show(t){return this.currentModal&&this.currentModal.close(),this.currentModal=new Wd,this.currentModal.show(t),this.currentModal}close(){this.currentModal&&(this.currentModal.close(),this.currentModal=null)}isOpen(){return this.currentModal&&this.currentModal.isModalOpen()}}const Mt=new Ud;class $d{constructor(){this.settings=this.loadSettings()}loadSettings(){try{const t=localStorage.getItem("game_settings");if(t)return JSON.parse(t)}catch(t){console.error("Failed to load settings:",t)}return{soundEnabled:!0,musicEnabled:!0}}saveSettings(){try{localStorage.setItem("game_settings",JSON.stringify(this.settings))}catch(t){console.error("Failed to save settings:",t)}}show(t){const e=this.createContent();Mt.show({title:" "+J.t("menu.options"),content:e,onClose:t}),setTimeout(()=>this.setupEventListeners(),0)}createContent(){return`
            <div class="space-y-4">
                <!-- Sound Setting -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-4 
                            backdrop-blur-sm shadow-lg shadow-black/50
                            hover:from-emerald-900/50 hover:to-emerald-800/30
                            hover:border-emerald-700/60
                            transition-all duration-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl"></span>
                            <div>
                                <div class="text-white font-bold text-lg">${J.t("options.sound")}</div>
                                <div class="text-gray-400 text-sm">Garso efektai aidime</div>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="soundToggle" class="sr-only peer" ${this.settings.soundEnabled?"checked":""}>
                            <div class="w-14 h-8 bg-gray-700 peer-focus:outline-none rounded-full peer 
                                        peer-checked:after:translate-x-full peer-checked:after:border-white 
                                        after:content-[''] after:absolute after:top-[4px] after:left-[4px] 
                                        after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all
                                        peer-checked:bg-emerald-600 border-2 border-gray-600 peer-checked:border-emerald-500"></div>
                        </label>
                    </div>
                </div>

                <!-- Music Setting -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-4 
                            backdrop-blur-sm shadow-lg shadow-black/50
                            hover:from-emerald-900/50 hover:to-emerald-800/30
                            hover:border-emerald-700/60
                            transition-all duration-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl"></span>
                            <div>
                                <div class="text-white font-bold text-lg">${J.t("options.music")}</div>
                                <div class="text-gray-400 text-sm">Fono muzika</div>
                            </div>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="musicToggle" class="sr-only peer" ${this.settings.musicEnabled?"checked":""}>
                            <div class="w-14 h-8 bg-gray-700 peer-focus:outline-none rounded-full peer 
                                        peer-checked:after:translate-x-full peer-checked:after:border-white 
                                        after:content-[''] after:absolute after:top-[4px] after:left-[4px] 
                                        after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all
                                        peer-checked:bg-emerald-600 border-2 border-gray-600 peer-checked:border-emerald-500"></div>
                        </label>
                    </div>
                </div>

                <!-- Coming Soon -->
                <div class="bg-black/40 border border-emerald-500/20 rounded-xl p-6 text-center">
                    <div class="text-4xl mb-2"></div>
                    <div class="text-gray-400 text-sm italic">${J.t("options.comingSoon")}</div>
                </div>

                <!-- Back Button -->
                <button id="optionsBackBtn" 
                        class="w-full px-6 py-3 rounded-xl font-bold text-base
                               bg-gradient-to-br from-emerald-950/40 to-emerald-900/20
                               border-2 border-emerald-800/40
                               text-gray-300 uppercase tracking-wide
                               hover:from-emerald-900/50 hover:to-emerald-800/30
                               hover:border-emerald-700/60
                               hover:text-white
                               hover:shadow-lg hover:shadow-emerald-500/20
                               active:scale-[0.97]
                               transition-all duration-200
                               flex items-center justify-center gap-2
                               shadow-lg shadow-black/50 backdrop-blur-sm">
                    <span></span>
                    <span>${J.t("menu.back")}</span>
                </button>
            </div>
        `}setupEventListeners(){const t=document.getElementById("soundToggle");t&&t.addEventListener("change",r=>{this.settings.soundEnabled=r.target.checked,this.saveSettings()});const e=document.getElementById("musicToggle");e&&e.addEventListener("change",r=>{this.settings.musicEnabled=r.target.checked,this.saveSettings()});const s=document.getElementById("optionsBackBtn");s&&s.addEventListener("click",()=>{Mt.close()})}getSettings(){return this.settings}}class Hd{show(t){const e=this.createContent();Mt.show({title:" Konkurso Informacija",content:e,onClose:t}),setTimeout(()=>this.setupEventListeners(),0)}createContent(){return`
            <div class="space-y-4">
                <!-- Contest Description -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-5 
                            backdrop-blur-sm shadow-lg shadow-black/50">
                    <h3 class="text-emerald-400 font-bold text-lg mb-3 flex items-center gap-2">
                        <span></span>
                        <span>Apie Konkurs</span>
                    </h3>
                    <p class="text-gray-300 text-sm leading-relaxed mb-3">
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor 
                        incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud 
                        exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
                    </p>
                    <p class="text-gray-300 text-sm leading-relaxed">
                        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu 
                        fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in 
                        culpa qui officia deserunt mollit anim id est laborum.
                    </p>
                </div>

                <!-- Prizes Section -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-5 
                            backdrop-blur-sm shadow-lg shadow-black/50">
                    <h3 class="text-emerald-400 font-bold text-lg mb-3 flex items-center gap-2">
                        <span></span>
                        <span>Prizai</span>
                    </h3>
                    <ul class="space-y-2 text-gray-300 text-sm">
                        <li class="flex items-start gap-2">
                            <span class="text-yellow-400 font-bold"></span>
                            <span>1 vieta - Lorem ipsum dolor sit amet</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-gray-400 font-bold"></span>
                            <span>2 vieta - Consectetur adipiscing elit</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-orange-400 font-bold"></span>
                            <span>3 vieta - Sed do eiusmod tempor</span>
                        </li>
                    </ul>
                </div>

                <!-- Rules Section -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-5 
                            backdrop-blur-sm shadow-lg shadow-black/50">
                    <h3 class="text-emerald-400 font-bold text-lg mb-3 flex items-center gap-2">
                        <span></span>
                        <span>Taisykls</span>
                    </h3>
                    <ul class="space-y-2 text-gray-300 text-sm list-disc list-inside">
                        <li>Lorem ipsum dolor sit amet consectetur</li>
                        <li>Adipiscing elit sed do eiusmod tempor</li>
                        <li>Incididunt ut labore et dolore magna</li>
                        <li>Aliqua ut enim ad minim veniam</li>
                    </ul>
                </div>

                <!-- Dates Section -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-5 
                            backdrop-blur-sm shadow-lg shadow-black/50">
                    <h3 class="text-emerald-400 font-bold text-lg mb-3 flex items-center gap-2">
                        <span></span>
                        <span>Datos</span>
                    </h3>
                    <div class="space-y-2 text-gray-300 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Pradia:</span>
                            <span class="font-bold">2024-01-01</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Pabaiga:</span>
                            <span class="font-bold">2024-12-31</span>
                        </div>
                    </div>
                </div>

                <!-- Close Button -->
                <button id="contestInfoBackBtn" 
                        class="w-full px-6 py-3 rounded-xl font-bold text-base
                               bg-gradient-to-br from-emerald-950/40 to-emerald-900/20
                               border-2 border-emerald-800/40
                               text-gray-300 uppercase tracking-wide
                               hover:from-emerald-900/50 hover:to-emerald-800/30
                               hover:border-emerald-700/60
                               hover:text-white
                               hover:shadow-lg hover:shadow-emerald-500/20
                               active:scale-[0.97]
                               transition-all duration-200
                               flex items-center justify-center gap-2
                               shadow-lg shadow-black/50 backdrop-blur-sm">
                    <span></span>
                    <span>Udaryti</span>
                </button>
            </div>
        `}setupEventListeners(){const t=document.getElementById("contestInfoBackBtn");t&&t.addEventListener("click",()=>{Mt.close()})}}class Nd{constructor(){this.leaderboard=[],this.loading=!0}async show(t){await this.fetchLeaderboard();const e=this.createContent();Mt.show({title:" Lyderi Lentel",content:e,onClose:t}),setTimeout(()=>this.setupEventListeners(),0),this.setupRealtimeUpdates()}async fetchLeaderboard(){try{this.loading=!0,this.leaderboard=await dt.getLeaderboard(50),this.loading=!1}catch(t){console.error("Failed to fetch leaderboard:",t),this.leaderboard=[],this.loading=!1}}createContent(){return this.loading?this.createLoadingState():this.leaderboard.length===0?this.createEmptyState():this.createLeaderboardContent()}createLoadingState(){return`
            <div class="flex flex-col items-center justify-center py-12">
                <div class="animate-spin rounded-full h-16 w-16 border-4 border-emerald-500 border-t-transparent"></div>
                <p class="text-gray-400 mt-4">Kraunama...</p>
            </div>
        `}createEmptyState(){return`
            <div class="flex flex-col items-center justify-center py-12">
                <div class="text-6xl mb-4"></div>
                <p class="text-gray-400 text-lg">Dar nra rezultat</p>
                <p class="text-gray-500 text-sm mt-2">Bk pirmas!</p>
            </div>
        `}createLeaderboardContent(){var s;const t=this.leaderboard.slice(0,3),e=this.leaderboard.slice(3);return`
            <div class="space-y-4">
                <!-- Top 3 Podium -->
                ${t.length>0?this.createPodium(t):""}

                <!-- Rest of leaderboard -->
                <div class="space-y-2 max-h-[400px] overflow-y-auto pr-2">
                    ${e.map((r,n)=>this.createLeaderboardEntry(r,n+4)).join("")}
                </div>

                <!-- Stats -->
                <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                            border-2 border-emerald-800/40 
                            rounded-xl p-4 
                            backdrop-blur-sm shadow-lg shadow-black/50">
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-emerald-400">${this.leaderboard.length}</div>
                            <div class="text-xs text-gray-400">aidjai</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-emerald-400">${((s=this.leaderboard[0])==null?void 0:s.score)||0}</div>
                            <div class="text-xs text-gray-400">Geriausias</div>
                        </div>
                    </div>
                </div>

                <!-- Close Button -->
                <button id="leaderboardBackBtn" 
                        class="w-full px-6 py-3 rounded-xl font-bold text-base
                               bg-gradient-to-br from-emerald-950/40 to-emerald-900/20
                               border-2 border-emerald-800/40
                               text-gray-300 uppercase tracking-wide
                               hover:from-emerald-900/50 hover:to-emerald-800/30
                               hover:border-emerald-700/60
                               hover:text-white
                               hover:shadow-lg hover:shadow-emerald-500/20
                               active:scale-[0.97]
                               transition-all duration-200
                               flex items-center justify-center gap-2
                               shadow-lg shadow-black/50 backdrop-blur-sm">
                    <span></span>
                    <span>Udaryti</span>
                </button>
            </div>
        `}createPodium(t){const[e,s,r]=t;return`
            <div class="grid grid-cols-3 gap-2 mb-6">
                <!-- Second Place -->
                ${s?`
                    <div class="flex flex-col items-center pt-8">
                        <div class="text-4xl mb-2"></div>
                        <div class="bg-gradient-to-br from-gray-700/80 to-gray-800/80
                                    border-2 border-gray-500/50
                                    rounded-xl p-3 w-full text-center
                                    shadow-lg shadow-gray-500/20">
                            <div class="text-sm font-bold text-white truncate">${this.escapeHtml(s.username)}</div>
                            <div class="text-xl font-bold text-gray-300 mt-1">${s.score}</div>
                            <div class="text-xs text-gray-400 mt-1">${s.games_played||1} aidimai</div>
                        </div>
                    </div>
                `:"<div></div>"}

                <!-- First Place -->
                ${e?`
                    <div class="flex flex-col items-center">
                        <div class="text-5xl mb-2 animate-bounce"></div>
                        <div class="bg-gradient-to-br from-yellow-600/80 to-yellow-700/80
                                    border-2 border-yellow-400/60
                                    rounded-xl p-4 w-full text-center
                                    shadow-lg shadow-yellow-500/30
                                    transform scale-110">
                            <div class="text-base font-bold text-white truncate">${this.escapeHtml(e.username)}</div>
                            <div class="text-2xl font-bold text-yellow-200 mt-1">${e.score}</div>
                            <div class="text-xs text-yellow-300 mt-1">${e.games_played||1} aidimai</div>
                        </div>
                    </div>
                `:"<div></div>"}

                <!-- Third Place -->
                ${r?`
                    <div class="flex flex-col items-center pt-12">
                        <div class="text-3xl mb-2"></div>
                        <div class="bg-gradient-to-br from-orange-700/80 to-orange-800/80
                                    border-2 border-orange-600/50
                                    rounded-xl p-3 w-full text-center
                                    shadow-lg shadow-orange-500/20">
                            <div class="text-sm font-bold text-white truncate">${this.escapeHtml(r.username)}</div>
                            <div class="text-xl font-bold text-orange-300 mt-1">${r.score}</div>
                            <div class="text-xs text-orange-400 mt-1">${r.games_played||1} aidimai</div>
                        </div>
                    </div>
                `:"<div></div>"}
            </div>
        `}createLeaderboardEntry(t,e){return`
            <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                        border-2 border-emerald-800/40 
                        rounded-xl p-3 
                        backdrop-blur-sm shadow-lg shadow-black/50
                        hover:from-emerald-900/50 hover:to-emerald-800/30
                        hover:border-emerald-700/60
                        transition-all duration-200
                        flex items-center justify-between">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                    <div class="text-lg font-bold text-gray-400 w-8 text-center flex-shrink-0">
                        #${e}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="text-white font-bold truncate">${this.escapeHtml(t.username)}</div>
                        <div class="text-xs text-gray-400">${t.games_played||1} aidimai</div>
                    </div>
                </div>
                <div class="flex items-center gap-2 flex-shrink-0">
                    <div class="bg-emerald-500/20 border border-emerald-500/40 rounded-lg px-3 py-1">
                        <div class="text-emerald-400 font-bold">${t.score}</div>
                    </div>
                </div>
            </div>
        `}setupEventListeners(){const t=document.getElementById("leaderboardBackBtn");t&&t.addEventListener("click",()=>{this.cleanup(),Mt.close()})}setupRealtimeUpdates(){this.updateHandler=t=>{console.log("Leaderboard updated:",t),this.leaderboard=t},dt.on("LEADERBOARD_UPDATE",this.updateHandler)}cleanup(){this.updateHandler&&dt.off("LEADERBOARD_UPDATE",this.updateHandler)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class Vd{constructor(t,e,s,r,n){this.username=t,this.score=e,this.scoreData=s,this.leaderboard=r||[],this.onRestart=n}show(){const t=this.createContent();Mt.show({title:this.getTitle(),content:t,onClose:()=>{this.onRestart&&this.onRestart()}}),setTimeout(()=>this.setupEventListeners(),0)}getTitle(){var e;const t=((e=this.scoreData)==null?void 0:e.rank)||0;return t===1?" Naujas Rekordas!":t<=3?" Puikus Rezultatas!":t<=10?" Top 10!":" aidimas Baigtas"}createContent(){var s,r;const t=((s=this.scoreData)==null?void 0:s.rank)||0,e=t>0&&t<=10;return`
            <div class="space-y-4">
                <!-- Score Card -->
                <div class="relative bg-gradient-to-br from-emerald-950/60 to-emerald-900/40 
                            border-2 border-emerald-500/40 
                            rounded-2xl p-6 
                            backdrop-blur-xl shadow-2xl shadow-emerald-500/20
                            overflow-hidden">
                    <!-- Shimmer effect -->
                    <div class="absolute inset-0 opacity-20 animate-shimmer" 
                         style="background: linear-gradient(90deg, transparent, rgba(16, 185, 129, 0.2), transparent); background-size: 200% 100%;"></div>
                    
                    <div class="relative text-center">
                        <div class="text-gray-400 text-sm uppercase tracking-wider mb-2">Tavo Rezultatas</div>
                        <div class="text-6xl font-bold text-emerald-400 mb-2 drop-shadow-lg">${this.score}</div>
                        ${t>0?`
                            <div class="inline-flex items-center gap-2 bg-emerald-500/20 border border-emerald-500/40 rounded-full px-4 py-2 mt-2">
                                <span class="text-2xl">${this.getRankEmoji(t)}</span>
                                <span class="text-emerald-300 font-bold">#${t} Vieta</span>
                            </div>
                        `:""}
                    </div>
                </div>

                <!-- Achievement Badges -->
                ${e?this.createAchievementBadges(t):""}

                <!-- Player Stats -->
                ${(r=this.scoreData)!=null&&r.playerStats?this.createPlayerStats():""}

                <!-- Mini Leaderboard -->
                ${this.leaderboard.length>0?this.createMiniLeaderboard():""}

                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-3">
                    <button id="gameOverRestartBtn" 
                            class="px-6 py-4 rounded-xl font-bold text-base
                                   bg-gradient-to-br from-emerald-600 to-emerald-700
                                   border-2 border-emerald-500/40
                                   text-white uppercase tracking-wide
                                   hover:from-emerald-500 hover:to-emerald-600
                                   hover:border-emerald-400/60
                                   hover:shadow-lg hover:shadow-emerald-500/30
                                   active:scale-[0.97]
                                   transition-all duration-200
                                   flex items-center justify-center gap-2
                                   shadow-lg shadow-black/50">
                        <span class="text-xl"></span>
                        <span>Dar Kart</span>
                    </button>
                    
                    <button id="gameOverMenuBtn" 
                            class="px-6 py-4 rounded-xl font-bold text-base
                                   bg-gradient-to-br from-emerald-950/40 to-emerald-900/20
                                   border-2 border-emerald-800/40
                                   text-gray-300 uppercase tracking-wide
                                   hover:from-emerald-900/50 hover:to-emerald-800/30
                                   hover:border-emerald-700/60
                                   hover:text-white
                                   hover:shadow-lg hover:shadow-emerald-500/20
                                   active:scale-[0.97]
                                   transition-all duration-200
                                   flex items-center justify-center gap-2
                                   shadow-lg shadow-black/50 backdrop-blur-sm">
                        <span class="text-xl"></span>
                        <span>Meniu</span>
                    </button>
                </div>
            </div>
        `}createAchievementBadges(t){const e=[];return t===1?e.push({icon:"",text:"empionas!",color:"from-yellow-600 to-yellow-700 border-yellow-400"}):t===2?e.push({icon:"",text:"Sidabras!",color:"from-gray-600 to-gray-700 border-gray-400"}):t===3?e.push({icon:"",text:"Bronza!",color:"from-orange-600 to-orange-700 border-orange-400"}):t<=10&&e.push({icon:"",text:"Top 10!",color:"from-purple-600 to-purple-700 border-purple-400"}),e.length===0?"":`
            <div class="flex flex-wrap gap-2 justify-center">
                ${e.map(s=>`
                    <div class="bg-gradient-to-br ${s.color}/80
                                border-2 ${s.color.split(" ")[2]}/60
                                rounded-xl px-4 py-2
                                shadow-lg
                                flex items-center gap-2
                                animate-slide-up">
                        <span class="text-2xl">${s.icon}</span>
                        <span class="text-white font-bold">${s.text}</span>
                    </div>
                `).join("")}
            </div>
        `}createPlayerStats(){const t=this.scoreData.playerStats;return`
            <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                        border-2 border-emerald-800/40 
                        rounded-xl p-4 
                        backdrop-blur-sm shadow-lg shadow-black/50">
                <div class="text-center text-gray-400 text-sm uppercase tracking-wider mb-3">Tavo Statistika</div>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-emerald-400">${t.best_score||t.score}</div>
                        <div class="text-xs text-gray-400 mt-1">Geriausias</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-emerald-400">${t.games_played||1}</div>
                        <div class="text-xs text-gray-400 mt-1">aidimai</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-emerald-400">#${t.rank||this.scoreData.rank}</div>
                        <div class="text-xs text-gray-400 mt-1">Vieta</div>
                    </div>
                </div>
            </div>
        `}createMiniLeaderboard(){return`
            <div class="bg-gradient-to-br from-emerald-950/40 to-emerald-900/20 
                        border-2 border-emerald-800/40 
                        rounded-xl p-4 
                        backdrop-blur-sm shadow-lg shadow-black/50">
                <div class="text-center text-gray-400 text-sm uppercase tracking-wider mb-3">Top 5 Lyderiai</div>
                <div class="space-y-2">
                    ${this.leaderboard.slice(0,5).map((e,s)=>this.createMiniLeaderboardEntry(e,s+1)).join("")}
                </div>
            </div>
        `}createMiniLeaderboardEntry(t,e){const s=t.username===this.username;return`
            <div class="flex items-center justify-between p-2 rounded-lg
                        ${s?"bg-emerald-500/20 border border-emerald-500/40":"bg-black/20"}">
                <div class="flex items-center gap-2 flex-1 min-w-0">
                    <span class="text-lg ${e<=3?"text-2xl":""}">${this.getRankEmoji(e)}</span>
                    <span class="text-white font-bold truncate ${s?"text-emerald-400":""}">${this.escapeHtml(t.username)}</span>
                </div>
                <span class="text-emerald-400 font-bold">${t.score}</span>
            </div>
        `}getRankEmoji(t){return t===1?"":t===2?"":t===3?"":`#${t}`}setupEventListeners(){const t=document.getElementById("gameOverRestartBtn");t&&t.addEventListener("click",()=>{Mt.close(),this.onRestart&&this.onRestart()});const e=document.getElementById("gameOverMenuBtn");e&&e.addEventListener("click",()=>{Mt.close(),window.location.reload()})}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class Yd{constructor(){this.app=null,this.assetLoader=new Md,this.collisionSystem=new Id,this.particleSystem=null,this.stateManager=new Dd,this.scoreService=new Gd,this.uiManager=new zd,this.telegramService=null,this.player=null,this.scoreDisplay=null,this.speedDisplay=null,this.powerUpTimer=null,this.fallingItems=[],this.scorePopups=[],this.spawnTimer=0,this.scoreTimer=0,this.gameLoopBound=null,this.currentSpeedMultiplier=1,this.originalSpeedMultiplier=1,this.currentSpawnInterval=L.spawnInterval,this.username="",this.powerUpActive=!1,this.background=null,this.resizeListener=null,this.orientationListener=null,this.telegramViewportListener=null}setTelegramService(t){this.telegramService=t,console.log("Telegram service set in Game")}async init(){try{this.stateManager.setState(Rt.LOADING),await J.load(L.defaultLocale),this.updateUITranslations(),this.app=new Nn,await this.app.init({width:L.width,height:L.height,backgroundColor:L.backgroundColor,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0}),document.getElementById("gameContainer").appendChild(this.app.canvas),await this.assetLoader.loadAll(),this.particleSystem=new Bd(this.app),this.uiManager.setStage(this.app.stage),this.uiManager.setScoreService(this.scoreService),this.setupResizeHandler(),document.getElementById("startButton").addEventListener("click",()=>this.handleStartClick()),document.getElementById("leaderboardButton").addEventListener("click",()=>this.showLeaderboard()),document.getElementById("contestInfoButton").addEventListener("click",()=>this.showContestInfo()),document.getElementById("optionsButton").addEventListener("click",()=>this.showOptions()),document.getElementById("usernameInput").addEventListener("keypress",t=>{t.key==="Enter"&&this.handleStartClick()}),this.stateManager.setState(Rt.START_SCREEN),console.log("Game initialized successfully!")}catch(t){throw console.error("Failed to initialize game:",t),t}}handleStartClick(){const t=document.getElementById("usernameInput"),e=t.value.trim();if(!e){t.style.borderColor="#FF6B6B",t.placeholder=J.t("game.usernameRequired"),setTimeout(()=>{t.style.borderColor="rgba(76, 175, 80, 0.5)",t.placeholder=J.t("game.usernamePlaceholder")},2e3);return}this.username=e,console.log("Starting game for player:",this.username),this.start()}showLeaderboard(){new Nd().show(()=>{})}showContestInfo(){new Hd().show(()=>{})}showOptions(){new $d().show(()=>{})}setupResizeHandler(){const t=()=>{const e=L.width;if(ba(),this.app.renderer.resize(L.width,L.height),this.background&&(this.background.clear(),this.background.rect(0,0,L.width,L.height),this.background.fill(L.backgroundColor)),this.player&&this.player.updateBounds(),this.scoreDisplay&&this.scoreDisplay.text&&(this.scoreDisplay.text.x=20,this.scoreDisplay.text.y=20),this.speedDisplay&&this.speedDisplay.updatePosition(),this.powerUpTimer&&this.powerUpTimer.updatePosition(),this.fallingItems.length>0){const s=L.width/e;for(const r of this.fallingItems)r.container&&(r.container.x*=s)}};this.resizeListener=t,this.orientationListener=()=>{setTimeout(t,100)},this.telegramViewportListener=()=>{console.log("Telegram viewport changed, resizing game..."),setTimeout(t,100)},window.addEventListener("resize",this.resizeListener),window.addEventListener("orientationchange",this.orientationListener),window.addEventListener("telegramViewportChanged",this.telegramViewportListener)}updateUITranslations(){const t=document.getElementById("startButton");if(t){t.querySelector("span:first-child");const s=t.querySelector("span:last-child");s&&(s.textContent=J.t("game.start"))}const e=document.getElementById("usernameInput");e&&(e.placeholder=J.t("game.usernamePlaceholder"))}start(){this.uiManager.hideStartScreen(),this.stateManager.setState(Rt.PLAYING),this.createBackground(),this.createPlayer(),this.createScoreDisplay(),this.createSpeedDisplay(),this.createPowerUpTimer(),this.gameLoopBound&&this.app.ticker.remove(this.gameLoopBound),this.gameLoopBound=t=>this.update(t),this.app.ticker.add(this.gameLoopBound),console.log("Game started for player:",this.username)}createBackground(){const t=new lt;t.rect(0,0,L.width,L.height),t.fill(L.backgroundColor),this.background=t,this.app.stage.addChild(this.background);for(let e=0;e<50;e++){const s=new lt;s.circle(0,0,Math.random()*2+.5),s.fill({color:16777215,alpha:Math.random()*.5+.2}),s.x=Math.random()*L.width,s.y=Math.random()*L.height,this.background.addChild(s)}}createPlayer(){this.player=new Pd(this.assetLoader.getTexture("basket")),this.player.addToStage(this.app.stage),this.player.setupControls(this.app.canvas)}createScoreDisplay(){this.scoreDisplay=new Hr,this.scoreDisplay.addToStage(this.app.stage)}createSpeedDisplay(){this.speedDisplay=new Rd,this.speedDisplay.addToStage(this.app.stage),this.speedDisplay.setSpeed(this.currentSpeedMultiplier)}createPowerUpTimer(){this.powerUpTimer=new Fd,this.powerUpTimer.addToStage(this.app.stage)}spawnFallingItem(){const t=Sa();let e,s;t?(e=t,s=this.assetLoader.getTexture(t.texture)):(e=va(),s=this.assetLoader.getTexture(e.texture));const r=new Ed(s,e,this.currentSpeedMultiplier);r.addToStage(this.app.stage),this.fallingItems.push(r)}update(t){if(!(!this.stateManager.isPlaying()||!this.scoreDisplay||!this.player)){this.speedDisplay&&this.speedDisplay.animate(t.deltaTime),this.powerUpTimer&&this.powerUpTimer.isActive()&&(this.powerUpTimer.update(t.deltaMS)||this.restoreSpeed()),this.scoreTimer+=t.deltaMS,this.scoreTimer>=1e3&&(this.scoreDisplay.increment(),this.scoreTimer-=1e3),this.spawnTimer+=t.deltaTime,this.spawnTimer>this.currentSpawnInterval&&(this.spawnFallingItem(),this.spawnTimer=0);for(let e=this.fallingItems.length-1;e>=0;e--){const s=this.fallingItems[e];if(!(!s||!s.update)){if(s.update(t.deltaTime),this.collisionSystem.checkCollision(s,this.player)){this.handleItemCatch(s,e);continue}s.isOffScreen()&&(s.removeFromStage(this.app.stage),this.fallingItems.splice(e,1))}}for(let e=this.scorePopups.length-1;e>=0;e--){const s=this.scorePopups[e];if(!s||!s.update)continue;s.update(t.deltaTime)||(s.removeFromStage(this.app.stage),s.destroy(),this.scorePopups.splice(e,1))}}}handleItemCatch(t,e){if(!t||!this.scoreDisplay)return;const s=t.getPosition(),r=t.getConfig();if(r.effectType)this.handlePowerUpCatch(t,s);else if(t.isGameOver())this.particleSystem.createCatchEffect(s.x,s.y,r.particleColor),this.telegramService&&r.haptic&&this.telegramService.hapticFeedback(r.haptic),this.gameOver();else if(t.isScoreable()){const n=t.getScoreValue();this.scoreDisplay.add(n),this.particleSystem.createCatchEffect(s.x,s.y,r.particleColor),this.createScorePopup(s.x,s.y,n,r.color,J.t(r.nameKey)),this.telegramService&&r.haptic&&this.telegramService.hapticFeedback(r.haptic),this.powerUpActive||this.increaseDifficulty()}t.removeFromStage(this.app.stage),this.fallingItems.splice(e,1)}createScorePopup(t,e,s,r,n){const a=new Ld(t,e,s,r,n);a.addToStage(this.app.stage),this.scorePopups.push(a)}handlePowerUpCatch(t,e){const s=t.getConfig();console.log(`Power-up caught: ${s.id}`),this.particleSystem.createCatchEffect(e.x,e.y,s.particleColor),this.telegramService&&s.haptic&&this.telegramService.hapticFeedback(s.haptic),s.effectType==="speed_multiplier"&&this.applySpeedMultiplierEffect(s)}applySpeedMultiplierEffect(t){this.powerUpActive=!0,this.originalSpeedMultiplier=this.currentSpeedMultiplier,this.currentSpeedMultiplier=Math.max(1,this.currentSpeedMultiplier*t.effectValue),this.updateFallingItemsSpeeds(),this.speedDisplay&&this.speedDisplay.setSpeed(this.currentSpeedMultiplier),this.powerUpTimer&&this.powerUpTimer.start(t.id,t.duration),console.log(`Speed changed from ${this.originalSpeedMultiplier.toFixed(2)}x to ${this.currentSpeedMultiplier.toFixed(2)}x for ${t.duration}ms`)}restoreSpeed(){console.log("Power-up expired! Restoring speed..."),this.powerUpActive=!1,this.currentSpeedMultiplier=this.originalSpeedMultiplier,this.updateFallingItemsSpeeds(),this.speedDisplay&&this.speedDisplay.setSpeed(this.currentSpeedMultiplier),console.log(`Speed restored to ${this.currentSpeedMultiplier.toFixed(2)}x`)}updateFallingItemsSpeeds(){for(const t of this.fallingItems)t&&t.updateSpeed&&t.updateSpeed(this.currentSpeedMultiplier)}increaseDifficulty(){const t=Ce.speedIncreasePerScore;this.currentSpeedMultiplier=Math.min(this.currentSpeedMultiplier+t,Ce.maxSpeedMultiplier),this.currentSpawnInterval=Math.max(this.currentSpawnInterval-Ce.spawnRateIncrease,Ce.minSpawnInterval),this.speedDisplay&&this.speedDisplay.setSpeed(this.currentSpeedMultiplier),console.log(`Difficulty increased! Speed: ${this.currentSpeedMultiplier.toFixed(2)}x, Spawn interval: ${this.currentSpawnInterval}`)}gameOver(){var e,s;this.stateManager.setState(Rt.GAME_OVER),this.gameLoopBound&&this.app.ticker.remove(this.gameLoopBound),this.clearFallingItems();const t=this.telegramService?{userId:(e=this.telegramService.getUser())==null?void 0:e.id,username:(s=this.telegramService.getUser())==null?void 0:s.username}:{};this.scoreService.saveScore(this.username,this.scoreDisplay.score,t).then(r=>this.scoreService.getTopScores(10).then(n=>{this.showGameOverScreen(r,n)})).catch(r=>{console.error("Error saving score:",r),this.showGameOverScreen({username:this.username,score:this.scoreDisplay.score,rank:0},[])})}clearFallingItems(){for(const t of this.fallingItems)t&&t.removeFromStage&&t.removeFromStage(this.app.stage);this.fallingItems=[]}clearScorePopups(){for(const t of this.scorePopups)t&&t.removeFromStage&&(t.removeFromStage(this.app.stage),t.destroy());this.scorePopups=[]}showGameOverScreen(t,e){new Vd(this.username,this.scoreDisplay.score,t,e,()=>this.restart()).show()}restart(){console.log("Restarting game..."),this.cleanup(),this.resetGameState(),this.start()}cleanup(){this.gameLoopBound&&this.app&&(this.app.ticker.remove(this.gameLoopBound),this.gameLoopBound=null),this.clearFallingItems(),this.clearScorePopups(),this.app&&this.app.stage&&this.app.stage.removeChildren(),this.uiManager.hideCurrentScreen(),this.background=null,this.player=null,this.scoreDisplay=null,this.speedDisplay=null,this.powerUpTimer=null}resetGameState(){this.spawnTimer=0,this.scoreTimer=0,this.currentSpeedMultiplier=1,this.currentSpawnInterval=L.spawnInterval,this.fallingItems=[],this.scorePopups=[],this.scoreDisplay=new Hr,this.speedDisplay=null,this.powerUpTimer=null,this.powerUpActive=!1,this.originalSpeedMultiplier=1}destroy(){console.log("Destroying game..."),this.cleanup(),this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null),this.orientationListener&&(window.removeEventListener("orientationchange",this.orientationListener),this.orientationListener=null),this.telegramViewportListener&&(window.removeEventListener("telegramViewportChanged",this.telegramViewportListener),this.telegramViewportListener=null),this.stateManager&&this.stateManager.destroy(),this.uiManager&&this.uiManager.destroy(),this.particleSystem&&(this.particleSystem=null),this.app&&(this.app.destroy(!0,{children:!0,texture:!1,baseTexture:!1}),this.app=null),console.log("Game destroyed successfully")}}class jd{constructor(){var t;this.tg=(t=window.Telegram)==null?void 0:t.WebApp,this.isInTelegram=!!this.tg}init(){if(!this.isInTelegram){console.log("Not running in Telegram Web App");return}console.log("Initializing Telegram Web App..."),this.tg.ready(),this.tg.expand(),this.tg.enableClosingConfirmation(),this.tg.setHeaderColor("#0F2027"),this.tg.setBackgroundColor("#0F2027"),this.tg.disableVerticalSwipes(),console.log("Telegram Web App initialized:",{version:this.tg.version,platform:this.tg.platform,colorScheme:this.tg.colorScheme,viewportHeight:this.tg.viewportHeight,viewportStableHeight:this.tg.viewportStableHeight,isExpanded:this.tg.isExpanded,safeAreaInset:this.tg.safeAreaInset}),this.updateViewportVariables(),this.tg.onEvent("viewportChanged",()=>{console.log("Telegram viewport changed"),this.updateViewportVariables(),window.dispatchEvent(new Event("telegramViewportChanged"))}),this.tg.onEvent("themeChanged",()=>{console.log("Telegram theme changed"),this.tg.setHeaderColor("#0F2027"),this.tg.setBackgroundColor("#0F2027")})}updateViewportVariables(){if(!this.isInTelegram)return;const t=document.documentElement;this.tg.viewportHeight&&t.style.setProperty("--tg-viewport-height",`${this.tg.viewportHeight}px`),this.tg.viewportStableHeight&&t.style.setProperty("--tg-viewport-stable-height",`${this.tg.viewportStableHeight}px`),this.tg.safeAreaInset&&(t.style.setProperty("--tg-safe-area-inset-top",`${this.tg.safeAreaInset.top}px`),t.style.setProperty("--tg-safe-area-inset-bottom",`${this.tg.safeAreaInset.bottom}px`),t.style.setProperty("--tg-safe-area-inset-left",`${this.tg.safeAreaInset.left}px`),t.style.setProperty("--tg-safe-area-inset-right",`${this.tg.safeAreaInset.right}px`))}getUser(){var t;return this.isInTelegram&&((t=this.tg.initDataUnsafe)==null?void 0:t.user)||null}getUserDisplayName(){const t=this.getUser();return t&&(t.username||t.first_name||`User${t.id}`)||""}showConfirm(t){return this.isInTelegram?new Promise(e=>{this.tg.showConfirm(t,e)}):Promise.resolve(window.confirm(t))}showAlert(t){return this.isInTelegram?new Promise(e=>{this.tg.showAlert(t,e)}):(alert(t),Promise.resolve())}hapticFeedback(t="medium"){if(!(!this.isInTelegram||!this.tg.HapticFeedback))try{switch(t){case"light":case"medium":case"heavy":case"rigid":case"soft":this.tg.HapticFeedback.impactOccurred(t);break;case"success":case"warning":case"error":this.tg.HapticFeedback.notificationOccurred(t);break;default:this.tg.HapticFeedback.impactOccurred("medium")}}catch(e){console.warn("Haptic feedback failed:",e)}}close(){if(!this.isInTelegram){window.close();return}this.tg.close()}getViewportDimensions(){return this.isInTelegram&&this.tg.viewportHeight?{width:window.innerWidth,height:this.tg.viewportStableHeight||this.tg.viewportHeight,stableHeight:this.tg.viewportStableHeight,isExpanded:this.tg.isExpanded}:{width:window.innerWidth,height:window.innerHeight,stableHeight:window.innerHeight,isExpanded:!0}}isRunningInTelegram(){return this.isInTelegram}getPlatform(){return this.isInTelegram?this.tg.platform||"unknown":"web"}isMobile(){const t=this.getPlatform();return["android","ios"].includes(t)||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)}}const Vt=new jd;Vt.init();dt.connect().catch(i=>{console.warn("WebSocket connection failed, will use localStorage fallback:",i)});const Nr=new Yd;function Xd(){const i=Vt.getUserDisplayName();if(i){const t=document.getElementById("usernameInput");t&&(t.value=i,console.log("Pre-filled username from Telegram:",i))}}window.onload=async()=>{try{console.log("Initializing game..."),console.log("Running in Telegram:",Vt.isRunningInTelegram()),console.log("Platform:",Vt.getPlatform()),console.log("Is Mobile:",Vt.isMobile());const i=Vt.getViewportDimensions();console.log("Viewport dimensions:",i),Xd(),await Nr.init(),Nr.setTelegramService(Vt),console.log("Game initialized successfully!")}catch(i){console.error("Failed to initialize game:",i);const t=document.getElementById("startScreen");if(t){const e=document.createElement("div");e.style.cssText="color: #FF6B6B; background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px; margin-top: 20px; max-width: 500px;",e.innerHTML=`
                <h3 style="margin-bottom: 10px;">Klaida kraunant aidim</h3>
                <p style="font-size: 14px;">${i.message}</p>
                <button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    Perkrauti puslap
                </button>
            `,t.querySelector(".start-content").appendChild(e)}}};window.addEventListener("telegramViewportChanged",()=>{console.log("Handling Telegram viewport change in main.js")});export{yo as $,Wn as A,it as B,xt as C,U as D,P as E,dn as F,ms as G,Hi as H,jt as I,Uo as J,Ko as K,We as L,F as M,X as N,V as O,et as P,ph as Q,ei as R,mi as S,Ke as T,Zs as U,Vi as V,Ps as W,Yi as X,bo as Y,ie as Z,q as _,Pn as a,on as a0,Un as a1,R as a2,z as a3,_h as a4,Yh as a5,zh as a6,dl as a7,fl as a8,yl as a9,bl as aa,wl as ab,sa as ac,ar as ad,rr as ae,Ir as af,wt as ag,Sc as ah,H as ai,lt as aj,Wa as ak,Ge as al,Ur as am,na as an,mt as b,Dh as c,De as d,tt as e,nr as f,Rh as g,as as h,pi as i,On as j,yn as k,gt as l,Bn as m,ze as n,cl as o,ul as p,gl as q,to as r,_l as s,D as t,za as u,Sl as v,N as w,ht as x,rn as y,pt as z};
